{"version":3,"file":"js/app.382bc543.js","mappings":"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","sources":["webpack://rpggame/./src/dialog/dialog.ts","webpack://rpggame/./src/imageLoader.ts","webpack://rpggame/./src/level/actions/actions.ts","webpack://rpggame/./src/level/actions/commonActions.ts","webpack://rpggame/./src/level/actions/spiritFriend.ts","webpack://rpggame/./src/level/battle/battle.ts","webpack://rpggame/./src/level/canvas.ts","webpack://rpggame/./src/level/constants.ts","webpack://rpggame/./src/level/effects/effects.ts","webpack://rpggame/./src/level/formations/formations.ts","webpack://rpggame/./src/level/gameStatus.ts","webpack://rpggame/./src/level/guide/guide.ts","webpack://rpggame/./src/level/guide/levelGuides.ts","webpack://rpggame/./src/level/items/inventory/inventory.ts","webpack://rpggame/./src/level/items/itemTypes.ts","webpack://rpggame/./src/level/items/items.ts","webpack://rpggame/./src/level/map/map.ts","webpack://rpggame/./src/level/map/util/eqXy.ts","webpack://rpggame/./src/level/map/util/findAround.ts","webpack://rpggame/./src/level/mouseHandler.ts","webpack://rpggame/./src/level/moving.ts","webpack://rpggame/./src/level/turn-stack/turnStack.ts","webpack://rpggame/./src/level/units/UnitType.ts","webpack://rpggame/./src/level/units/playerUnit.ts","webpack://rpggame/./src/level/map/util/isNextTo.ts","webpack://rpggame/./src/level/map/util/findSpace.ts","webpack://rpggame/./src/level/units/spiderUnit.ts","webpack://rpggame/./src/level/units/spiritUnit.ts","webpack://rpggame/./src/level/units/units.ts","webpack://rpggame/./src/level/visibility.ts","webpack://rpggame/./src/level/components/GameHud.vue","webpack://rpggame/./src/level/components/GameHud.vue?35ea","webpack://rpggame/./src/level/units/UnitProfile.vue","webpack://rpggame/./src/level/units/UnitProfile.vue?ad7a","webpack://rpggame/./src/level/turn-stack/TurnStack.vue","webpack://rpggame/./src/level/turn-stack/TurnStack.vue?dd78","webpack://rpggame/./src/level/guide/ToolTip.vue","webpack://rpggame/./src/level/guide/ToolTip.vue?c5e1","webpack://rpggame/./src/level/actions/ActionButton.vue","webpack://rpggame/./src/level/actions/ActionButton.vue?bb35","webpack://rpggame/./src/level/items/inventory/InventoryPanel.vue","webpack://rpggame/./src/level/items/inventory/InventoryPanel.vue?ea20","webpack://rpggame/./src/level/formations/FormationsPanel.vue","webpack://rpggame/./src/level/formations/FormationsPanel.vue?25a1","webpack://rpggame/./src/level/progress/saveProgress.ts","webpack://rpggame/./src/level/progress/ListOfSaves.vue","webpack://rpggame/./src/level/progress/ProgressPanel.vue","webpack://rpggame/./src/level/progress/ProgressPanel.vue?51aa","webpack://rpggame/./src/level/actions/ActionButtons.vue","webpack://rpggame/./src/level/components/GameOver.vue","webpack://rpggame/./src/modal/ModalMatte.vue","webpack://rpggame/./src/modal/ModalMatte.vue?7742","webpack://rpggame/./src/modal/BaseModal.vue","webpack://rpggame/./src/modal/modal.ts","webpack://rpggame/./src/level/actions/ActionModal.vue","webpack://rpggame/./src/level/LevelCanvas.vue","webpack://rpggame/./src/level/LevelCanvas.vue?cfdc","webpack://rpggame/./src/level/battle/BattleModal.vue","webpack://rpggame/./src/level/LevelContainer.vue","webpack://rpggame/./src/level/LevelContainer.vue?d03d","webpack://rpggame/./src/dialog/DialogModal.vue","webpack://rpggame/./src/dialog/DialogModal.vue?4e0e","webpack://rpggame/./src/App.vue","webpack://rpggame/./src/main.ts","webpack://rpggame/./src/settings.ts","webpack://rpggame/webpack/bootstrap","webpack://rpggame/webpack/runtime/chunk loaded","webpack://rpggame/webpack/runtime/compat get default export","webpack://rpggame/webpack/runtime/define property getters","webpack://rpggame/webpack/runtime/global","webpack://rpggame/webpack/runtime/hasOwnProperty shorthand","webpack://rpggame/webpack/runtime/jsonp chunk loading","webpack://rpggame/webpack/startup"],"sourcesContent":["import { guideTick } from \"@/level/guide/guide\";\r\nimport { introDialog } from \"@/level/guide/levelGuides\";\r\nimport { showHelp } from \"@/settings\";\r\nimport { Ref, ref } from \"vue\";\r\n\r\nexport type DialogType = {\r\n    name: string,\r\n    speech?: string,\r\n    profileImg: string\r\n}\r\n\r\nconst dialog: Ref<DialogType | undefined> = ref(introDialog[0]);\r\n\r\nlet dialogList: DialogType[] = [\r\n    introDialog[1],\r\n    introDialog[2],\r\n    introDialog[3]\r\n];\r\n\r\nexport const hasDialog = (): boolean => dialog.value !== undefined && showHelp;\r\n\r\nexport const getDialog = () => dialog.value;\r\n\r\nexport const dialogNext = () => {\r\n    if (dialogList.length > 0) {\r\n        dialog.value = dialogList.splice(0, 1)[0];\r\n    } else {\r\n        dialog.value = undefined;\r\n        guideTick();\r\n    }\r\n}\r\n\r\nexport const setDialog = (_dialog: DialogType[]) => {\r\n    dialogList = _dialog;\r\n    dialogNext();\r\n}","import { render } from \"./level/canvas\";\r\n\r\nexport type imgData = {\r\n    img: null | HTMLImageElement,\r\n    loaded: boolean\r\n}\r\n\r\nconst initImg = (): imgData => ({\r\n    img: null,\r\n    loaded: false\r\n});\r\n\r\nconst loadImg = (image: imgData, imgLoc: string) => {\r\n    image.img = new Image();\r\n    image.img.src = imgLoc;\r\n    image.img.onload = () => image.loaded = true;\r\n}\r\n\r\nexport const images = {\r\n    floor: initImg(),\r\n    cave: initImg(),\r\n    w2: initImg(),\r\n    character: initImg(),\r\n    spider: initImg(),\r\n    mouse: initImg(),\r\n    lightningFlag: initImg(),\r\n    formationPlate: initImg(),\r\n    animalCorpse: initImg(),\r\n    lightning1: initImg(),\r\n    lightning2: initImg(),\r\n    lightning3: initImg(),\r\n    lightning4: initImg(),\r\n    waiting: initImg(),\r\n    attacking: initImg(),\r\n    walking: initImg(),\r\n    talking: initImg(),\r\n    exiting: initImg(),\r\n    summonMouse: initImg(),\r\n    recallMouse: initImg(),\r\n    profileImg: initImg(),\r\n    profileCold: initImg(),\r\n    profileReading: initImg()\r\n} as Record<string, imgData>\r\n\r\n\r\nconst checkLoaded = () => {\r\n    const imgs = Object.values(images);\r\n    // console.log(`imgs: ${JSON.stringify(imgs)}`);\r\n    const notLoaded = imgs.filter(img => !img.loaded);\r\n    // console.log(`notLoaded: ${JSON.stringify(notLoaded)}`);\r\n    const numNotLoaded = notLoaded.length;\r\n    // console.log(`numNotLoaded: ${numNotLoaded}`);\r\n    if (numNotLoaded > 0) {\r\n        setTimeout(checkLoaded, 100);\r\n        return;\r\n    }\r\n\r\n    render();\r\n}\r\n\r\nconst IMG_FLOOR = 'f1.jpg';\r\nconst IMG_CAVE = 't1.png';\r\nconst IMG_WALL = 'ww.jpg'\r\nconst IMG_CHARACTER = 'ch.png';\r\nconst IMG_SPIDER = 'spider2.png'\r\nconst IMG_MOUSE = 'mouse.png';\r\nconst IMG_LIGHTNING_FLAG = 'lightning_flag.png';\r\nconst IMG_FORMATION_PLATE = 'formation_plate.png';\r\nconst IMG_LIZARD = 'lizard.png';\r\nconst IMG_LIGHTNING_1 = 'effect_lightning_1.png';\r\nconst IMG_LIGHTNING_2 = 'effect_lightning_2.png';\r\nconst IMG_LIGHTNING_3 = 'effect_lightning_3.png';\r\nconst IMG_LIGHTNING_4 = 'effect_lightning_4.png';\r\nexport const IMG_WAITING = 'waiting.png';\r\nexport const IMG_ATTACKING = 'attack.png';\r\nexport const IMG_WALKING = 'walk.png';\r\nexport const IMG_TAKING = 'take.png';\r\nexport const IMG_EXITING = 'exit.png';\r\nexport const IMG_SUMMON_MOUSE = 'mouse_summon.png';\r\nexport const IMG_RECALL_MOUSE = 'mouse_recall.png';\r\nexport const IMG_PROFILE_IMG = 'profile.png';\r\nexport const IMG_PROFILE_COLD = 'profile_cold.png';\r\nexport const IMG_PROFILE_READING = 'profile_reading.png';\r\n\r\nexport function initImages() {\r\n    loadImg(images.floor, IMG_FLOOR);\r\n    loadImg(images.cave, IMG_CAVE);\r\n    loadImg(images.w2, IMG_WALL);\r\n    loadImg(images.character, IMG_CHARACTER);\r\n    loadImg(images.spider, IMG_SPIDER);\r\n    loadImg(images.mouse, IMG_MOUSE);\r\n    loadImg(images.lightningFlag, IMG_LIGHTNING_FLAG);\r\n    loadImg(images.formationPlate, IMG_FORMATION_PLATE);\r\n    loadImg(images.animalCorpse, IMG_LIZARD);\r\n    loadImg(images.lightning1, IMG_LIGHTNING_1);\r\n    loadImg(images.lightning2, IMG_LIGHTNING_2);\r\n    loadImg(images.lightning3, IMG_LIGHTNING_3);\r\n    loadImg(images.lightning4, IMG_LIGHTNING_4);\r\n    loadImg(images.waiting, IMG_WAITING);\r\n    loadImg(images.attacking, IMG_ATTACKING);\r\n    loadImg(images.walking, IMG_WALKING);\r\n    loadImg(images.talking, IMG_TAKING);\r\n    loadImg(images.exiting, IMG_EXITING);\r\n    loadImg(images.summonMouse, IMG_SUMMON_MOUSE);\r\n    loadImg(images.recallMouse, IMG_RECALL_MOUSE);\r\n    loadImg(images.profileImg, IMG_PROFILE_IMG);\r\n    loadImg(images.profileCold, IMG_PROFILE_COLD);\r\n    loadImg(images.profileReading, IMG_PROFILE_READING);\r\n    checkLoaded();\r\n}","import { Ref, ref } from \"vue\";\r\nimport { render } from \"../canvas\";\r\nimport { clearMoveTo } from \"../moving\";\r\nimport { currentTurnUnit, nextUnitTurn } from \"../units/units\";\r\nimport { PICK_UP_ACTION, WALK_ACTION } from \"./commonActions\";\r\nimport { findPlayerVisible } from \"@/level/visibility\";\r\nimport { CORNER } from \"@/level/constants\";\r\nimport { SpaceCheckerFunction, findRangeAround } from \"../map/util/findAround\";\r\nimport { xyd } from \"../map/xyd\";\r\nimport { isGameOver } from \"../gameStatus\";\r\n\r\nexport type ActionRange = {\r\n    range: number | (() => number),\r\n    validator: SpaceCheckerFunction,\r\n    colour: string\r\n}\r\n\r\nexport type Action = {\r\n    label: string,\r\n    img: string,\r\n    corners?: CORNER,\r\n    range?: ActionRange,\r\n    meta?: any,\r\n    perform: (at: xyd) => void,\r\n    precondition: () => boolean,\r\n    // rangeValidator?: SpaceCheckerFunction\r\n}\r\n\r\nexport let actionAt: xyd[] = [];\r\n\r\nexport const clearActionAt = () => actionAt = [];\r\n\r\nconst currentAction: Ref<Action> = ref(WALK_ACTION);\r\n\r\nexport const currentActionColour = () => currentAction.value.range?.colour as string;\r\n\r\nexport const isCurrentAction = (action: Action) => currentAction.value.label === action.label;\r\n\r\nexport const initAction = () => clickAction(currentAction.value);\r\n\r\nexport const getActionAt = (x: number, y: number) => actionAt.find(_actionAt => _actionAt.x === x && _actionAt.y === y) as xyd;\r\n\r\nexport const clickAction = (action: Action) => {\r\n    clearMoveTo();\r\n    if (action.range) {\r\n        // console.log(`action.range, action=${JSON.stringify(action)}, rangeValidator=${JSON.stringify(action?.range.validator)}`);\r\n        const range = typeof action.range.range === 'number' ? action.range.range : action.range.range();\r\n        actionAt = findRangeAround(currentTurnUnit.value.data.at, range, action?.range.validator ?? SpaceCheckerFunction.EMPTY_SPACE);\r\n        currentAction.value = action;\r\n        render();\r\n    } else {\r\n        currentAction.value = action;\r\n        performAction({x:0, y:0, d:0});\r\n        console.log(`unit has ${currentTurnUnit.value.data.energy} remaining`);\r\n        if (currentTurnUnit.value.data.energy < 1) {\r\n            console.log('no energy left, next unit turn');\r\n            nextUnitTurn();\r\n        } \r\n        console.log('click action finished');\r\n    }\r\n}\r\n\r\nexport const performAction = (at: xyd) => {\r\n    currentAction.value.perform(at);\r\n    if (!currentAction.value.precondition() || currentTurnUnit.value.data.energy <= 0 || isGameOver()) {\r\n        currentAction.value = WALK_ACTION;\r\n    }\r\n    \r\n    findPlayerVisible();\r\n    clickAction(currentAction.value);\r\n}\r\n\r\nexport function getCurrentActions(): Action[] {\r\n    const unit = currentTurnUnit.value;\r\n    return unit.actions?.filter(action => action.precondition()) ?? [];\r\n}","import { Action } from \"./actions\";\r\nimport { attackUnit, currentTurnUnit, hasEnemies, player } from \"@/level/units/units\";\r\nimport { ATTACK_HOVER_COLOUR, CORNER, MOVEMENT_HOVER_COLOUR } from \"@/level/constants\";\r\nimport { takeItem } from \"@/level/items/items\";\r\nimport { takeInventoryItem } from \"@/level/items/inventory/inventory\";\r\nimport { gameOver } from \"@/level/gameStatus\";\r\nimport { SpaceCheckerFunction, findRangeAround } from \"../map/util/findAround\";\r\nimport { xy } from \"../map/xy\";\r\nimport { xyd } from \"../map/xyd\";\r\nimport { IMG_ATTACKING, IMG_EXITING, IMG_TAKING, IMG_WAITING, IMG_WALKING } from \"@/imageLoader\";\r\n\r\nexport const WAIT_ACTION: Action = {\r\n    label: 'Wait',\r\n    img: IMG_WAITING,\r\n    perform: () => {\r\n        currentTurnUnit.value.data.energy = 0;\r\n    },\r\n    precondition: () => true\r\n}\r\n\r\nexport const ATTACK_ACTION: Action = {\r\n    label: 'Attack',\r\n    img: IMG_ATTACKING,\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.ENEMY_UNIT,\r\n        colour: ATTACK_HOVER_COLOUR\r\n    },\r\n    perform: (at: xy) => {\r\n        const playerUnit = player();\r\n        attackUnit(playerUnit, at);\r\n        currentTurnUnit.value.data.energy = 0;\r\n    },\r\n    precondition: () => true\r\n}\r\n\r\nexport const WALK_ACTION: Action = {\r\n    label: 'Walk',\r\n    img: IMG_WALKING,\r\n    range: {\r\n        range: () => currentTurnUnit.value.data.energy,\r\n        validator: SpaceCheckerFunction.EMPTY_SPACE,\r\n        colour: MOVEMENT_HOVER_COLOUR\r\n    },\r\n    perform: (at: xyd) => {\r\n        console.log(`walking to ${at.x}, ${at.y} with d=${at.d}`);\r\n        currentTurnUnit.value.data.at = JSON.parse(JSON.stringify(at));\r\n        currentTurnUnit.value.data.energy -= at.d;\r\n    },\r\n    precondition: () => true\r\n}\r\n\r\nexport const PICK_UP_ACTION: Action = {\r\n    label: 'Pick Up',\r\n    img: IMG_TAKING,\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.ITEM,\r\n        colour: MOVEMENT_HOVER_COLOUR\r\n    },\r\n    perform: (at: xyd) => {\r\n        const item = takeItem(at);\r\n        takeInventoryItem(item);\r\n    },\r\n    precondition: () => {\r\n        return findRangeAround(currentTurnUnit.value.data.at, 1, SpaceCheckerFunction.ITEM).length > 0;\r\n    }\r\n}\r\n\r\nexport const EXIT_LEVEL_ACTION: Action = {\r\n    label: 'Exit Level',\r\n    img: IMG_EXITING,\r\n    corners: CORNER.SQUARE,\r\n    perform: () => gameOver(`Completed level!`, ''),\r\n    precondition: () => !hasEnemies()\r\n}","import { addUnit, createUnit, currentTurnUnit, removeUnit } from \"@/level/units/units\";\r\nimport { Action } from \"./actions\";\r\nimport { ATTACK_HOVER_COLOUR } from \"@/level/constants\";\r\nimport { SpaceCheckerFunction } from \"../map/util/findAround\";\r\nimport { xy } from \"../map/xy\";\r\nimport { hasStackUnit } from \"../turn-stack/turnStack\";\r\nimport { IMG_RECALL_MOUSE, IMG_SUMMON_MOUSE } from \"@/imageLoader\";\r\nimport { UnitType } from \"../units/UnitType\";\r\n\r\nexport const SUMMON_LABEL = 'Spirit Friend';\r\nconst DEPLOYED_ATTRIBUTE = 'deployed';\r\n\r\nexport const SUMMON_SPIRIT_FRIEND_ACTION: Action = {\r\n    label: SUMMON_LABEL,\r\n    img: IMG_SUMMON_MOUSE,\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.EMPTY_SPACE,\r\n        colour: ATTACK_HOVER_COLOUR\r\n    },\r\n    meta: {\r\n        [DEPLOYED_ATTRIBUTE]: false\r\n    },\r\n    perform(at: xy) {\r\n        addUnit(createUnit(UnitType.MOUSE, at));\r\n        this.meta[DEPLOYED_ATTRIBUTE] = true;\r\n        currentTurnUnit.value.data.energy = 0;\r\n    },\r\n    precondition() {\r\n        return this.meta[DEPLOYED_ATTRIBUTE] === false;\r\n    }\r\n}\r\n\r\nexport const RECALL_SPIRIT_FRIEND_ACTION: Action = {\r\n    label: 'Recall',\r\n    img: IMG_RECALL_MOUSE,\r\n    perform() {\r\n        console.log('perform recall');\r\n        removeUnit('Mouse');\r\n        const actions = currentTurnUnit.value.actions?.find(action => action.label === SUMMON_LABEL);\r\n        if (actions) {\r\n            actions.meta[DEPLOYED_ATTRIBUTE] = false;\r\n        }\r\n        currentTurnUnit.value.data.energy = 0;\r\n    },\r\n    precondition() {\r\n        console.log(`checking recall spirit friend precondition: ${hasStackUnit('Mouse')}`)\r\n        return hasStackUnit('Mouse');\r\n    }\r\n}","import { ref } from \"vue\";\r\nimport { guideTick } from \"../guide/guide\";\r\n\r\nconst inBattle = ref(false);\r\n\r\nexport const isInBattle = () => inBattle.value;\r\n\r\nexport type UnitBattleDetails = {\r\n    center: number,\r\n    rebound: number,\r\n    top: number,\r\n    height: number,\r\n    image: string\r\n}\r\n\r\nexport const startBattle = (damage: number, attacker: UnitBattleDetails | null, defender: UnitBattleDetails) => {\r\n    battleDetails.damage = damage;\r\n    battleDetails.attacker = attacker;\r\n    battleDetails.defender = defender;\r\n    inBattle.value = true;\r\n    startAnimation();\r\n}\r\n\r\nexport const hasAttacker = () => battleDetails.attacker;\r\n\r\nexport const endBattle = () => {\r\n    inBattle.value = false;\r\n    battleDetails.damage = 0;\r\n    guideTick();\r\n}\r\n\r\nconst battleDetails : {\r\n    damage: number,\r\n    attacker: UnitBattleDetails | null,\r\n    defender: UnitBattleDetails | null\r\n} = {\r\n    damage: 0,\r\n    attacker: null,\r\n    defender: null\r\n} \r\n\r\nexport const defenderImg = () => battleDetails.defender?.image;\r\n\r\nexport const attackerImg = () => battleDetails.attacker?.image;\r\n\r\n// animation\r\n\r\nconst animationRate = 200;\r\n// const animationRate = 1500;\r\n\r\nexport const leftStyle = ref('');\r\nexport const rightStyle = ref('');\r\nexport const rightFloorStyle = ref('');\r\nexport const damage = ref('');\r\n\r\nconst attacker = {\r\n    top: 0,\r\n    height: 0,\r\n    center: 0\r\n}\r\n\r\nconst defender: {\r\n    top: number,\r\n    height: number,\r\n    center: number,\r\n    filter: null | string\r\n} = {\r\n    top: 0,\r\n    height: 0,\r\n    center: 0,\r\n    filter: null\r\n}\r\n\r\n\r\nconst drawLeftSide = () => leftStyle.value = `margin-left: ${attacker.center ?? 0}px; margin-top: ${attacker.top ?? 0}px; height: ${attacker.height}px`;\r\nconst drawRightSide = () => \r\n    rightStyle.value = `margin-left: ${defender.center ?? 0}px; margin-top: ${defender.top ?? 0}px; height: ${defender.height}px;`\r\n     + (defender.filter ? `filter: ${defender.filter}` : '');\r\n\r\n\r\nconst startAnimation = () => {\r\n    console.log('start animation');\r\n    if (battleDetails.attacker) {\r\n        attacker.top = battleDetails.attacker.top;\r\n        attacker.height = battleDetails.attacker.height;\r\n        attacker.center = battleDetails.attacker.center;\r\n    }\r\n    if (battleDetails.defender) {\r\n        defender.top = battleDetails.defender.top;\r\n        defender.height = battleDetails.defender.height;\r\n        defender.center = battleDetails.defender.center;\r\n        defender.filter = null;\r\n    }\r\n    drawLeftSide();\r\n    drawRightSide();\r\n    if (hasAttacker()) {\r\n        setTimeout(attackerStartCharge, animationRate * 2);\r\n    } else {\r\n        // TODO how to check attack is from lightning?\r\n        setTimeout(lightningAttack, animationRate * 2);\r\n    }\r\n}\r\n\r\nconst attackerStartCharge = () => {\r\n    console.log('attacker start charge');\r\n    attacker.center = 0;\r\n    drawLeftSide();\r\n    setTimeout(attackerCompleteCharge, animationRate);\r\n}\r\n\r\nconst attackerCompleteCharge = () => {\r\n    console.log('attacker complete charge');\r\n    attacker.center = battleDetails.attacker?.center ?? 0;\r\n    drawLeftSide();\r\n    setTimeout(defenderReceiveAttack, animationRate);\r\n}\r\n\r\nconst lightningAttack = () => {\r\n    console.log('lightning attack');\r\n    rightFloorStyle.value = `\r\n        background-color: #f2c6c6;\r\n        background-blend-mode: screen;\r\n    `;\r\n    defender.filter = `hue-rotate(30deg) saturate(500%) brightness(300%);`;\r\n    drawRightSide();\r\n    setTimeout(defenderReceiveAttack, animationRate);\r\n}\r\n\r\nconst defenderReceiveAttack = () => {\r\n    console.log('defender receive attack animation');\r\n    rightFloorStyle.value = '';\r\n    defender.filter = `hue-rotate(0deg) saturate(500%) brightness(150%)`\r\n    if (hasAttacker()) {\r\n        defender.center = battleDetails.defender?.rebound ?? 0;\r\n    }\r\n    drawRightSide();\r\n    damage.value = `-${battleDetails.damage}`;\r\n    setTimeout(defenderReturnToNormal, animationRate * 2); \r\n}\r\n\r\nconst defenderReturnToNormal = () => {\r\n    console.log('defender return to normal');\r\n    defender.filter = null;\r\n    defender.center = battleDetails.defender?.center ?? 0;\r\n    drawRightSide();\r\n    setTimeout(endAnimation, animationRate * 4);\r\n}\r\n\r\nconst endAnimation = () => {\r\n    console.log('end animation');\r\n    damage.value = '';\r\n    leftStyle.value = '';\r\n    rightStyle.value = '';\r\n    endBattle();\r\n}\r\n\r\n","import { map } from \"./map/map\";\r\nimport { images } from \"../imageLoader\";\r\nimport { mapped, visible } from \"./visibility\";\r\nimport { Unit, currentTurnUnit, units } from \"./units/units\";\r\nimport { actionAt, currentActionColour } from \"./actions/actions\";\r\nimport { mouseAt, mouseMoveListener } from \"./mouseHandler\";\r\nimport { CURRENT_UNIT_COLOUR, IMG_TYPE } from \"./constants\";\r\nimport { PlacedItem, items } from \"./items/items\";\r\nimport { Effect, EffectType, effects } from \"./effects/effects\";\r\nimport { xy } from \"./map/xy\";\r\nimport { eqXy } from \"./map/util/eqXy\";\r\n\r\nexport let dpi = 0;\r\nexport const CELL_SIZE = 100;\r\n\r\nexport const offset = {\r\n    x: 0,\r\n    y: 0\r\n}\r\n\r\nexport const getCanvas = () => document.getElementById(\"myCanvas\") as HTMLCanvasElement;\r\n\r\nfunction setCanvasForDpi() {\r\n    const canvas = getCanvas();\r\n    dpi = window.devicePixelRatio;//get canvas\r\n    const style_height = +getComputedStyle(canvas).getPropertyValue(\"height\").slice(0, -2);\r\n    const style_width = +getComputedStyle(canvas).getPropertyValue(\"width\").slice(0, -2);//scale the canvas\r\n    canvas.setAttribute('height', '' + style_height * dpi);\r\n    canvas.setAttribute('width', '' + style_width * dpi);\r\n}\r\n\r\nexport function initCanvas() {\r\n    const canvas = getCanvas();\r\n    setCanvasForDpi();\r\n\r\n    canvas.addEventListener('mousemove', mouseMoveListener);\r\n\r\n    setInterval(animations, 200);\r\n}\r\n\r\nlet phase = 1;\r\nconst animations = () => {\r\n    // console.log(`animate ${phase}`);\r\n    phase++;\r\n    if (phase > 4) {\r\n        phase = 1;\r\n    }\r\n\r\n    const canvas = getCanvas();\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (ctx) {\r\n        for (const effect of effects) {\r\n            drawCell(ctx, effect.at);\r\n        }\r\n    }\r\n}\r\n\r\nfunction darkenIfNotVisible(ctx: CanvasRenderingContext2D, at: xy, fn: () => void) {\r\n    ctx.save();\r\n    if (!visible[at.y][at.x]) {\r\n        ctx.filter = 'brightness(0.4)';\r\n    }\r\n    fn();\r\n    ctx.restore();\r\n}\r\n\r\nfunction drawImage(img: HTMLImageElement, at: xy) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`); \r\n\r\n    const canvas = getCanvas();\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    darkenIfNotVisible(ctx, at, () => {\r\n        const x = (at.x - offset.x) * CELL_SIZE;\r\n        const y = (at.y - offset.y) * CELL_SIZE;\r\n\r\n        ctx.drawImage(\r\n            img,\r\n            x,\r\n            y,\r\n            CELL_SIZE,\r\n            CELL_SIZE\r\n        );\r\n    });\r\n}\r\n\r\nfunction drawOversiedImage(img: HTMLImageElement, at: xy) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`);\r\n    // if (visible[at.y][at.x]) {\r\n        \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n        const x = (at.x - offset.x) * CELL_SIZE - (CELL_SIZE / 4);\r\n        const y = (at.y - offset.y) * CELL_SIZE - (CELL_SIZE / 2);\r\n\r\n        ctx.drawImage(\r\n            img,\r\n            x,\r\n            y,\r\n            CELL_SIZE * 1.5,\r\n            CELL_SIZE * 1.5\r\n        );\r\n    // }\r\n}\r\n\r\nfunction drawStandingImage(img: HTMLImageElement, at: xy) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`);\r\n    // if (visible[at.y][at.x]) {\r\n        \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n        const x = (at.x - offset.x) * CELL_SIZE;\r\n        const y = (at.y - offset.y) * CELL_SIZE;\r\n\r\n        ctx.drawImage(\r\n            img,\r\n            x,\r\n            y - (CELL_SIZE / 2),\r\n            CELL_SIZE,\r\n            CELL_SIZE * 1.5\r\n        );\r\n    // }\r\n}\r\n\r\nfunction drawWallImage(btmImg: HTMLImageElement, topImg: HTMLImageElement, at: xy, transparent: boolean) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`);\r\n    // if (mapped[at.y][at.x]) {\r\n        \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n        darkenIfNotVisible(ctx, at, () => {\r\n\r\n        const x = (at.x - offset.x) * CELL_SIZE;\r\n        const y = (at.y - offset.y) * CELL_SIZE;\r\n\r\n        \r\n        ctx.save();\r\n        if (transparent) {\r\n            ctx.globalAlpha = 0.8;\r\n        }\r\n        ctx.drawImage(\r\n            topImg,\r\n            x,\r\n            y - (CELL_SIZE / 4 * 3),\r\n            CELL_SIZE,\r\n            CELL_SIZE\r\n        );\r\n        ctx.drawImage(\r\n            btmImg,\r\n            x,\r\n            y + (CELL_SIZE / 4),\r\n            CELL_SIZE,\r\n            CELL_SIZE - (CELL_SIZE / 4)\r\n        );\r\n        ctx.restore();\r\n        });\r\n    // }\r\n}\r\n\r\nfunction drawUnit(unit: Unit) {\r\n    // console.log(`drawing unit ${unit.name} at ${unit.data.at.x}, ${unit.data.at.y}`);\r\n    if (visible[unit.data.at.y][unit.data.at.x]) {\r\n        if (unit.imgType === IMG_TYPE.STANDING) {\r\n            drawStandingImage(images[unit.img].img as HTMLImageElement, unit.data.at);\r\n        } else if (unit.imgType == IMG_TYPE.OVERSIZED) {\r\n            drawOversiedImage(images[unit.img].img as HTMLImageElement, unit.data.at);\r\n        } else {\r\n            drawImage(images[unit.img].img as HTMLImageElement, unit.data.at);\r\n        }\r\n    \r\n    \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n        const x = (unit.data.at.x - offset.x) * CELL_SIZE;\r\n        const y = (unit.data.at.y - offset.y) * CELL_SIZE;\r\n        ctx.font = \"25px Arial\";\r\n\r\n        ctx.fillStyle = \"white\";\r\n        ctx.fillText(`${unit.data.armour}`, x + CELL_SIZE - 90, y + CELL_SIZE);\r\n\r\n        ctx.fillStyle = \"red\";\r\n        ctx.fillText(`${unit.data.hp}`, x + CELL_SIZE - 55, y + CELL_SIZE);\r\n\r\n        ctx.fillStyle = \"yellow\";\r\n        ctx.fillText(`${unit.data.qi}`, x + CELL_SIZE - 30, y + CELL_SIZE);\r\n    }\r\n}\r\n\r\nexport const render = () => {\r\n    const canvas = getCanvas();\r\n    const ctx = canvas.getContext(\"2d\");\r\n\r\n    if (ctx) {\r\n        // console.log(`canvas.width: ${canvas.width}, canvas.height: ${canvas.height}`);\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        drawCells(ctx);\r\n    }\r\n};\r\n\r\nfunction drawCells(ctx: CanvasRenderingContext2D) {\r\n    // console.log('draw cells');\r\n    for (let y = 0 + offset.y; y < map.length; y++) {\r\n        for (let x = 0 + offset.x; x < map[0].length; x++) {\r\n            drawCell(ctx, {x, y});\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawCell(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (mapped[at.y][at.x]) {\r\n        // console.log(`drawing ${x}, ${y}`);\r\n        if (map[at.y][at.x] === 0) {\r\n            // console.log('floor');\r\n            drawImage(images.floor.img as HTMLImageElement, at);\r\n        } else if (map[at.y][at.x] === 1) {\r\n            // console.log('cave');\r\n            const transparent = at.y - 1 >= 0 && map[at.y - 1][at.x] === 0 && visible[at.y - 1][at.x];\r\n            if (transparent) {\r\n                drawImage(images.floor.img as HTMLImageElement, at);\r\n            }\r\n            drawWallImage(images.w2.img as HTMLImageElement, images.cave.img as HTMLImageElement, at, transparent);\r\n        }\r\n\r\n        // drawMoveToBg(ctx, at);\r\n        drawActionAtBg(ctx, at);\r\n\r\n        drawCurrentUnitBg(ctx, at);\r\n        drawItems(at);\r\n        drawUnits(at);\r\n        drawEffects(at);\r\n        drawCursor(ctx, at);\r\n    }\r\n}\r\n\r\nfunction drawCurrentUnitBg(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (eqXy(currentTurnUnit.value?.data.at, at)) {\r\n        ctx.fillStyle = CURRENT_UNIT_COLOUR;\r\n        ctx.fillRect(\r\n            (currentTurnUnit.value.data.at.x - offset.x) * CELL_SIZE,\r\n            (currentTurnUnit.value.data.at.y - offset.y) * CELL_SIZE,\r\n            CELL_SIZE,\r\n            CELL_SIZE\r\n        );\r\n    }\r\n}\r\n\r\nfunction drawUnits(at: xy) {\r\n    const unit = units.value.find(unit => eqXy(unit.data.at, at));\r\n    // for (const unit of units) {\r\n    if (unit) {\r\n        drawUnit(unit);\r\n    }\r\n    // }\r\n}\r\n\r\nfunction drawItem(item: PlacedItem) {\r\n    drawImage(item.type.img.img as HTMLImageElement, item.at);\r\n}\r\n\r\nfunction drawItems(at: xy) {\r\n    const item = items().find(item => item.at.x === at.x && item.at.y === at.y);\r\n    // for (const item of items()) {\r\n    if (item) {\r\n        drawItem(item);\r\n    }\r\n    // }\r\n}\r\n\r\nfunction drawEffect(effect: Effect) {\r\n    // console.log(`draw effect`);\r\n    if (effect.type === EffectType.LIGHTNING) {\r\n        switch (phase) {\r\n            case 1:\r\n                return drawImage(images.lightning1.img as HTMLImageElement, effect.at);\r\n            case 2:\r\n                return drawImage(images.lightning2.img as HTMLImageElement, effect.at);\r\n            case 3:\r\n                return drawImage(images.lightning3.img as HTMLImageElement, effect.at);\r\n            case 4:\r\n                return drawImage(images.lightning4.img as HTMLImageElement, effect.at);\r\n        }\r\n        \r\n    }\r\n}\r\n\r\nfunction drawEffects(at: xy) {\r\n    const effect = effects.find(effect => effect.at.x === at.x && effect.at.y === at.y);\r\n    // for (const effect of effects) {\r\n    if (effect) {\r\n        drawEffect(effect);\r\n    }\r\n    // }\r\n}\r\n\r\nfunction drawCursor(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (mouseAt.x === at.x && mouseAt.y === at.y) {\r\n        // console.log(`Drawing cursor at ${mouseAt.value.x}, ${mouseAt.value.y}`);\r\n        ctx.lineWidth = 2;\r\n        ctx.strokeStyle = \"orange\";\r\n        ctx.beginPath();\r\n        ctx.rect(mouseAt.x * CELL_SIZE, mouseAt.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nfunction drawActionAtBg(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (actionAt.some(loc => loc.x === at.x && loc.y === at.y)) {\r\n        ctx.lineWidth = 16;\r\n        ctx.strokeStyle = currentActionColour();\r\n        ctx.beginPath();\r\n        ctx.rect((at.x - offset.x) * CELL_SIZE + 12, (at.y - offset.y) * CELL_SIZE + 12, CELL_SIZE - 24, CELL_SIZE - 24);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nexport function shiftRight() {\r\n    offset.x++;\r\n    render();\r\n}\r\n\r\nexport function shiftLeft() {\r\n    if (offset.x > 0) { \r\n        offset.x--;\r\n        render();\r\n    }\r\n}\r\n\r\nexport function shiftUp() {\r\n    if (offset.y > 0) {\r\n        offset.y--;\r\n        render();\r\n    }\r\n}\r\n\r\nexport function shiftDown() {\r\n    offset.y++;\r\n    render();\r\n}","export const MOVEMENT_HOVER_COLOUR = 'rgba(255, 98, 164, 0.3)';\r\nexport const ATTACK_HOVER_COLOUR = 'rgba(143, 50, 168, 0.3)';\r\nexport const CURRENT_UNIT_COLOUR = 'rgb(20, 19, 242, 0.3)';\r\nexport enum CORNER {\r\n    SQUARE = 'square',\r\n    ROUND = 'round'\r\n}\r\n\r\nexport enum IMG_TYPE {\r\n    NORMAL,\r\n    STANDING,\r\n    OVERSIZED\r\n}\r\n\r\nexport enum GuideType {\r\n    TOOLTIP,\r\n    DIALOG\r\n}\r\n\r\nexport enum GuideDirection {\r\n    LEFT = 'left',\r\n    BOTTOM_RIGHT = 'bottom-right',\r\n    BOTTOM = 'bottom'\r\n}\r\n\r\nexport const enum TargetType {\r\n    CANVAS = 'canvas',\r\n    ACTION = 'action'\r\n}","import { xy } from \"../map/xy\";\r\n\r\nexport type Effect = {\r\n    at: xy,\r\n    type: EffectType,\r\n    source: xy\r\n}\r\n\r\nexport enum EffectType {\r\n    LIGHTNING\r\n}\r\n\r\nexport let effects: Effect[] = [\r\n    // {\r\n    //     at: {x: 2, y: 4},\r\n    //     type: EffectType.LIGHTNING,\r\n    //     source: {x: 0, y: 0}\r\n    // }\r\n];\r\n\r\nexport const addEffect = (at: xy, type: EffectType, source: xy) => {\r\n    if (!effects.find(effect => effect.at.x === at.x && effect.at.y === at.y)) {\r\n        // console.log(`adding effect at ${at.x}, ${at.y}`);\r\n        effects.push({\r\n            at,\r\n            type,\r\n            source\r\n        });\r\n    }\r\n}\r\n\r\nexport const clearEffect = (source: xy) => {\r\n    effects = effects.filter(effect => !(effect.source.x === source.x && effect.source.y === source.y));\r\n}\r\n\r\nexport const findEffectsForSource = (source: xy) => \r\n    effects.filter(effect => effect.source.x === source.x && effect.source.y === source.y);\r\n\r\nexport const saveEffects = () => {\r\n    return JSON.stringify(effects);\r\n}\r\n\r\nexport const restoreEffects = (savedEffects: string) => {\r\n    effects = JSON.parse(savedEffects);\r\n}","import { Ref, ref } from \"vue\";\r\nimport { items } from \"../items/items\";\r\nimport { EffectType, addEffect, clearEffect, findEffectsForSource } from \"@/level/effects/effects\";\r\nimport { CanTakeTurn, addStackUnit, removeStackUnitKeepCurrent } from \"@/level/turn-stack/turnStack\";\r\nimport { attackUnit, player, unitAt } from \"@/level/units/units\";\r\nimport { xy } from \"../map/xy\";\r\nimport { eqXy } from \"../map/util/eqXy\";\r\nimport { ItemCategory } from \"../items/itemTypes\";\r\n\r\ntype FormationCorner = {\r\n    at: xy,\r\n    dist: number\r\n}\r\n\r\ntype FormationCorners = {\r\n    TL?: FormationCorner,\r\n    TR?: FormationCorner,\r\n    BL?: FormationCorner,\r\n    BR?: FormationCorner\r\n}\r\n\r\nexport type Formation = {\r\n    title: string,\r\n    type: string,\r\n    at: xy,\r\n    corners: FormationCorners,\r\n    status: FormationStatus,\r\n    unit?: CanTakeTurn\r\n}\r\n\r\nexport enum FormationStatus {\r\n    BROKEN = 'Broken',\r\n    IDLE = 'Idle',\r\n    ALIVE = 'Alive'\r\n}\r\n\r\nexport const formationUnit = (at: xy, title: string): CanTakeTurn => ({\r\n    name: title,\r\n    data: {\r\n        at,\r\n        energy: 1\r\n    },\r\n    movement: 1,\r\n    autoMove: () => {\r\n        console.log('formation\\'s turn');\r\n        player().data.qi -= 2;\r\n        const effects = findEffectsForSource(at);\r\n        for (const effect of effects) {\r\n            const unitAtEffect = unitAt(effect.at);\r\n            if (unitAtEffect) {\r\n                console.log(`attacking unit at ${unitAtEffect.data.at.x}, ${unitAtEffect.data.at.y}`);\r\n                attackUnit({power: 20, name: 'lightning'}, effect.at);\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n    actions: []\r\n});\r\n\r\nconst formations: Ref<Formation[]> = ref([]);\r\n\r\nexport const findFormationUnit = (name: string) => formations.value.find(formation => formation.title === name);\r\n\r\nexport const addFormation = (title: string, at: xy, type: string) => {\r\n    const newFormation: Formation = {\r\n        title,\r\n        at,\r\n        type,\r\n        corners: {},\r\n        status: FormationStatus.IDLE\r\n    };\r\n    newFormation.corners = checkFormationCorners(at);\r\n    if (!newFormation.corners.TL || !newFormation.corners.TR || !newFormation.corners.BL || !newFormation.corners.BR) {\r\n        newFormation.status = FormationStatus.BROKEN;\r\n    }\r\n\r\n    formations.value.push(newFormation);\r\n    console.log(`formations: ${JSON.stringify(formations.value)}`);\r\n}\r\n\r\nexport const updateFormations = () => {\r\n    for (const formation of formations.value) {\r\n        formation.corners = checkFormationCorners(formation.at);\r\n        if (!formation.corners.TL || !formation.corners.TR || !formation.corners.BL || !formation.corners.BR) {\r\n            formation.status = FormationStatus.BROKEN;\r\n        } else {\r\n            formation.status = FormationStatus.IDLE;\r\n        }\r\n    }\r\n}\r\n\r\nexport const removeFormation = (at: xy) => {\r\n    formations.value.splice(formations.value.findIndex(f => eqXy(f.at, at)));\r\n}\r\n\r\nexport const hasFormations = () => formations.value.length > 0;\r\n\r\nexport const getFormations = () => formations.value;\r\n\r\nexport const activateFormation = (at: xy) => {\r\n    const formation = formations.value.find(f => eqXy(f.at, at));\r\n    if (formation) {\r\n        formation.status = FormationStatus.ALIVE;\r\n        applyEffects(formation);\r\n        // add to stack\r\n        console.log(`adding to stack formation: ${formation.title}`);\r\n        \r\n        const unit = formationUnit(at, formation.title);\r\n        formation.unit = unit;\r\n        addStackUnit(unit);\r\n    }\r\n}\r\n\r\nconst applyEffectsTL = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.TL?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`TL from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = cornerAt.x; x < formationAt.x + 1; x++) {\r\n            for (let y = cornerAt.y; y < formationAt.y + 1; y++) {\r\n                // console.log(`TL check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffectsTR = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.TR?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`TR from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = formationAt.x; x < cornerAt.x + 1; x++) {\r\n            for (let y = cornerAt.y; y < formationAt.y + 1; y++) {\r\n                // console.log(`TR check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffectsBL = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.BL?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`BL from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = cornerAt.x; x < formationAt.x + 1; x++) {\r\n            for (let y = formationAt.y; y < cornerAt.y + 1; y++) {\r\n                // console.log(`BL check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffectsBR = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.BR?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`BR from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = formationAt.x; x < cornerAt.x + 1; x++) {\r\n            for (let y = formationAt.y; y < cornerAt.y + 1; y++) {\r\n                // console.log(`BR check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffects = (formation: Formation) => {\r\n    applyEffectsTL(formation);\r\n    applyEffectsTR(formation);\r\n    applyEffectsBL(formation);\r\n    applyEffectsBR(formation);\r\n    // render();\r\n}\r\n\r\nexport const deactivateFormation = (at: xy) => {\r\n    const formation = formations.value.find(f => eqXy(f.at, at));\r\n    if (formation) {\r\n        formation.status = FormationStatus.IDLE;\r\n        clearEffect(at);\r\n\r\n        if (formation) {\r\n            console.log(`removing from stack formation: ${formation.title}`);\r\n            removeStackUnitKeepCurrent(formation.title);\r\n        }\r\n    }\r\n}\r\n\r\nconst checkFormationCorners = (at: xy): FormationCorners => {\r\n    const corners: FormationCorners = {};\r\n\r\n    for (const item of items()) {\r\n\r\n        if (item.type.category === ItemCategory.FLAG) {\r\n\r\n            const xdiff = item.at.x - at.x;\r\n            const ydiff = item.at.y - at.y;\r\n\r\n            if (Math.abs(xdiff) === Math.abs(ydiff)) {\r\n                const at = JSON.parse(JSON.stringify(item.at));\r\n                const dist = Math.abs(xdiff);\r\n                if (xdiff < 0 && ydiff < 0) {\r\n                    corners.TL = { at, dist };\r\n\r\n                } else if (xdiff > 0 && ydiff < 0) {\r\n                    corners.TR = { at, dist };\r\n\r\n                } else if (xdiff < 0 && ydiff > 0) {\r\n                    corners.BL = { at, dist };\r\n\r\n                } else if (xdiff > 0 && ydiff > 0) {\r\n                    corners.BR = { at, dist };\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return corners;\r\n}\r\n\r\nexport const saveFormations = () => {\r\n    const savedState = formations.value.map(({\r\n        title,\r\n        type,\r\n        at,\r\n        corners,\r\n        status,\r\n    }) => ({\r\n        title,\r\n        type,\r\n        at,\r\n        corners,\r\n        status\r\n    }));\r\n    return JSON.stringify(savedState);\r\n}\r\n\r\nexport const restoreFormations = (savedFormations: string) => {\r\n    const savedState = JSON.parse(savedFormations) as any[];\r\n    formations.value = savedState.map(({\r\n        title,\r\n        type,\r\n        at,\r\n        corners,\r\n        status\r\n    }) => ({\r\n        title,\r\n        type,\r\n        at,\r\n        corners,\r\n        status,\r\n        unit: formationUnit(at, title)\r\n    }));\r\n}","import { Ref, ref } from \"vue\";\r\n\r\nenum GameStatus {\r\n    IN_PROGRESS,\r\n    GAME_OVER\r\n}\r\n\r\nconst status: Ref<GameStatus> = ref(GameStatus.IN_PROGRESS);\r\n\r\nconst gameOverMessage = ref('');\r\nconst gameOverImage = ref('');\r\n\r\nexport const GAME_OVER_DEFEAT = 'defeat';\r\n\r\nexport const gameOverMsg = () => gameOverMessage.value;\r\nexport const gameOverImg = () => gameOverImage.value;\r\n\r\nexport const gameOver = (message: string, type: string) => {\r\n    gameOverMessage.value = message;\r\n    status.value = GameStatus.GAME_OVER;\r\n    if (type === GAME_OVER_DEFEAT) {\r\n        gameOverImage.value = 'defeated.jpg';\r\n    } else {\r\n        gameOverImage.value = 'win.jpg';\r\n    }\r\n}\r\n\r\nexport const isGameOver = () => status.value === GameStatus.GAME_OVER;\r\n\r\nexport const restoreGameStatus = () => {\r\n    status.value = GameStatus.IN_PROGRESS;\r\n    gameOverMessage.value = '';\r\n    gameOverImage.value = '';\r\n}","import { DialogType, setDialog } from \"@/dialog/dialog\";\r\nimport { Ref, ref } from \"vue\";\r\nimport { GuideDirection, GuideType, TargetType } from \"../constants\";\r\nimport { showHelp } from \"@/settings\";\r\nimport { Unit, currentTurnUnit, hasEnemies, player, playerTeam, units } from \"../units/units\";\r\nimport { eqXy } from \"../map/util/eqXy\";\r\nimport { items } from \"../items/items\";\r\nimport { visible } from \"../visibility\";\r\nimport { getFormations, hasFormations } from \"../formations/formations\";\r\nimport { isGameOver } from \"../gameStatus\";\r\nimport { SPIDER_BAIT } from \"../items/itemTypes\";\r\nimport { CanTakeTurn } from \"../turn-stack/turnStack\";\r\nimport { PICK_UP_ACTION } from \"../actions/commonActions\";\r\n\r\n\r\n\r\nexport type Guide = {\r\n    name: string,\r\n    type: GuideType,\r\n    tooltip?: {\r\n        text: string,\r\n        direction: GuideDirection,\r\n        location: {\r\n            left: number,\r\n            top: number\r\n        },\r\n        width?: number,\r\n        target: TargetType,\r\n        targetName: string\r\n    },\r\n    dialog?: DialogType[],\r\n    ready: (gameState: GameState) => boolean,\r\n    finished: (gameState: GameState) => boolean\r\n}\r\n\r\nlet guides: Guide[] = [];\r\n\r\nexport const allGuides = () => guides;\r\n\r\nconst guideText: Ref<Guide | undefined> = ref();\r\n\r\nexport const getGuide = () => guideText.value;\r\n\r\nexport const hasTooltip = () => guideText.value?.type === GuideType.TOOLTIP && guideText.value?.tooltip && showHelp;\r\n\r\nexport const getTooltip = () => guideText.value?.tooltip;\r\n\r\nexport const setGuides = (_guides: Guide[]) => {\r\n    guides = _guides;\r\n    guideTick();\r\n}\r\n\r\nconst itemVisible = (itemTitle: string) => items().some(item => \r\n    item.type.title === itemTitle\r\n    && visible[item.at.y][item.at.x]);\r\n\r\nconst unitVisible = (unitName: string) => units.value.some(unit => \r\n    unit.name === unitName\r\n    && visible[unit.data.at.y][unit.data.at.x]\r\n);\r\n\r\ntype GameState = {\r\n    player: Unit,\r\n    currentTurnUnit: CanTakeTurn,\r\n    playerTeam: Unit[],\r\n    u: {\r\n        eqXy: typeof eqXy,\r\n        itemVisible: typeof itemVisible,\r\n        unitVisible: typeof unitVisible,\r\n        hasFormations: typeof hasFormations,\r\n        getFormations: typeof getFormations,\r\n        hasEnemies: typeof hasEnemies,\r\n        isGameOver: typeof isGameOver\r\n    },\r\n    c: Record<string, any>\r\n}\r\n\r\nconst createGameState = () => {\r\n    return {\r\n        player: player(),\r\n        currentTurnUnit: currentTurnUnit.value,\r\n        playerTeam: playerTeam(),\r\n        u: {\r\n            eqXy,\r\n            itemVisible,\r\n            unitVisible,\r\n            hasFormations,\r\n            getFormations,\r\n            hasEnemies,\r\n            isGameOver\r\n        },\r\n        c: {\r\n            'SPIDER_BAIT': SPIDER_BAIT,\r\n            'PICK_UP_ACTION': PICK_UP_ACTION\r\n        }\r\n    } as GameState;\r\n}\r\n\r\nexport const guideTick = () => {\r\n    const gameState = createGameState();\r\n\r\n    console.log(`guide tick`);\r\n    if (guideText.value?.finished(gameState)) {\r\n        console.log(`guide finished`);\r\n        guideText.value = undefined;\r\n    }\r\n\r\n    if (!guideText.value) {\r\n        console.log(`looking for new guides`);\r\n        for (let i = 0; i < guides.length; i++) {\r\n            console.log(`found guide ${guides[i].name}`);\r\n            if (guides[i].ready(gameState)) {\r\n                console.log(`ready`);\r\n                guideText.value = guides.splice(i, 1)[0];\r\n                if (guideText.value.type === GuideType.DIALOG && guideText.value.dialog) {\r\n                    setDialog(guideText.value.dialog);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst guideToString = ({\r\n    name,\r\n    type,\r\n    tooltip,\r\n    dialog,\r\n    ready,\r\n    finished\r\n}: Guide) => ({\r\n    name,\r\n    type,\r\n    tooltip,\r\n    dialog,\r\n    ready: ready.toString(),\r\n    finished: finished.toString()\r\n});\r\n\r\nconst stringToGuide = ({\r\n    name,\r\n    type,\r\n    tooltip,\r\n    dialog,\r\n    ready,\r\n    finished\r\n}: any) => ({\r\n    name,\r\n    type,\r\n    tooltip: tooltip ?? undefined,\r\n    dialog: dialog ?? undefined,\r\n    ready: eval(ready),\r\n    finished: eval(finished)\r\n});\r\n\r\nexport const saveGuides = () => {\r\n    const converedGuideText = guideText.value ? guideToString(guideText.value) : undefined;\r\n    console.log(`converedGuideText: ${JSON.stringify(converedGuideText)}`);\r\n    return JSON.stringify({\r\n        guides: guides.map(guideToString),\r\n        guideText: converedGuideText\r\n    });\r\n}\r\n\r\nexport const restoreGuides = (savedGuides: string) => {\r\n    const convertedGuides = JSON.parse(savedGuides) as any;\r\n    guides = convertedGuides.guides.map(stringToGuide);\r\n    guideText.value = stringToGuide(convertedGuides.guideText);\r\n}","import { IMG_PROFILE_COLD, IMG_PROFILE_IMG, IMG_PROFILE_READING } from \"@/imageLoader\";\r\nimport { SUMMON_LABEL } from \"../actions/spiritFriend\";\r\nimport { GuideDirection, GuideType, TargetType } from \"../constants\";\r\n\r\nimport { Guide, setGuides } from \"./guide\";\r\n\r\nconst NAME = 'Azeena';\r\n\r\nexport const introDialog = [\r\n    {\r\n        name: NAME,\r\n        speech: `'Brrr... it's colder in here than I expected.'`,\r\n        profileImg: IMG_PROFILE_COLD\r\n    },\r\n    {\r\n        name: NAME,\r\n        speech: `'According to the book, there are tens of thousands of these caves hidden in the north-western mountains that encircle the desert.'`,\r\n        profileImg: IMG_PROFILE_READING\r\n    },\r\n    {\r\n        name: NAME,\r\n        speech: `'They are the remains of an ancient civilization that disappeared a long time ago and are now inhabited by monsters.'`,\r\n        profileImg: IMG_PROFILE_READING\r\n    },\r\n    {\r\n        name: NAME,\r\n        speech: `'This one should just be the lair of a giant spider though. Even though it's tough, with a little bit of skill, I should be able to take it out.'`,\r\n        profileImg: IMG_PROFILE_IMG\r\n    }\r\n]\r\n\r\nconst movementGuide = {\r\n    name: 'movement guide',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: `Let's explore! I can move here!`,\r\n        direction: GuideDirection.LEFT,\r\n        location: {\r\n            top: 290,\r\n            left: 240\r\n        },\r\n        target: TargetType.CANVAS,\r\n        targetName: TargetType.CANVAS\r\n    },\r\n    ready: () => true,\r\n    finished: (gs) => !gs.u.eqXy(gs.player.data.at, {x: 0, y: 4})\r\n} as Guide;\r\n\r\nconst baitDialog = {\r\n    name: 'bait dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'Are those dead lizards?'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Apparantly spiders like to eat lizards. Maybe I can use them as bait?'`,\r\n            profileImg: IMG_PROFILE_READING\r\n        },\r\n    ],\r\n    ready: (gs) => gs.u.itemVisible(gs.c['SPIDER_BAIT']),\r\n    finished: () => true\r\n} as Guide;\r\n\r\nconst baitTooltip = {\r\n    name: 'bait tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: 'Move within range of the dead lizards',\r\n        direction: GuideDirection.LEFT,\r\n        location: {\r\n            top: 160,\r\n            left: 240\r\n        },\r\n        target: TargetType.CANVAS,\r\n        targetName: TargetType.CANVAS\r\n    },\r\n    ready: (gs) => gs.u.itemVisible(gs.c['SPIDER_BAIT']),\r\n    finished: (gs) => gs.c[\"PICK_UP_ACTION\"]?.precondition ?? false\r\n} as Guide;\r\n\r\nconst pickupTooltip: Guide = {\r\n    name: 'pickup tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: `Click the 'take' action and then choose an item to take`,\r\n        direction: GuideDirection.BOTTOM,\r\n        location: {\r\n            top: -100,\r\n            left: 0\r\n        },\r\n        width: 260,\r\n        target: TargetType.ACTION,\r\n        targetName: 'Pick Up'\r\n    },\r\n    ready: (gs) => gs.c[\"PICK_UP_ACTION\"]?.precondition ?? false,\r\n    finished: (gs) => (gs.currentTurnUnit?.inventory?.quantity('Spider Bait') ?? 0) > 0 ?? false\r\n} as Guide;\r\n\r\nconst spyDialog = {\r\n    name: 'spy dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'This place is scary. I shouldn't just walk around aimlessly like this.'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'I know. I can summon my spirit friend. She's a mouse, and whatever she can see, I can see.'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        },\r\n    ],\r\n    ready: (gs) => gs.currentTurnUnit.data.at.x >= 4,\r\n    finished: () => true\r\n} as Guide;\r\n\r\nconst spyTooltip: Guide = {\r\n    name: 'spy tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: 'Click the \\'summon\\' action to summon my spirit friend.',\r\n        direction: GuideDirection.BOTTOM,\r\n        location: {\r\n            top: -100,\r\n            left: 0\r\n        },\r\n        width: 260,\r\n        target: TargetType.ACTION,\r\n        targetName: SUMMON_LABEL\r\n    },\r\n    ready: (ga) => ga.currentTurnUnit.data.at.x >= 4,\r\n    finished: (gs) => gs.playerTeam.some(unit => unit.name === 'Mouse')\r\n} as Guide;\r\n\r\nconst spiderDialog = {\r\n    name: 'spider dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'That's the spider! I need to be careful. There's no way I could defeat that thing by just charging in.'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Lucky I bought materials for laying a formation. According to the book, I need to place a formation plate in the center of a large area and place a lightning flags at each corner.'`,\r\n            profileImg: IMG_PROFILE_READING\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Then I can activate the formation to release deadly lightning. Better not to get hit by that!'`,\r\n            profileImg: IMG_PROFILE_READING\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Okay! Let's try laying that formation plate somewhere!'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        },\r\n    ],\r\n    ready: (gs) => gs.u.unitVisible('Turqoise Spider'),\r\n    finished: () => true\r\n} as Guide;\r\n\r\nconst formationPlateDialog = {\r\n    name: 'formation plate dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'I've laid the formation plate. Now I need to put a lightning flag in one of the four corners. It shouldn't matter how far they are as long as they are on the corner...'`,\r\n            profileImg: IMG_PROFILE_READING\r\n        }\r\n    ],\r\n    ready: (gs) => gs.u.hasFormations(),\r\n    finished: () => true\r\n} as Guide;\r\n\r\nconst formationCompleteDialog = {\r\n    name: 'formation plate dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'The formation is complete. Once I lure the spider here I can activate the formation to zap it.'`,\r\n            profileImg: IMG_PROFILE_READING\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Better not stand in range of the formation when it's active..!'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        }\r\n    ],\r\n    ready: (gs) => gs.u.hasFormations() && gs.u.getFormations()[0].status === \"Idle\",\r\n    finished: () => true\r\n} as Guide;\r\n\r\nconst spiderDeadDialog = {\r\n    name: 'spider dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'I killed it! I actually killed it! I can't believe I really did it!'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Phew! Now that's over, I can leave this place once I'm ready'`,\r\n            profileImg: IMG_PROFILE_IMG\r\n        }\r\n    ],\r\n    ready: (gs) => !gs.u.hasEnemies(),\r\n    finished: () => true\r\n} as Guide;\r\n\r\nconst exitTooltip: Guide = {\r\n    name: 'exit tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: 'Click the \\'exit level\\' action to leave the cave.',\r\n        direction: GuideDirection.BOTTOM_RIGHT,\r\n        location: {\r\n            top: -100,\r\n            left: -150\r\n        },\r\n        width: 260,\r\n        target: TargetType.ACTION,\r\n        targetName: 'Exit Level'\r\n    },\r\n    ready: (gs) => !gs.u.hasEnemies(),\r\n    finished: (gs) => gs.u.isGameOver()\r\n} as Guide;\r\n\r\nexport const initGuides = () => {\r\n    setGuides([\r\n        movementGuide,\r\n        baitDialog,\r\n        baitTooltip,\r\n        pickupTooltip,\r\n        spyDialog,\r\n        spyTooltip,\r\n        spiderDialog,\r\n        formationPlateDialog,\r\n        formationCompleteDialog,\r\n        spiderDeadDialog,\r\n        exitTooltip\r\n    ]);\r\n}","import { Ref, ref } from \"vue\"\r\nimport { Action, clickAction, isCurrentAction } from \"../../actions/actions\"\r\nimport { ATTACK_HOVER_COLOUR } from \"@/level/constants\"\r\nimport { currentTurnUnit } from \"../../units/units\"\r\nimport { PlacedItem, placeItem } from \"../items\"\r\nimport { WALK_ACTION } from \"../../actions/commonActions\"\r\nimport { addFormation, getFormations, removeFormation, updateFormations } from \"../../formations/formations\"\r\nimport { xyd } from \"@/level/map/xyd\"\r\nimport { SpaceCheckerFunction } from \"@/level/map/util/findAround\"\r\nimport { FORMATION_PLATE, ItemCategory, LIGHTNING_FLAG } from \"../itemTypes\"\r\n\r\nconst selectedInventoryItem: Ref<null | string> = ref(null);\r\n\r\nexport type InventoryItem = {\r\n    type: string,\r\n    quantity: number\r\n}\r\n\r\nexport class Inventory {\r\n    private items: InventoryItem[] = [];\r\n\r\n    constructor(inItems: InventoryItem[]) {\r\n        this.items = inItems;\r\n    }\r\n\r\n    removeItem(type: string) {\r\n        const foundItem = this.findItem(type);\r\n        if (foundItem) {\r\n            foundItem.quantity--;\r\n            if (foundItem?.quantity <= 0) {\r\n                this.items.splice(this.items.findIndex(_item => _item.type === type), 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    findItem(type: string) {\r\n        return this.items.find(_item => _item.type === type);\r\n    }\r\n\r\n    quantity(type: string) {\r\n        return this.findItem(type)?.quantity ?? 0;\r\n    }\r\n\r\n    addItem(type: string) {\r\n        const foundItem = this.findItem(type);\r\n        if (foundItem) {\r\n            foundItem.quantity++;\r\n        } else {\r\n            this.items.push({\r\n                type,\r\n                quantity: 1\r\n            })\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.items.length === 0;\r\n    }\r\n}\r\n\r\n\r\n\r\nconst placeInventoryItem = (at: xyd) => {\r\n    console.log(`perform action inventory`);\r\n\r\n    // tidy up\r\n    // currentTurnUnit().energy = 0;\r\n    // if (selectedInventoryItem.value && selectedInventoryItem.value?.quantity > 1) {\r\n    //     selectedInventoryItem.value.quantity--;\r\n    // }\r\n    if (selectedInventoryItem.value) {\r\n        currentTurnUnit.value?.inventory?.removeItem(selectedInventoryItem.value);\r\n        placeItem(selectedInventoryItem.value, at);\r\n\r\n        if (selectedInventoryItem.value === LIGHTNING_FLAG) {\r\n            updateFormations();\r\n        }\r\n    }\r\n    //  else {\r\n        \r\n    // }\r\n\r\n    if (!selectedInventoryItem.value || (currentTurnUnit.value?.inventory?.quantity(selectedInventoryItem.value) ?? 0) <= 0) {\r\n        selectedInventoryItem.value = null;\r\n        clickAction(WALK_ACTION);\r\n    }\r\n}\r\n\r\nexport const takeInventoryItem = (item: PlacedItem) => {\r\n    currentTurnUnit.value?.inventory?.addItem(item.type.title);\r\n    if (item.type.category === ItemCategory.FORMATION) {\r\n        removeFormation(item.at);\r\n    } else if (item.type.category === ItemCategory.FLAG) {\r\n        updateFormations();\r\n    }\r\n}\r\n\r\n// const PlaceItemModal: ModalDetails = {\r\n//     inputs: [\r\n//         {\r\n//             title: 'Formation Name:',\r\n//             name: 'name',\r\n//             value: ''\r\n//         }\r\n//     ],\r\n//     title: () => `Place ${selectedInventoryItem.value?.type.title}`,\r\n//     onSubmit: (at, inputs) => {\r\n//         const item = selectedInventoryItem.value as InventoryItem;\r\n//         placeInventoryItem(at);\r\n//         addFormation(inputs[0].value, at, item.type);\r\n//     }\r\n// }\r\n\r\nexport const INVENTORY_ACTION: Action = {\r\n    label: 'Inventory',\r\n    img: '',\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.EMPTY_SPACE,\r\n        colour: ATTACK_HOVER_COLOUR\r\n    },\r\n    perform: (at) => {\r\n        if (selectedInventoryItem.value === FORMATION_PLATE) {\r\n            // startModal(PlaceItemModal, at);\r\n            // return;\r\n            addFormation(`Formation ${getFormations().length + 1}`, at, FORMATION_PLATE);\r\n            placeInventoryItem(at);\r\n        } else {\r\n            placeInventoryItem(at);\r\n        }\r\n    },\r\n    precondition: () => true,\r\n}\r\n\r\n\r\n\r\nexport const isSelectedInventoryItem = (item: InventoryItem): boolean => \r\n    isCurrentAction(INVENTORY_ACTION)\r\n    && item.type === selectedInventoryItem.value;\r\n\r\nexport const clickInventory = (item: InventoryItem) => {\r\n    console.log(`click inventory item ${item.type}`);\r\n    selectedInventoryItem.value = item.type;\r\n    clickAction(INVENTORY_ACTION);\r\n}","import { images, imgData } from \"@/imageLoader\"\r\n\r\nexport type ItemType = {\r\n    img: imgData,\r\n    title: string,\r\n    category: ItemCategory\r\n}\r\n\r\nexport enum ItemCategory {\r\n    NORMAL,\r\n    FORMATION,\r\n    FLAG\r\n}\r\n\r\nexport const SPIDER_BAIT = 'Spider Bait';\r\nexport const LIGHTNING_FLAG = 'Lightning Flag';\r\nexport const FORMATION_PLATE = 'Formation Plate';\r\n\r\nexport const typeLookup: Record<string, ItemType> = {\r\n    [SPIDER_BAIT]: {\r\n        img: images.animalCorpse,\r\n        title: SPIDER_BAIT,\r\n        category: ItemCategory.NORMAL\r\n    },\r\n\r\n    [LIGHTNING_FLAG]: {\r\n        img: images.lightningFlag,\r\n        title: LIGHTNING_FLAG,\r\n        category: ItemCategory.FLAG\r\n    },\r\n\r\n    [FORMATION_PLATE]: {\r\n        img: images.formationPlate,\r\n        title: FORMATION_PLATE,\r\n        category: ItemCategory.FORMATION\r\n    }\r\n}","import { Ref, ref } from 'vue';\r\nimport { xy } from \"../map/xy\";\r\nimport { ItemType, typeLookup } from \"./itemTypes\";\r\n\r\ntype StoredItem = {\r\n    type: string,\r\n    at: xy\r\n}\r\n\r\nexport type PlacedItem = {\r\n    type: ItemType,\r\n    at: xy\r\n}\r\n\r\nconst _items: Ref<StoredItem[]> = ref([]);\r\n\r\nconst mapStoredToPlacedItem =(item: StoredItem) => ({\r\n    type: typeLookup[item.type],\r\n    at: item.at\r\n})\r\n\r\nexport const items = (): PlacedItem[] => _items.value.map(mapStoredToPlacedItem);\r\n\r\nexport const placeItem = (type: string, at: xy) => {\r\n    _items.value.push({\r\n        type,\r\n        at\r\n    });\r\n}\r\n\r\nexport const takeItem = (at: xy) => {\r\n    return _items.value\r\n        .splice(_items.value.findIndex(item => item.at.x === at.x && item.at.y === at.y), 1)\r\n        .map(mapStoredToPlacedItem)[0];\r\n}\r\n\r\nexport const saveItems = () => {\r\n    return JSON.stringify(_items.value);\r\n}\r\n\r\nexport const restoreItems = (savedItems: string) => {\r\n    _items.value = JSON.parse(savedItems);\r\n}","import { initAction } from \"../actions/actions\";\r\nimport { findPlayerVisible } from \"../visibility\";\r\n\r\nexport const LEVEL1 = [\r\n    [1,1,1,1,1,1,1,1,1,1,1],\r\n    [1,0,0,0,1,0,0,0,0,0,1],\r\n    [1,0,0,0,0,0,0,0,0,0,1],\r\n    [1,1,0,1,1,0,0,0,0,0,1],\r\n    [0,0,0,0,1,0,0,0,0,0,1],\r\n    [1,1,1,1,1,0,1,0,1,0,1],\r\n    [1,0,0,0,1,0,1,0,0,0,1],\r\n    [1,0,0,0,1,1,1,1,1,0,1],\r\n    [1,0,0,0,0,0,0,0,0,0,1],\r\n    [1,1,1,1,1,1,1,1,1,1,1]];\r\n\r\nexport let map = LEVEL1;\r\n\r\nexport function initCharacter() {\r\n    // console.log('init character');\r\n    // findMoveTo();\r\n    initAction();\r\n    findPlayerVisible();\r\n    \r\n}\r\n\r\nexport function updateMap(newMap: number[][]) {\r\n    map = newMap;\r\n}\r\n\r\nexport function saveMap() {\r\n    return JSON.stringify(map);\r\n}\r\n\r\nexport function restoreMap(savedMap: string) {\r\n    map = JSON.parse(savedMap);\r\n}","import { xy } from \"../xy\";\r\n\r\nexport const eqXy = (at1: xy, at2: xy) => at1.x === at2.x && at1.y === at2.y;","import { Team, units } from \"@/level/units/units\";\r\nimport { map } from \"../map\";\r\nimport { eqXy } from \"./eqXy\";\r\nimport { items } from \"@/level/items/items\";\r\nimport { xy } from \"../xy\";\r\nimport { xyd } from \"../xyd\";\r\n\r\nexport enum SpaceCheckerFunction {\r\n    EMPTY_SPACE,\r\n    ENEMY_UNIT,\r\n    WALL,\r\n    ITEM\r\n}\r\n\r\nexport const EMPTY_SPACE_CHECKER = (at: xy) => {\r\n    // console.log('in empty space checeer');\r\n        return map[at.y][at.x] === 0\r\n        && !(units.value.some(unit => eqXy(unit.data.at, at)))};\r\n    \r\nexport const ENEMY_UNIT_CHECKER = (at: xy) => {\r\n        // console.log('in enemy unit checker');\r\n        return map[at.y][at.x] === 0\r\n        && units.value.some(unit => eqXy(unit.data.at, at) && unit.team === Team.MONSTER)};\r\n\r\nexport const WALL_CHECKER = (at: xy) =>\r\n        map[at.y][at.x] !== 0\r\n        && !(units.value.some(unit => eqXy(unit.data.at, at)));\r\n\r\nexport const ITEM_CHECKER = (at: xy) => \r\n        items().some(item => item.at.x === at.x && item.at.y === at.y);\r\n\r\n\r\nexport function findFreeSpaceAround(around: xy, validateFn?: SpaceCheckerFunction): xy[] {\r\n    const _validateFn = validateFn ?? SpaceCheckerFunction.EMPTY_SPACE;\r\n    return findSpaceAroundInternal(around, [], _validateFn);\r\n}\r\n\r\nconst doValidate = (at: xy, fn: SpaceCheckerFunction) => {\r\n    switch (fn) {\r\n        case SpaceCheckerFunction.EMPTY_SPACE:\r\n            return EMPTY_SPACE_CHECKER(at);\r\n        case SpaceCheckerFunction.ENEMY_UNIT:\r\n            return ENEMY_UNIT_CHECKER(at);\r\n        case SpaceCheckerFunction.WALL:\r\n            return WALL_CHECKER(at);\r\n        case SpaceCheckerFunction.ITEM:\r\n            return ITEM_CHECKER(at);\r\n    }\r\n}\r\n\r\nfunction findSpaceAroundInternal(around: xy, existingSpaces: xy[], validateFn: SpaceCheckerFunction): xy[] {\r\n    // console.log(`findSpaceAroundInternal, validate: ${validateFn}`);\r\n    const spacesAround: xy[] = [];\r\n\r\n    for (let iterx = around.x - 1; iterx < (around.x + 2); iterx++) {\r\n        for (let itery = around.y - 1; itery < (around.y + 2); itery++) {\r\n            if (\r\n                iterx >= 0\r\n                && iterx < map[0].length\r\n                && itery >= 0\r\n                && itery < map.length\r\n                && doValidate({ x: iterx, y: itery}, validateFn)\r\n                && !(spacesAround.some(move => move.x == iterx && move.y === itery))\r\n                && !(existingSpaces.some(move => move.x == iterx && move.y === itery))\r\n            ) {\r\n                spacesAround.push({\r\n                    x: iterx,\r\n                    y: itery\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return spacesAround;\r\n}\r\n\r\nexport function findRangeAround(around: xy, range: number, validateFn?: SpaceCheckerFunction): xyd[] {\r\n    // console.log(`findFreeRangeAround, around: ${JSON.stringify(around)}, range: ${range}}`);\r\n    // console.log(`findFreeRangeAround, validate: ${validateFn}`);\r\n    const _validateFn = validateFn ?? SpaceCheckerFunction.EMPTY_SPACE;\r\n    // console.log(`validate function: ${_validateFn}`);\r\n    const spaces1 = findFreeSpaceAround(around, _validateFn);\r\n    let spacesAround: xyd[] = spaces1.map(space => buildXyd(space, 1));\r\n    \r\n\r\n    for (let n = 0; n < range - 1; n++) {\r\n        // console.log(`n=${n}`);\r\n        const length = spacesAround.length;\r\n        for (let iter = 0; iter < length; iter++) {\r\n            const spaces = findSpaceAroundInternal(spacesAround[iter], spacesAround, _validateFn);\r\n            spacesAround = spacesAround.concat(spaces.map(space => buildXyd(space, n + 2)));\r\n        }\r\n    }\r\n\r\n    return spacesAround;\r\n}\r\n\r\nfunction buildXyd(space: xy, d: number) {\r\n    return {...space, d}\r\n}","import { ref } from \"vue\";\r\nimport { moveTo } from './moving';\r\nimport { actionAt, getActionAt, performAction } from \"@/level/actions/actions\";\r\nimport { CELL_SIZE, dpi, getCanvas, offset, render } from \"@/level/canvas\";\r\nimport { currentTurnUnit, nextUnitTurn } from \"@/level/units/units\";\r\nimport { guideTick } from \"./guide/guide\";\r\nimport { xy } from \"./map/xy\";\r\n\r\nexport const mouseHover = ref(false);\r\nexport const mouseAt: { x: number, y: number } = { x: -1, y: -1 };\r\n\r\nexport const mouseMoveListener = (event: MouseEvent) => {\r\n    const canvas = getCanvas();\r\n    const rect = canvas.getBoundingClientRect();\r\n    // console.log(`rect: ${rect.left}, ${rect.top}`)\r\n    const x = Math.floor((event.clientX - rect.left) / CELL_SIZE * dpi);\r\n    const y = Math.floor((event.clientY - rect.top) / CELL_SIZE * dpi);\r\n    \r\n    // console.log(event);\r\n    mouseAt.x = x;\r\n    mouseAt.y = y;\r\n    // console.log(`x = ${mouseAt.value.x}, y = ${mouseAt.value.y}, event.clientX: ${event.clientX}, event.clientY: ${event.clientY}`);\r\n    render();\r\n\r\n    checkForHover(mouseAt);\r\n}\r\n\r\nconst checkForHover = (mouseAt: xy) => {\r\n    if (mouseOverMoveTo() || mouseOverActionAt()) {\r\n        mouseHover.value = true;\r\n    } else {\r\n        mouseHover.value = false;\r\n    }\r\n}\r\n\r\nconst mouseOverMoveTo = () => \r\n    moveTo.some(loc => loc.x === (mouseAt.x + offset.x) && loc.y === (mouseAt.y + offset.y));\r\n\r\nconst mouseOverActionAt = () => \r\n    actionAt.some(loc => loc.x === (mouseAt.x + offset.x) && loc.y === (mouseAt.y + offset.y));\r\n\r\nexport function clickCanvas() {\r\n    console.log('click');\r\n    // if (mouseOverMoveTo()) {\r\n    //     moveCharacter(mouseAt.x + offset.x, mouseAt.y + offset.y);\r\n    //     nextUnitTurn();\r\n    // } else \r\n\r\n    if (mouseOverActionAt()) {\r\n        const actionAt = getActionAt(mouseAt.x, mouseAt.y);\r\n        performAction({x: mouseAt.x + offset.x, y: mouseAt.y + offset.y, d: actionAt.d});\r\n        // console.log(`unit has ${currentTurnUnit().energy} remaining`);\r\n        if (currentTurnUnit.value.data.energy < 1) {\r\n            nextUnitTurn();\r\n        }\r\n    }\r\n\r\n    guideTick();\r\n}","import { findRangeAround } from \"./map/util/findAround\";\r\nimport { currentTurnUnit } from \"./units/units\";\r\n\r\nexport let moveTo: {x: number, y: number}[] = [];\r\n\r\nexport function moveCharacter(x: number, y: number) {\r\n    currentTurnUnit.value.data.at.x = x;\r\n    currentTurnUnit.value.data.at.y = y;\r\n}\r\n\r\nexport function clearMoveTo() {\r\n    moveTo = [];\r\n}\r\n\r\nexport function findMoveTo() {\r\n    moveTo = findRangeAround(currentTurnUnit.value.data.at, currentTurnUnit.value.movement);\r\n}\r\n\r\n","import { Ref, ref } from \"vue\";\r\nimport { Action } from \"@/level/actions/actions\";\r\nimport { Inventory } from \"@/level/items/inventory/inventory\";\r\nimport { Unit, units } from \"../units/units\";\r\nimport { xy } from \"../map/xy\";\r\nimport { findFormationUnit } from \"../formations/formations\";\r\n\r\nexport interface CanTakeTurn {\r\n    name: string,\r\n    actions?: Action[],\r\n    movement: number,\r\n    inventory?: Inventory,\r\n    data: {\r\n        at: xy,\r\n        energy: number\r\n    }\r\n    autoMove?: () => boolean // true means finished\r\n}\r\n\r\nconst turnStack: Ref<string[]> = ref([]);\r\n\r\nconst turnIndex = ref(0);\r\n\r\nexport function nextStackUnit() {\r\n   let newIndex = turnIndex.value + 1;\r\n    if (newIndex >= turnStack.value.length) {\r\n        newIndex = 0;\r\n    }\r\n    turnIndex.value = newIndex;\r\n}\r\n\r\nexport function currentStackUnit(): CanTakeTurn {\r\n    console.log(`-- get current stack unit index=${turnIndex.value}`);\r\n    // console.trace();\r\n    const name = turnStack.value[turnIndex.value];\r\n    console.log(`name=${name}, turnStack=${JSON.stringify(turnStack.value)}`);\r\n    const unit = units.value.find(unit => unit.name === name) as Unit;\r\n    if (unit) {\r\n        return unit;\r\n    }\r\n    \r\n    return findFormationUnit(name)?.unit as CanTakeTurn;\r\n    \r\n}\r\n\r\nexport function hasStackUnit(name: string): boolean {\r\n    return turnStack.value.includes(name);\r\n}\r\n\r\nexport function removeStackUnitKeepCurrent(name: string) {\r\n    console.log(`removing unit ${name}`);\r\n    const stackIndex = turnStack.value.indexOf(name);\r\n    // console.log(`stack index: ${stackIndex}`);\r\n    if (stackIndex > 0) {\r\n        turnStack.value.splice(stackIndex, 1);\r\n    }\r\n}\r\n\r\nexport function removeStackUnit(name: string) {\r\n    removeStackUnitKeepCurrent(name);\r\n    nextStackUnit();\r\n    console.log(`turn stack: ${JSON.stringify(turnStack.value)}`);\r\n}\r\n\r\nexport function addStackUnit(unit: CanTakeTurn) {\r\n    turnStack.value.push(unit.name);\r\n}\r\n\r\nexport function initStack() {\r\n    turnStack.value = [];\r\n}\r\n\r\nexport function getStackUnits(): CanTakeTurn[] {\r\n    return turnStack.value\r\n        .map(name => {\r\n            const unit = units.value.find(unit => unit.name === name)\r\n            if (unit) return unit;\r\n            return findFormationUnit(name)?.unit as CanTakeTurn\r\n        })\r\n        .filter(unit => !!unit) as CanTakeTurn[];\r\n}\r\n\r\nexport function saveStack() {\r\n    return JSON.stringify({\r\n        stack: turnStack.value,\r\n        index: turnIndex.value\r\n    });\r\n}\r\n\r\nexport function restoreStack(savedStack: string) {\r\n    const saved = JSON.parse(savedStack);\r\n    turnStack.value = saved.stack;\r\n    turnIndex.value = saved.index;\r\n}","export enum UnitType {\r\n    PLAYER,\r\n    MOUSE,\r\n    SPIDER,\r\n    FORMATION\r\n}","import { Team, Unit } from \"./units\";\r\nimport { RECALL_SPIRIT_FRIEND_ACTION, SUMMON_SPIRIT_FRIEND_ACTION } from \"@/level/actions/spiritFriend\";\r\nimport { ATTACK_ACTION, EXIT_LEVEL_ACTION, PICK_UP_ACTION, WAIT_ACTION, WALK_ACTION } from \"@/level/actions/commonActions\";\r\nimport { Inventory } from \"@/level/items/inventory/inventory\";\r\nimport { IMG_TYPE } from \"../constants\";\r\nimport { xy } from \"../map/xy\";\r\nimport { UnitType } from \"./UnitType\";\r\nimport { FORMATION_PLATE, LIGHTNING_FLAG } from \"../items/itemTypes\";\r\n\r\nexport const PLAYER_NAME = 'Azeena';\r\n\r\nexport const playerUnit = (at: xy): Unit => ({\r\n    name: PLAYER_NAME,\r\n    img: 'character',\r\n    imgType: IMG_TYPE.STANDING,\r\n    profileImg: 'player_profile.png',\r\n    type: UnitType.PLAYER,\r\n    data: {\r\n        at,\r\n        hp: 2,\r\n        armour: 0,\r\n        qi: 60,\r\n        energy: 2\r\n    },\r\n    power: 2,\r\n    team: Team.PLAYER,\r\n    movement: 2,\r\n    inventory: new Inventory([\r\n        {\r\n            type: LIGHTNING_FLAG,\r\n            quantity: 4\r\n        },\r\n        {\r\n            type: FORMATION_PLATE,\r\n            quantity: 1\r\n        }\r\n    ]),\r\n    actions: [\r\n        SUMMON_SPIRIT_FRIEND_ACTION,\r\n        RECALL_SPIRIT_FRIEND_ACTION,\r\n        PICK_UP_ACTION,\r\n        ATTACK_ACTION,\r\n        WAIT_ACTION,\r\n        WALK_ACTION,\r\n        EXIT_LEVEL_ACTION\r\n    ],\r\n    battleDetails: {\r\n        center: 70,\r\n        rebound: 100,\r\n        top: 30,\r\n        height: 150,\r\n        image: 'ch.png'\r\n    }\r\n});","import { xy } from \"../xy\";\r\n\r\n\r\nexport function isNextTo(from: xy, to: xy) {\r\n    return from.x >= to.x - 1 \r\n    && from.x <= to.x + 1 \r\n    && from.y >= to.y - 1 \r\n    && from.y <= to.y + 1\r\n    && !(from.x === to.x && from.y === to.y);\r\n}","import { map } from \"../map\";\r\nimport { xy } from \"../xy\";\r\nimport { isNextTo } from \"./isNextTo\";\r\n\r\nfunction visibleToLocations(visible: boolean[][]) {\r\n    const locations: xy[] = [];\r\n    for (let y = 0; y < visible.length; y++) {\r\n        for (let x = 0; x < visible[0].length; x++) {\r\n            if (visible[y][x] && map[y][x] === 0) {\r\n                locations.push({x, y});\r\n            }\r\n        }\r\n    }\r\n    return locations;\r\n}\r\n\r\nexport function findSpaceClosestTo(visible: boolean[][], moves: xy[], target: xy, from: xy): xy {\r\n    const visibleMoves = moves.filter(move => visible[move.y][move.x] && map[move.y][move.x] === 0);\r\n    // console.log(`visible moves=${JSON.stringify(visibleMoves)}`);\r\n    const visibleLocations = visibleToLocations(visible);\r\n    // console.log(`visible locations=${JSON.stringify(visibleLocations)}`);\r\n    const attackableLocations = visibleLocations.filter(move => isNextTo(move, target));\r\n    // console.log(`attackable locations=${JSON.stringify(attackableLocations)}`);\r\n\r\n    let closestAttack = {x: -1, y: -1};\r\n    let closestMove = {x: -1, y: -1};\r\n    let closestDistance = -1;\r\n    for (const location of attackableLocations) {\r\n        for (const move of visibleMoves) {\r\n            const distance = Math.abs(location.x - move.x) + Math.abs(location.y - move.y);\r\n            if (closestDistance === - 1 || closestDistance > distance ) {\r\n                closestDistance = distance;\r\n                closestAttack = location;\r\n                closestMove = move;\r\n            }\r\n        }\r\n    }\r\n\r\n    // todo may not be in range\r\n\r\n    return closestMove;\r\n}","import { Team, Unit, attackUnit, player } from \"./units\";\r\nimport { moveCharacter } from \"@/level/moving\";\r\nimport { findVisibleTo } from \"@/level/visibility\";\r\nimport { items } from \"@/level/items/items\";\r\nimport { IMG_TYPE } from \"../constants\";\r\nimport { isNextTo } from \"../map/util/isNextTo\";\r\nimport { findRangeAround } from \"../map/util/findAround\";\r\nimport { findSpaceClosestTo } from \"../map/util/findSpace\";\r\nimport { xy } from \"../map/xy\";\r\nimport { UnitType } from \"./UnitType\";\r\nimport { SPIDER_BAIT } from \"../items/itemTypes\";\r\n\r\nconst attack = (boss: Unit, target: xy) => {\r\n    // console.log('ATTACK!!');\r\n    attackUnit(boss, target);\r\n    boss.data.energy = 0;\r\n    if (boss.data.meta) {\r\n        boss.data.meta.target = null;\r\n    }\r\n}\r\n\r\nconst identifyTarget = (boss: Unit, visible: boolean[][]) => {\r\n    if (boss.data.meta) {\r\n        const _player = player();\r\n        if (_player && visible[_player.data.at.y][_player.data.at.x]) {\r\n            boss.data.meta.target = _player.data.at;\r\n            console.log(`PLAYER IDENTFIED at ${_player.data.at.x}, ${_player.data.at.y}`);\r\n            return;\r\n        }\r\n\r\n        const baits = items().filter(item => item.type.title === SPIDER_BAIT);\r\n        for (const bait of baits) {\r\n            if (visible[bait.at.y][bait.at.x]) {\r\n                boss.data.meta.target = bait.at;\r\n                console.log(`BAIT IDENTFIED at ${bait.at.x}, ${bait.at.y}`);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst charge = (boss: Unit, target: xy, visible: boolean[][]) => {\r\n    const range = findRangeAround(boss.data.at, 1);\r\n    // console.log(`range is ${JSON.stringify(range)}`);\r\n    // console.log(`target is ${JSON.stringify(target)}`);\r\n    // console.log(`visible is ${JSON.stringify(visible)}`);\r\n    const closest = findSpaceClosestTo(visible, range, target, boss.data.at);\r\n    console.log(`closest is ${closest.x}, ${closest.y}`);\r\n    if (closest.x === -1 || closest.y === -1) {\r\n        if (boss.data.meta) boss.data.meta.target = null;\r\n        return;\r\n    }\r\n    console.log(`CHARGE from ${boss.data.at.x}, ${boss.data.at.y} to ${closest.x}, ${closest.y}`);\r\n    moveCharacter(closest.x, closest.y);\r\n    boss.data.energy--;\r\n}\r\n\r\nconst idleWalk = (boss: Unit) => {\r\n    const range = findRangeAround(boss.data.at, 1);\r\n    const randomChoice = Math.floor(Math.random() * range.length);\r\n    const toX = range[randomChoice].x;\r\n    const toY = range[randomChoice].y;\r\n    // console.log(`WALK to ${toX}, ${toY}`);\r\n    moveCharacter(toX, toY);\r\n    boss.data.energy = 0;\r\n}\r\n\r\nconst bossMove = (boss: Unit): boolean => {\r\n    console.log('boss move');\r\n    // while (boss.energy > 0) {\r\n        let visible = findVisibleTo([boss]);\r\n        identifyTarget(boss, visible);\r\n        // console.log(`visible: ${JSON.stringify(visible)}`);\r\n        // const playerUnit = player();\r\n        if (boss.data.meta && boss.data.meta.target != null) { //visible[playerUnit.y][playerUnit.x]) {\r\n            // console.log('has a target');\r\n\r\n            if (isNextTo(boss.data.at, boss.data.meta.target)) {\r\n                // console.log('is next to target');\r\n                console.log('attacking');\r\n                attack(boss, boss.data.meta.target);\r\n            } else {\r\n                // console.log('moving toward target');\r\n                console.log('charging');\r\n                charge(boss, boss.data.meta.target, visible);\r\n            }\r\n        } else {\r\n            // console.log('has no target');\r\n            console.log('idling');\r\n            idleWalk(boss);\r\n        }\r\n    // }\r\n\r\n    visible = findVisibleTo([boss]);\r\n    identifyTarget(boss, visible);\r\n    return boss.data.energy <= 0;\r\n}\r\n\r\n\r\n\r\nexport const bossUnit = (at: xy): Unit => ({\r\n    name: 'Turqoise Spider',\r\n    img: 'spider',\r\n    imgType: IMG_TYPE.OVERSIZED,\r\n    type: UnitType.SPIDER,\r\n    profileImg: 'spider_profile.png',\r\n    data: {\r\n        at,\r\n        hp: 2,\r\n        armour: 10,\r\n        qi: 0,\r\n        energy: 8,\r\n        meta: {\r\n            target: null\r\n        }\r\n    },\r\n    power: 10,\r\n    team: Team.MONSTER,\r\n    movement: 8,\r\n    actions: [],\r\n    autoMove() {\r\n        return bossMove(this);\r\n    },\r\n    battleDetails: {\r\n        center: 35,\r\n        rebound: 55,\r\n        top: 40,\r\n        height: 180,\r\n        image: 'spider2.png'\r\n    }\r\n});","import { Team, Unit } from \"./units\";\r\nimport { WAIT_ACTION, WALK_ACTION } from \"@/level/actions/commonActions\";\r\nimport { xy } from \"../map/xy\";\r\nimport { UnitType } from \"./UnitType\";\r\n\r\nexport const mouseUnit = (at: xy): Unit => ({\r\n    name: 'Mouse',\r\n    img: 'mouse',\r\n    profileImg: 'mouse_profile.png',\r\n    type: UnitType.MOUSE,\r\n    data: {\r\n        at,\r\n        hp: 1,\r\n        armour: 0,\r\n        qi: 0,\r\n        energy: 4,\r\n    },\r\n    power: 0,\r\n    team: Team.PLAYER,\r\n    movement: 4,\r\n    actions: [\r\n        WAIT_ACTION,\r\n        WALK_ACTION\r\n    ],\r\n    battleDetails: {\r\n        center: 85,\r\n        rebound: 105,\r\n        top: 85,\r\n        height: 80,\r\n        image: 'mouse.png'\r\n    }\r\n});","import { Action, clickAction } from \"../actions/actions\";\r\nimport { findPlayerVisible, visible } from \"../visibility\";\r\nimport { render } from \"../canvas\";\r\nimport { PLAYER_NAME, playerUnit } from \"./playerUnit\";\r\nimport { bossUnit } from \"./spiderUnit\";\r\nimport { CanTakeTurn, addStackUnit, currentStackUnit, initStack, nextStackUnit, removeStackUnit } from \"../turn-stack/turnStack\";\r\nimport { GAME_OVER_DEFEAT, gameOver, isGameOver } from \"@/level/gameStatus\";\r\nimport { WALK_ACTION } from \"@/level/actions/commonActions\";\r\nimport { Inventory } from \"@/level/items/inventory/inventory\";\r\nimport { items, takeItem } from \"@/level/items/items\";\r\nimport { IMG_TYPE } from \"../constants\";\r\nimport { eqXy } from \"../map/util/eqXy\";\r\nimport { xy } from \"../map/xy\";\r\nimport { UnitBattleDetails, startBattle } from \"../battle/battle\";\r\nimport { UnitType } from \"./UnitType\";\r\nimport { mouseUnit } from \"./spiritUnit\";\r\nimport { Ref, computed, ref } from \"vue\";\r\n\r\nexport enum Team {\r\n    PLAYER,\r\n    MOB,\r\n    MONSTER\r\n}\r\n\r\nexport interface UnitData {\r\n    at: xy,\r\n    energy: number,\r\n    hp: number,\r\n    armour: number,\r\n    qi: number,\r\n    inventory?: Inventory,\r\n    meta?: Record<string, any>\r\n}\r\n\r\nexport interface Unit extends CanTakeTurn {\r\n    name: string,\r\n    type: UnitType,\r\n    img: string,\r\n    imgType?: IMG_TYPE,\r\n    data: UnitData,\r\n    profileImg?: string,\r\n    team: Team,\r\n    movement: number,\r\n    power: number,\r\n    actions: Action[],\r\n    autoMove?: () => boolean,\r\n    battleDetails: UnitBattleDetails\r\n}\r\n\r\nexport const units: Ref<Unit[]> = ref([]);\r\n\r\nexport function initUnits() {\r\n    units.value = [];\r\n    initStack();\r\n    addUnit(createUnit(UnitType.PLAYER, {x: 0, y: 4}));\r\n    addUnit(createUnit(UnitType.SPIDER, {x: 2, y: 7}));\r\n}\r\n\r\nexport function addUnit(unit: Unit) {\r\n    units.value.push(unit);\r\n    addStackUnit(unit);\r\n}\r\n\r\nexport function removeUnit(name: string) {\r\n    const unitIndex = units.value.findIndex(unit => unit.name === name);\r\n    if (unitIndex >= 0) {\r\n        units.value.splice(unitIndex, 1);\r\n        removeStackUnit(name);\r\n    }\r\n}\r\n\r\nexport const unitsZero = () => units.value = [];\r\n\r\nexport const player = () => units.value.find(unit => unit.name === PLAYER_NAME) as Unit;\r\n\r\nexport const playerTeam = () => units.value.filter(unit => unit.team === Team.PLAYER);\r\n\r\nexport const hasEnemies = () => units.value.filter(unit => unit.team === Team.MONSTER).length > 0;\r\n\r\nexport const unitAt = (at: xy): Unit => units.value.find(unit => unit.data.at.x === at.x && unit.data.at.y == at.y) as Unit;\r\n\r\nexport const currentTurnUnit = computed(() => currentStackUnit());\r\n\r\nexport function nextUnitTurn(): void {\r\n    if (isGameOver()) {\r\n        return;\r\n    }\r\n    \r\n    nextStackUnit();\r\n\r\n    const currentUnit = currentTurnUnit;\r\n    if (currentUnit) {\r\n        currentUnit.value.data.energy = currentUnit.value.movement;\r\n\r\n        doMove(currentUnit.value);\r\n    }\r\n}\r\n\r\nexport function doMove(currentUnit: CanTakeTurn): void {\r\n    console.log('do move');\r\n    if (currentUnit.autoMove) {\r\n        console.log(`## monster taking move (1)`);\r\n        // console.log(`mob move`);\r\n        const finished = currentUnit.autoMove();\r\n        if (!finished) {\r\n            if (visible[currentUnit.data.at.y][currentUnit.data.at.x]) {\r\n                console.log(`## render and set timer`);\r\n                render();\r\n                setTimeout(() => doMove(currentUnit), 400);\r\n            } else {\r\n                doMove(currentUnit);\r\n            }\r\n            return;\r\n        } else {\r\n            nextUnitTurn();\r\n        }\r\n        \r\n    } else {\r\n        // console.log(`player move`);\r\n        startPlayerTurn();\r\n    }\r\n}\r\n\r\nexport function startPlayerTurn() {\r\n    findPlayerVisible();\r\n    clickAction(WALK_ACTION);\r\n    render();\r\n}\r\n\r\ninterface Attacker {\r\n    power: number,\r\n    name: string,\r\n    battleDetails?: UnitBattleDetails\r\n}\r\n\r\nexport function attackUnit(attacker: Attacker, targetLocation: xy) {\r\n    const attackee = units.value.find(unit => eqXy(unit.data.at, targetLocation));\r\n\r\n    if (attackee) {\r\n\r\n        // console.log(`attack - ${attacker.name} vs ${attackee.name}`);\r\n        if (attackee.data.armour >= attacker.power) {\r\n            attackee.data.armour -= attacker.power;\r\n            // console.log(`attackee armour reduced to ${attackee.armour}`);\r\n\r\n        } else {\r\n            const remainingPower = attacker.power - attackee.data.armour;\r\n            attackee.data.armour = 0;\r\n            attackee.data.hp -= remainingPower;\r\n            // console.log(`attackee health reduced to ${attackee.hp}`);\r\n        }\r\n\r\n        if (attackee.data.hp < 0) {\r\n            // DEAD\r\n            attackee.data.hp = 0;\r\n\r\n            removeStackUnit(attackee.name);\r\n            removeUnit(attackee.name);\r\n\r\n            // console.log(`attackee dead`);\r\n            if (attackee.name === PLAYER_NAME) {\r\n                gameOver(`Defeated by ${attacker.name}`, GAME_OVER_DEFEAT);\r\n            }\r\n        }\r\n        startBattle(attacker.power, attacker.battleDetails ?? null, attackee.battleDetails);\r\n        render();\r\n\r\n        return;\r\n    }\r\n\r\n    const item = items().find(item => item.at.x === targetLocation.x && item.at.y === targetLocation.y);\r\n\r\n    if (item) {\r\n        takeItem(item.at);\r\n    }\r\n}\r\n\r\ntype SavedUnit = {\r\n    data: UnitData,\r\n    type: UnitType,\r\n    actionsMeta: {\r\n        name: string,\r\n        meta: any\r\n    }[]\r\n}\r\n\r\nexport const saveUnits = () =>\r\n    JSON.stringify(units.value.map(\r\n        unit => ({\r\n            data: unit.data,\r\n            type: unit.type,\r\n            actionsMeta: unit.actions\r\n                .filter(action => action.meta)\r\n                .map(action => ({\r\n                    name: action.label,\r\n                    meta: action.meta\r\n                }))\r\n        }) as SavedUnit\r\n    )); \r\n\r\nexport const restoreUnits = (savedUnits: string) => {\r\n    const parsedUnits = JSON.parse(savedUnits) as SavedUnit[];\r\n    units.value = parsedUnits\r\n        .map(unit => {\r\n            const _unit = createUnit(unit.type, unit.data.at, unit.data);\r\n            for (const actionMeta of unit.actionsMeta) {\r\n                const foundAction = _unit.actions.find(action => action.label === actionMeta.name);\r\n                if (foundAction) foundAction.meta = actionMeta.meta;\r\n            }\r\n            return _unit;\r\n        });\r\n    findPlayerVisible();\r\n}\r\n\r\n\r\nexport const createUnit = (type: UnitType, at: xy, data?: UnitData): Unit => {\r\n    let unit: Unit;\r\n    switch (type) {\r\n        case UnitType.PLAYER:\r\n            unit = playerUnit(at);\r\n            break;\r\n        case UnitType.MOUSE:\r\n            unit = mouseUnit(at);\r\n            break;\r\n        case UnitType.SPIDER:\r\n            unit = bossUnit(at);\r\n            break;\r\n        default:\r\n            throw `no unit for type ${type}`;\r\n    }\r\n\r\n    if (data) {\r\n        unit.data = data;\r\n    }\r\n\r\n    return unit;\r\n}","import { map } from \"./map/map\";\r\nimport { xy } from \"./map/xy\";\r\nimport { Unit, playerTeam } from \"./units/units\";\r\n\r\nexport let visible: boolean[][] = [];\r\nexport let mapped: boolean[][] = [];\r\n\r\nexport function initVisibility() {\r\n    for (let y = 0; y < map.length; y++) {\r\n        mapped[y] =[];\r\n        for (let x = 0; x < map[0].length; x++) {\r\n            mapped[y][x] = false;\r\n        }\r\n    }\r\n}\r\n\r\nexport function findPlayerVisible() {\r\n    visible = findVisibleTo(playerTeam(), true);\r\n}\r\n\r\nexport function findVisibleTo(units: Unit[], player: boolean = false): boolean[][] {\r\n    const _visible: boolean[][] = [];\r\n    \r\n    for (let y = 0; y < map.length; y++) {\r\n        _visible[y] =[];\r\n        for (let x = 0; x < map[0].length; x++) {\r\n            _visible[y][x] = false;\r\n        }\r\n    }\r\n    \r\n\r\n    for (const unit of units) {\r\n    //     console.log(`_visible: ${JSON.stringify(_visible)}`);\r\n    // console.log(`x: ${unit.x}. y: ${unit.y}`)\r\n        followRight(unit.data.at, _visible, player);\r\n        followLeft(unit.data.at, _visible, player);\r\n        followUp(unit.data.at, _visible, player);\r\n        followDown(unit.data.at, _visible, player);\r\n        followUpLeft(unit.data.at, _visible, player);\r\n        followDownRight(unit.data.at, _visible, player);\r\n        followUpRight(unit.data.at, _visible, player);\r\n        followDownLeft(unit.data.at, _visible, player);\r\n    }\r\n\r\n    return _visible;\r\n}\r\n\r\nconst cangoLeft = (x: number) => x >= 0;\r\nconst cangoUp = (y: number) => y >= 0;\r\nconst cangoRight = (x: number) =>  x < map[0].length;\r\nconst cangoDown = (y: number) =>  y < map.length;\r\nconst canMove = (x: number, y: number) => map[y][x] !== 1;\r\n\r\nfunction followRight(from: xy, _visible: boolean[][], player: boolean) {\r\n    const y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoRight(x) && canMove(x, y)) {\r\n        x++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followUpRight({x, y}, _visible, player);\r\n        followDownRight({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followLeft(from: xy, _visible: boolean[][], player: boolean) {\r\n    const y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoLeft(x) && canMove(x, y)) {\r\n        x--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followUpLeft({x, y}, _visible, player);\r\n        followDownLeft({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followUp(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    const x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoUp(y) && canMove(x, y)) {\r\n        y--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followUpLeft({x, y}, _visible, player);\r\n        followUpRight({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followDown(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    const x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoDown(y) && canMove(x, y)) {\r\n        y++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followDownLeft({x, y}, _visible, player);\r\n        followDownRight({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followUpLeft(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoUp(y) && cangoLeft(x) && canMove(x, y)) {\r\n        x--;\r\n        y--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nfunction followDownRight(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoRight(x) && cangoDown(y) && canMove(x, y)) {\r\n        x++;\r\n        y++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nfunction followUpRight(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoUp(y) && cangoRight(x) && canMove(x, y)) {\r\n        x++;\r\n        y--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nfunction followDownLeft(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoDown(y) && cangoLeft(x) && canMove(x, y)) {\r\n        x--;\r\n        y++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nexport const saveMapped = () => {\r\n    return JSON.stringify({mapped, visible});\r\n}\r\n\r\nexport const restoreMapped = (savedMapped: string) => {\r\n    const restore = JSON.parse(savedMapped) as any;\r\n    mapped = restore.mapped;\r\n    visible = restore.visible;\r\n}","<template>\r\n    <div id=\"hud\">\r\n        <slot></slot>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n#hud {\r\n    width: 100%;\r\n    height: 100%;\r\n    position: absolute;\r\n    top: 0;\r\n    z-index: 10;\r\n    pointer-events: none;\r\n\r\n    /* for now */\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n}\r\n</style>","import { render } from \"./GameHud.vue?vue&type=template&id=52a7fc1f&scoped=true\"\nconst script = {}\n\nimport \"./GameHud.vue?vue&type=style&index=0&id=52a7fc1f&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-52a7fc1f\"]])\n\nexport default __exports__","<template>\r\n    <li :class=\"classes()\">\r\n        <span class=\"top-corner\" />\r\n\r\n        <img class=\"profile\" v-if=\"props.unit.profileImg\" :src=\"props.unit.profileImg\" />\r\n        <span class=\"details\">\r\n            <span class=\"name\">{{ props.unit.name }}</span>\r\n            <span class=\"stats\">\r\n                <span class=\"armour\">{{  props.unit.armour }}</span>\r\n                <img src=\"icon_armour.png\" class=\"icon\" />\r\n\r\n                <span class=\"hp\">{{ props.unit.hp }}</span>\r\n                <img src=\"icon_heart.png\" class=\"icon\" />\r\n\r\n                <span class=\"qi\">{{ props.unit.qi }}</span>\r\n                <img src=\"icon_qi.png\" class=\"icon\" />\r\n            </span>\r\n        </span>\r\n\r\n        <span class=\"bottom-corner\" />\r\n    </li>\r\n</template>\r\n\r\n<script setup >\r\nimport { defineProps } from 'vue';\r\nimport { Unit } from '@/level/units/units';\r\n\r\nconst props = defineProps({\r\n    unit: Unit,\r\n    selected: Boolean\r\n});\r\n\r\nconst classes = () => props.selected === true ? 'selected' : '';\r\n</script>\r\n\r\n<style scoped>\r\nli {\r\n    background-color: #3f3d3d;\r\n    /* background-color: #b1b1e9; */\r\n    padding: 8px 8px;\r\n    font-size: 20px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n    /* border: 4px solid #696990; */\r\n    margin-bottom: 5px;\r\n    /* width: 60px; */\r\n    display: flex;\r\n    flex-direction: row;\r\n\r\n    width: 220px;\r\n    color: #e7e7c8;\r\n    position: relative;\r\n}\r\n\r\nli .top-corner {\r\n    position: absolute;\r\n    width: 6px;\r\n    height: 6px;\r\n    background-color: #97973e;\r\n    top: 0;\r\n    left: 0;\r\n}\r\n\r\nli .bottom-corner {\r\n    position: absolute;\r\n    width: 6px;\r\n    height: 7px;\r\n    background-color: #97973e;\r\n    bottom: 0;\r\n    right: 0;\r\n}\r\n\r\nli.selected {\r\n    /* background-color: #d7bf62; */\r\n    border: 4px solid #ffff25;\r\n    margin-right: 20px;\r\n}\r\n\r\nli.selected .top-corner {\r\n    background-color: #ffff25;\r\n}\r\n\r\nli.selected .bottom-corner {\r\n    background-color: #ffff25;\r\n}\r\n\r\nli img {\r\n    width: 60px;\r\n    height: 60px;\r\n    margin-right: 6px;\r\n}\r\n\r\n.details {\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.stats {\r\n    color: #b3b397;\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.stats .icon {\r\n    width: 30px;\r\n    height: 30px;\r\n    margin-right: 8px;\r\n}\r\n\r\n.stats .hp {\r\n    color: #e16dbe;\r\n    font-weight: 700;\r\n}\r\n\r\n.stats .armour {\r\n    color: #becfe5;\r\n    font-weight: 700;\r\n}\r\n\r\n.stats .qi {\r\n    color: #ffd11f;\r\n    font-weight: 700;\r\n}\r\n</style>","import script from \"./UnitProfile.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./UnitProfile.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./UnitProfile.vue?vue&type=style&index=0&id=4b1b6481&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4b1b6481\"]])\n\nexport default __exports__","<template>\r\n    <ul id=\"turnStack\">\r\n        <template v-for=\"(unit, i) in units()\" :key=\"i\">\r\n            <UnitProfile \r\n                v-if=\"visible[unit.data.at.y][unit.data.at.x]\" \r\n                :unit=\"unit\" \r\n                :selected=\"selected(unit)\"\r\n            />\r\n        </template>\r\n    </ul>\r\n</template>\r\n\r\n<script setup>\r\nimport { visible } from '../visibility';\r\nimport { getStackUnits } from './turnStack';\r\nimport { currentTurnUnit } from '../units/units';\r\nimport UnitProfile from '../units/UnitProfile.vue';\r\n\r\nconst units = () => getStackUnits();\r\nconst selected = (unit) => currentTurnUnit.value?.name === unit.name;\r\n</script>\r\n\r\n<style scoped>\r\nul#turnStack {\r\n    list-style-type: none;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: right;\r\n    align-items: flex-end;\r\n    margin-right: 4px;\r\n}\r\n\r\nul#turnStack li {\r\n    background-color: #3f3d3d;\r\n    /* background-color: #b1b1e9; */\r\n    padding: 8px 8px;\r\n    font-size: 20px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n    /* border: 4px solid #696990; */\r\n    margin-bottom: 5px;\r\n    /* width: 60px; */\r\n    display: flex;\r\n    flex-direction: row;\r\n\r\n    width: 220px;\r\n    color: #e7e7c8;\r\n}\r\n\r\nul#turnStack li.selected {\r\n    /* background-color: #d7bf62; */\r\n    border: 4px solid #ffff25;\r\n    width: 240px;\r\n}\r\n\r\nul#turnStack li img {\r\n    width: 60px;\r\n    height: 60px;\r\n    margin-right: 6px;\r\n}\r\n\r\n/* ul#turnStack li.selected img {\r\n    width: 60px;\r\n    height: 60px;\r\n} */\r\n</style>","import script from \"./TurnStack.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./TurnStack.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./TurnStack.vue?vue&type=style&index=0&id=227a66bb&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-227a66bb\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"guide\" v-if=\"show()\" :style=\"getStyle()\">\r\n        <img src=\"player_profile.png\" />\r\n        <span>{{ getTooltip().text }}</span>\r\n        <span :class=\"['arrow', getTooltip().direction]\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { hasTooltip, getTooltip } from './guide';\r\nimport { hasDialog } from '@/dialog/dialog';\r\nimport { defineProps } from 'vue';\r\nimport { TargetType } from '@/level/constants';\r\n\r\nconst props = defineProps({\r\n    target: TargetType,\r\n    name: String\r\n});\r\n\r\nconst show = () => \r\n    hasTooltip() \r\n    && !hasDialog() \r\n    && getTooltip().target === props.target \r\n    && getTooltip().targetName === props.name;\r\n\r\n\r\nconst getStyle = () => `top: ${getTooltip().location.top}px; left: ${getTooltip().location.left}px; width: ${getTooltip().width ?? 200}px`;\r\n</script>\r\n\r\n<style scoped>\r\n.guide {\r\n    background-color: #e7e7c8;\r\n    height: 40px;\r\n    width: 200px;\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    padding: 8px;\r\n\r\n    position: absolute;\r\n    /* top: 290px;\r\n    left: 240px; */\r\n    z-index: 10;\r\n    box-shadow: 1px 1px 5px black;\r\n}\r\n\r\n.guide img {\r\n    width: 40px;\r\n    height: 40px;\r\n    margin-right: 10px;\r\n}\r\n\r\n.guide span {\r\n    font-size: 18px;\r\n    color: #308c16;\r\n}\r\n\r\n.guide .arrow {\r\n    width: 20px;\r\n    height: 20px;\r\n    background-color: #e7e7c8;\r\n    position: absolute;\r\n    transform: rotate(45deg);\r\n\r\n    z-index: 1;\r\n}\r\n\r\n.arrow.left {\r\n    left: -10px;\r\n}\r\n\r\n.arrow.bottom {\r\n    bottom: -10px;\r\n    left: 40px;\r\n}\r\n\r\n.arrow.bottom-right {\r\n    right: 40px;\r\n    bottom: -10px;\r\n}\r\n</style>","import script from \"./ToolTip.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ToolTip.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ToolTip.vue?vue&type=style&index=0&id=75c8e7bd&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-75c8e7bd\"]])\n\nexport default __exports__","<template>\r\n    <span :class=\"classes()\" @click=\"() => clickAction(props.action)\">\r\n        <img :src=\"props.action.img\"/>\r\n        <ToolTip target=\"action\" :name=\"props.action.label\"/>\r\n    </span>\r\n</template>\r\n\r\n<script setup>\r\nimport ToolTip from '../guide/ToolTip.vue';\r\nimport { defineProps } from 'vue';\r\nimport { isCurrentAction, Action, clickAction } from './actions';\r\n\r\nconst props = defineProps({\r\n    action: {\r\n        type: Action,\r\n        required: true\r\n    }\r\n});\r\n\r\nconst classes = () => ['action', isCurrentAction(props.action) ? 'selected' : '', props.action.corners];\r\n</script>\r\n\r\n<style scoped>\r\n.action {\r\n    font-size: 16px;\r\n    width: 120px;\r\n    height: 120px;\r\n    /* border: 1px solid black; */\r\n    border-radius: 60px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n    background-color: #fcf5bf;\r\n    pointer-events: auto;\r\n\r\n    border: solid 2px #6f6262;\r\n    position: relative;\r\n}\r\n\r\n.action.square {\r\n    border-radius: 10px;\r\n}\r\n\r\n.action.selected {\r\n    border: solid 5px white;\r\n}\r\n\r\n.action:hover {\r\n    cursor: pointer;\r\n    box-shadow: 0px 0px 20px white;\r\n}\r\n\r\n.action img {\r\n    width: 120px;\r\n    height: 120px;\r\n}\r\n</style>","import script from \"./ActionButton.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActionButton.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ActionButton.vue?vue&type=style&index=0&id=0f1e618d&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0f1e618d\"]])\n\nexport default __exports__","<template>\r\n    <div id=\"inventory\" :class=\"inventoryClasses()\" v-if=\"hasInventory()\">\r\n        <span :class=\"itemClasses(item)\" v-for=\"(item, index) in inventory()\" :key=\"index\" @click=\"clickInventory(item)\">\r\n            <img :src=\"itemImg(item.type)\" />\r\n            <span class=\"quantity\">{{  item.quantity }}</span>\r\n            <label>{{ item.type.title }}</label>\r\n        </span>\r\n        <h2>Inventory</h2>\r\n    </div>\r\n    \r\n</template>\r\n\r\n<script setup>\r\nimport { currentTurnUnit } from \"@/level/units/units\";\r\nimport { clickInventory, isSelectedInventoryItem, INVENTORY_ACTION } from \"@/level/items/inventory/inventory\";\r\nimport { isCurrentAction } from \"@/level/actions/actions\";\r\nimport { typeLookup } from \"../itemTypes\";\r\n\r\nconst inventory = () => currentTurnUnit.value?.inventory.items;\r\n\r\nconst hasInventory = () => currentTurnUnit.value?.inventory && !currentTurnUnit.value?.inventory.isEmpty();\r\n\r\nconst inventoryClasses = () => isCurrentAction(INVENTORY_ACTION) ? 'selected' : '';\r\n\r\nconst itemClasses = (item) => ['item', isSelectedInventoryItem(item) ? 'selected' : ''];\r\n\r\nconst itemImg = type => typeLookup[type].img.img.src;\r\n\r\n</script>\r\n\r\n<style scoped>\r\n/* Container */\r\n#inventory {\r\n    display: flex;\r\n    flex-direction: row-reverse;\r\n    background-color: #3f3d3d;\r\n    padding: 4px;\r\n    margin-right: 20px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n\r\n    pointer-events: auto;\r\n    gap: 8px;\r\n    position: relative;\r\n    min-width: 110px;\r\n    justify-content: center;\r\n}\r\n\r\n#inventory.selected {\r\n    border: 4px solid white;\r\n}\r\n\r\n#inventory h2 {\r\n    position: absolute;\r\n    top: -44px;\r\n    font-size: 18px;\r\n    background-color: #343333;\r\n    color: #e7e7c8;\r\n    padding: 0px 16px 4px 16px;\r\n    border-radius: 6px;\r\n    border: 2px solid #77772f;\r\n    z-index: -10;\r\n}\r\n\r\n#inventory.selected h2 {\r\n    border: 2px solid white;\r\n}\r\n\r\n\r\n/* Item */\r\n#inventory .item {\r\n    position: relative;\r\n    padding: 4px;\r\n    border-radius: 4px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    border: 4px solid #343333;\r\n}\r\n\r\n#inventory .item.selected {\r\n    border: 4px solid white;\r\n}\r\n\r\n#inventory .item:hover {\r\n    cursor: pointer;\r\n    box-shadow: 0px 0px 5px #97973e;\r\n}\r\n\r\n#inventory .item img {\r\n    width: 60px;\r\n    height: 60px;\r\n}\r\n\r\n#inventory .item label {\r\n    font-size: 10px;\r\n    color: #e7e7c8;\r\n    width: 60px;\r\n    text-align: center;\r\n}\r\n#inventory .item .quantity {\r\n    color: white;\r\n    position: absolute;\r\n    z-index: 10;\r\n    top: 4px;\r\n    right: 4px;\r\n\r\n    background-color: #08080873;\r\n    padding: 2px 4px;\r\n    border-radius: 4px;\r\n}\r\n</style>","import script from \"./InventoryPanel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./InventoryPanel.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./InventoryPanel.vue?vue&type=style&index=0&id=41d2713e&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-41d2713e\"]])\n\nexport default __exports__","<template>\r\n    <div id=\"formations\" v-if=\"hasFormations()\">\r\n        <span class=\"item\" v-for=\"(formation, index) in getFormations()\" :key=\"index\">\r\n            {{ formation.title }}\r\n            <span :class=\"['image', formation.status]\">\r\n                <img :src=\"formationImg(formation)\" />\r\n                <span :class=\"['corner', 'TL', formation.corners.TL?.dist > 0 ? 'active' : '']\">{{ formation.corners.TL?.dist }}</span>\r\n                <span :class=\"['corner', 'TR', formation.corners.TR?.dist > 0 ? 'active' : '']\">{{ formation.corners.TR?.dist }}</span>\r\n                <span :class=\"['corner', 'BL', formation.corners.BL?.dist > 0 ? 'active' : '']\">{{ formation.corners.BL?.dist }}</span>\r\n                <span :class=\"['corner', 'BR', formation.corners.BR?.dist > 0 ? 'active' : '']\">{{ formation.corners.BR?.dist }}</span>\r\n            </span>\r\n            \r\n            <button v-if=\"formation.status === FormationStatus.IDLE\" @click=\"activateFormation(formation.at)\">Activate</button>\r\n            <button v-else-if=\"formation.status === FormationStatus.ALIVE\" @click=\"deactivateFormation(formation.at)\">Deactivate</button>\r\n            <span v-else>Broken</span>\r\n        </span>\r\n        <h2>Formations</h2>\r\n    </div>\r\n    \r\n</template>\r\n\r\n<script setup>\r\nimport { hasFormations, getFormations, FormationStatus, activateFormation, deactivateFormation } from './formations';\r\nimport { typeLookup } from '../items/itemTypes';\r\n\r\nconst formationImg = (formation) => typeLookup[formation.type].img.img.src\r\n</script>\r\n\r\n<style scoped>\r\n#formations {\r\n    display: flex;\r\n    flex-direction: row-reverse;\r\n    background-color: #3f3d3d;\r\n    padding: 4px;\r\n    margin-right: 20px;\r\n    border-radius: 6px;\r\n    margin-top: 50px;\r\n    border: 4px solid #97973e;\r\n\r\n    pointer-events: auto;\r\n    gap: 8px;\r\n    position: relative;\r\n    min-width: 125px;\r\n    justify-content: center;\r\n}\r\n\r\n#formations h2 {\r\n    position: absolute;\r\n    top: -44px;\r\n    font-size: 18px;\r\n    background-color: #343333;\r\n    color: #e7e7c8;\r\n    padding: 0px 16px 4px 16px;\r\n    border-radius: 6px;\r\n    border: 2px solid #77772f;\r\n    z-index: -10;\r\n}\r\n\r\n#formations .item {\r\n    position: relative;\r\n    padding: 4px;\r\n    border-radius: 4px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    border: 1px solid #343333;\r\n    align-items: center;\r\n\r\n    color: #e7e7c8;\r\n}\r\n\r\n#formations img {\r\n    width: 60px;\r\n    height: 60px;\r\n    box-shadow: 0 0 20px #496107;\r\n}\r\n\r\n#formations .item .image {\r\n    position: relative;\r\n    padding: 4px;\r\n    width: 60px;\r\n    height: 60px;\r\n}\r\n\r\n#formations .item .image.Idle img {\r\n    box-shadow: 0 0 20px #f9ffe7;\r\n}\r\n\r\n#formations .item .image.Alive img {\r\n    box-shadow: 0 0 40px #bf0;\r\n}\r\n\r\n#formations .item .image .corner {\r\n    position: absolute;\r\n    background-color: #655c5c;\r\n    border-radius: 10px;\r\n    width: 20px;\r\n    height: 20px;\r\n    text-align: center;\r\n    display: inline-block;\r\n    color: #e10505;\r\n    font-weight: 700;\r\n}\r\n\r\n#formations .item .image .corner.active {\r\n    background-color: white;\r\n}\r\n\r\n.TL {\r\n    top: 0;\r\n    left: 0;\r\n}\r\n\r\n.TR {\r\n    top: 0;\r\n    right: 0;\r\n}\r\n\r\n.BL {\r\n    bottom: 0;\r\n    left: 0;\r\n}\r\n\r\n.BR {\r\n    bottom: 0;\r\n    right: 0;\r\n}\r\n\r\n#formations button {\r\n    font-size: 16px;\r\n    padding: 2px 8px;\r\n    margin-top: 10px;\r\n    background-color: #b2a89c;\r\n}\r\n</style>","import script from \"./FormationsPanel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./FormationsPanel.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./FormationsPanel.vue?vue&type=style&index=0&id=465a3afe&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-465a3afe\"]])\n\nexport default __exports__","import { Ref, ref } from \"vue\";\r\nimport { restoreMap, saveMap } from \"../map/map\";\r\nimport { doMove, restoreUnits, saveUnits } from \"../units/units\";\r\nimport { restoreItems, saveItems } from \"../items/items\";\r\nimport { restoreFormations, saveFormations } from \"../formations/formations\";\r\nimport { currentStackUnit, restoreStack, saveStack } from \"../turn-stack/turnStack\";\r\nimport { restoreGuides, saveGuides } from \"../guide/guide\";\r\nimport { restoreMapped, saveMapped } from \"../visibility\";\r\nimport { render } from \"../canvas\";\r\nimport { restoreEffects, saveEffects } from \"../effects/effects\";\r\nimport { restoreGameStatus } from \"../gameStatus\";\r\n\r\ntype SavedProgress = {\r\n    time: string,\r\n    map: string,\r\n    units: string,\r\n    items: string,\r\n    formations: string,\r\n    stack: string,\r\n    effects: string,\r\n    guides: string,\r\n    mapped: string\r\n}\r\n\r\nconst saves: Ref<SavedProgress[]> = ref([]);\r\n\r\nexport const addSave = () => {\r\n    const savedMap = saveMap();\r\n    const savedUnits = saveUnits();\r\n    const savedItems = saveItems();\r\n    const savedFormations = saveFormations();\r\n    const savedStack = saveStack();\r\n    const savedEffects = saveEffects();\r\n    const savedGuides = saveGuides();\r\n    const savedMapped = saveMapped();\r\n\r\n    const time = saves.value.length + 1 + ' - ' + new Date().toLocaleString().split(', ')[1]; \r\n\r\n    const currentProgress = {\r\n        time,\r\n        map: savedMap,\r\n        units: savedUnits,\r\n        items: savedItems,\r\n        formations: savedFormations,\r\n        stack: savedStack,\r\n        effects: savedEffects,\r\n        guides: savedGuides,\r\n        mapped: savedMapped\r\n    }\r\n    console.log(currentProgress);\r\n\r\n    saves.value.push(currentProgress);\r\n}\r\n\r\nexport const hasSaves = (): boolean => saves.value.length > 0;\r\n\r\nexport const getSaves = () => saves.value.map(save => save.time);\r\n\r\nexport const restoreSave = (time: string) => {\r\n    console.log(`restoring ${time}`);\r\n    const save = saves.value.find(save => save.time === time);\r\n\r\n    if (save) {\r\n        restoreGameStatus();\r\n        restoreMap(save.map);\r\n        restoreUnits(save.units);\r\n        restoreStack(save.stack);\r\n        restoreItems(save.items);\r\n        restoreFormations(save.formations);\r\n        restoreEffects(save.effects);\r\n        restoreMapped(save.mapped);\r\n        restoreGuides(save.guides);\r\n        doMove(currentStackUnit());\r\n        render();\r\n    }\r\n}","import script from \"./ListOfSaves.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ListOfSaves.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ListOfSaves.vue?vue&type=style&index=0&id=40028361&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-40028361\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"progress\">\r\n        <span class=\"save\" @click=\"addSave\">\r\n            <label>Save Progress</label>\r\n            <img class=\"icon\" src=\"save.png\" />\r\n        </span>\r\n        <span class=\"rewind\" v-if=\"hasSaves()\" @click=\"showSaves\">\r\n            <img class=\"icon\" src=\"rewind.png\" />\r\n        </span>\r\n    </div>\r\n    <ListOfSaves v-if=\"showingSaves\" />\r\n</template>\r\n\r\n<script setup>\r\nimport ListOfSaves from './ListOfSaves.vue';\r\nimport { addSave, hasSaves } from './saveProgress';\r\nimport { ref } from 'vue';\r\n\r\nconst showingSaves = ref(false);\r\n\r\nconst showSaves = () => showingSaves.value = !showingSaves.value;\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.progress {\r\n    margin-bottom: 40px;\r\n    margin-right: 16px;\r\n    pointer-events: auto;\r\n\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n}\r\n.progress .icon {\r\n    width: 50px;\r\n    height: 50px;\r\n}\r\n\r\n.progress .save {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n}\r\n\r\n.progress span:hover {\r\n    cursor: pointer;\r\n}\r\n\r\n.progress span:hover img {\r\n    box-shadow: 0px 0px 20px #8892cb;\r\n    border-radius: 16px;\r\n}\r\n\r\n.progress label {\r\n    /* color: #c0c2ce; */\r\n    color: #1a1a1c;\r\n    display: inline-block;\r\n    width: 60px;\r\n    text-align: right;\r\n    user-select: none;\r\n    margin-right: 10px;\r\n}\r\n\r\n.progress label:hover {\r\n    cursor: pointer;\r\n}\r\n\r\n.progress span:hover label {\r\n    color: #c0c2ce;\r\n}\r\n\r\n.rewind .icon {\r\n    width: 36px;\r\n    height: 36px;\r\n}\r\n\r\n.rewind {\r\n    padding: 4px;\r\n    cursor: pointer;\r\n}\r\n</style>","import script from \"./ProgressPanel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ProgressPanel.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ProgressPanel.vue?vue&type=style&index=0&id=46cab7ec&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-46cab7ec\"]])\n\nexport default __exports__","import script from \"./ActionButtons.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActionButtons.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ActionButtons.vue?vue&type=style&index=0&id=0c7ea1c6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0c7ea1c6\"]])\n\nexport default __exports__","import script from \"./GameOver.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./GameOver.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./GameOver.vue?vue&type=style&index=0&id=063f7ed5&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-063f7ed5\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"matte\">\r\n        \r\n        <slot></slot>\r\n\r\n    </div>\r\n</template>\r\n\r\n<style>\r\n.matte {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #aaaa;\r\n    z-index: 20;\r\n\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n</style>","import { render } from \"./ModalMatte.vue?vue&type=template&id=29f05ba6\"\nconst script = {}\n\nimport \"./ModalMatte.vue?vue&type=style&index=0&id=29f05ba6&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import script from \"./BaseModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./BaseModal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./BaseModal.vue?vue&type=style&index=0&id=a4e1fc00&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { xyd } from \"@/level/map/xyd\";\r\nimport { Ref, ref } from \"vue\";\r\n\r\nexport type ModalInput = {\r\n    title: string,\r\n    name: string,\r\n    value: string\r\n}\r\n\r\nexport type ModalDetails = {\r\n    inputs: ModalInput[],\r\n    title: () => string,\r\n    onSubmit: (at: xyd, inputs: ModalInput[]) => void\r\n}\r\n\r\nconst modalActive = ref(false);\r\nconst _modalDetails: Ref<ModalDetails | null> = ref(null);\r\nlet _at: xyd | null = null;\r\n\r\nexport const isModalActive = () => modalActive.value;\r\n\r\nexport const getInputs = () => _modalDetails.value?.inputs;\r\n\r\nexport const getTitle = () => _modalDetails.value?.title();\r\n\r\nexport const startModal = (modalDetails: ModalDetails, at: xyd) => {\r\n    console.log(`action modal: ${JSON.stringify(modalDetails)}`);\r\n    modalActive.value = true;\r\n    _modalDetails.value = modalDetails;\r\n    _at = JSON.parse(JSON.stringify(at));\r\n}\r\n\r\nexport const submitModal = () => {\r\n    modalActive.value = false;\r\n    if (_modalDetails.value && _at) {\r\n        _modalDetails.value.onSubmit(_at, _modalDetails.value.inputs);\r\n    }\r\n}\r\n\r\nexport const cancelModal = () => {\r\n    modalActive.value = false;\r\n}","import script from \"./ActionModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActionModal.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n    <div id=\"levelCanvas\">\r\n        <canvas\r\n            id=\"myCanvas\"\r\n            :class=\"canvasClass()\"\r\n            @click=\"clickCanvas\"\r\n            @keyup.down=\"shiftDown\"\r\n            @keyup.up=\"shiftUp\"\r\n            @keyup.left=\"shiftLeft\"\r\n            @keyup.right=\"shiftRight\"\r\n        ></canvas>\r\n        <ToolTip target=\"canvas\" name=\"canvas\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { shiftDown, shiftLeft, shiftRight, shiftUp } from './canvas';\r\nimport { clickCanvas, mouseHover } from './mouseHandler';\r\nimport ToolTip from './guide/ToolTip.vue';\r\n\r\nconst canvasClass = () => mouseHover.value === true ? 'mouseHover' : '';\r\n</script>\r\n\r\n<style scoped>\r\n#levelCanvas {\r\n    position: relative;\r\n}\r\n\r\n#myCanvas, #levelCanvas {\r\n    margin: 20px;\r\n    width: 1000px;\r\n    height: 1000px;\r\n    box-sizing: border-box;\r\n}\r\n\r\n#myCanvas.mouseHover {\r\n    cursor: pointer;\r\n}\r\n</style>","import script from \"./LevelCanvas.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LevelCanvas.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LevelCanvas.vue?vue&type=style&index=0&id=4b233009&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4b233009\"]])\n\nexport default __exports__","import script from \"./BattleModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./BattleModal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./BattleModal.vue?vue&type=style&index=0&id=4a48c0b9&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4a48c0b9\"]])\n\nexport default __exports__","<template>\r\n    <LevelCanvas />\r\n    \r\n    <GameHud>\r\n        <TurnStack></TurnStack>\r\n        <ActionButtons></ActionButtons>\r\n    </GameHud>\r\n    <ActionModal />\r\n    <BattleModal />\r\n    <!-- <button @click=\"shiftLeft\"></button>\r\n    <button @click=\"shiftUp\"></button>\r\n    <button @click=\"shiftRight\"></button>\r\n    <button @click=\"shiftDown\"></button> -->\r\n    <GameOver />\r\n</template>\r\n\r\n<script setup>\r\nimport GameHud from './components/GameHud.vue';\r\nimport TurnStack from './turn-stack/TurnStack.vue';\r\nimport ActionButtons from './actions/ActionButtons.vue';\r\nimport GameOver from './components/GameOver.vue';\r\nimport ActionModal from './actions/ActionModal.vue';\r\nimport LevelCanvas from './LevelCanvas.vue';\r\nimport BattleModal from './battle/BattleModal.vue';\r\nimport { onMounted } from 'vue';\r\nimport { initCanvas, shiftDown, shiftLeft, shiftRight, shiftUp } from './canvas';\r\nimport { initImages } from '@/imageLoader';\r\nimport { initUnits, startPlayerTurn } from './units/units';\r\nimport { placeItem } from \"@/level/items/items\";\r\nimport { initVisibility } from \"@/level/visibility\";\r\nimport { initGuides } from '@/level/guide/levelGuides';\r\nimport { SPIDER_BAIT } from '@/level/items/itemTypes';\r\n// import { LIGHTNING_FLAG } from './items/inventory/inventory';\r\n\r\nonMounted(() => {\r\n    initImages();\r\n    initUnits();\r\n    initVisibility();\r\n    // initCharacter();\r\n    placeItem(SPIDER_BAIT, {x: 1, y: 1});\r\n    placeItem(SPIDER_BAIT, {x: 5, y: 6});\r\n    placeItem(SPIDER_BAIT, {x: 3, y: 1});\r\n    // placeItem(LIGHTNING_FLAG, {x: 5, y: 1});\r\n    // placeItem(LIGHTNING_FLAG, {x: 7, y: 1});\r\n    // placeItem(LIGHTNING_FLAG, {x: 5, y: 3});\r\n    // placeItem(LIGHTNING_FLAG, {x: 7, y: 3});\r\n    startPlayerTurn();\r\n    initCanvas();\r\n    initGuides();\r\n});\r\n\r\ndocument.addEventListener('keydown', (event) => {\r\n  switch (event.key) {\r\n    case 'ArrowUp':\r\n        shiftUp();\r\n        return;\r\n    case 'ArrowDown':\r\n        shiftDown();\r\n        return;\r\n    case 'ArrowLeft':\r\n        shiftLeft();\r\n        return;\r\n    case 'ArrowRight':\r\n        shiftRight();\r\n        return;\r\n  }\r\n}, false);\r\n\r\n</script>\r\n\r\n<style>\r\nbutton {\r\n    font-size: 40px;\r\n}\r\n</style>","import script from \"./LevelContainer.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LevelContainer.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LevelContainer.vue?vue&type=style&index=0&id=4dac6dbd&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n    <ModalMatte v-if=\"hasDialog()\" @click=\"next\">\r\n        <div class=\"dialog\">\r\n            <span class=\"image\">\r\n                <img :src=\"getDialog().profileImg\" />\r\n            </span>\r\n            <span class=\"text\">\r\n                <span class=\"name\">{{ getDialog().name }}</span>\r\n                <span class=\"speech\">{{ getDialog().speech }}</span>\r\n            </span>\r\n        </div>\r\n    </ModalMatte>\r\n</template>\r\n\r\n<script setup>\r\nimport { hasDialog, getDialog, dialogNext } from './dialog';\r\nimport ModalMatte from '../modal/ModalMatte.vue'\r\n\r\nconst next = () => {\r\n    dialogNext();\r\n}\r\n</script>\r\n\r\n<style>\r\n.matte {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #aaaa;\r\n    z-index: 20;\r\n\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n\r\n    cursor: pointer;\r\n}\r\n\r\n.dialog {\r\n    position: relative;\r\n    display: flex;\r\n    flex-direction: column;\r\n    user-select: none;\r\n}\r\n\r\n.text {\r\n    background-color: #3f3d3d;\r\n    padding: 12px 18px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n    color: #e7e7c8;\r\n    width: 500px;\r\n    font-size: 20px;\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.name {\r\n    font-weight: 700;\r\n    margin-bottom: 8px;\r\n    color: #e7e7de;\r\n}\r\n\r\n.image {\r\n    margin-bottom: -5px;\r\n}\r\n\r\nimg {\r\n    height: 500px;\r\n}\r\n</style>","import script from \"./DialogModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./DialogModal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./DialogModal.vue?vue&type=style&index=0&id=3ea63e25&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import script from \"./App.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=c0f79cae&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","export const showHelp = true;\r\n// export const showHelp = false;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkrpggame\"] = self[\"webpackChunkrpggame\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [998], function() { return __webpack_require__(1028); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["dialog","ref","introDialog","dialogList","hasDialog","undefined","value","showHelp","getDialog","dialogNext","length","splice","guideTick","setDialog","_dialog","initImg","img","loaded","loadImg","image","imgLoc","Image","src","onload","images","floor","cave","w2","character","spider","mouse","lightningFlag","formationPlate","animalCorpse","lightning1","lightning2","lightning3","lightning4","waiting","attacking","walking","talking","exiting","summonMouse","recallMouse","profileImg","profileCold","profileReading","checkLoaded","imgs","Object","values","notLoaded","filter","numNotLoaded","setTimeout","render","IMG_FLOOR","IMG_CAVE","IMG_WALL","IMG_CHARACTER","IMG_SPIDER","IMG_MOUSE","IMG_LIGHTNING_FLAG","IMG_FORMATION_PLATE","IMG_LIZARD","IMG_LIGHTNING_1","IMG_LIGHTNING_2","IMG_LIGHTNING_3","IMG_LIGHTNING_4","IMG_WAITING","IMG_ATTACKING","IMG_WALKING","IMG_TAKING","IMG_EXITING","IMG_SUMMON_MOUSE","IMG_RECALL_MOUSE","IMG_PROFILE_IMG","IMG_PROFILE_COLD","IMG_PROFILE_READING","initImages","actionAt","currentAction","WALK_ACTION","currentActionColour","range","colour","isCurrentAction","action","label","getActionAt","x","y","find","_actionAt","clickAction","clearMoveTo","findRangeAround","currentTurnUnit","data","at","validator","SpaceCheckerFunction","EMPTY_SPACE","performAction","d","console","log","energy","nextUnitTurn","perform","precondition","isGameOver","findPlayerVisible","getCurrentActions","unit","actions","WAIT_ACTION","ATTACK_ACTION","ENEMY_UNIT","ATTACK_HOVER_COLOUR","playerUnit","player","attackUnit","MOVEMENT_HOVER_COLOUR","JSON","parse","stringify","PICK_UP_ACTION","ITEM","item","takeItem","takeInventoryItem","EXIT_LEVEL_ACTION","corners","CORNER","SQUARE","gameOver","hasEnemies","SUMMON_LABEL","DEPLOYED_ATTRIBUTE","SUMMON_SPIRIT_FRIEND_ACTION","meta","addUnit","createUnit","UnitType","MOUSE","this","RECALL_SPIRIT_FRIEND_ACTION","removeUnit","hasStackUnit","inBattle","isInBattle","startBattle","damage","attacker","defender","battleDetails","startAnimation","hasAttacker","endBattle","defenderImg","attackerImg","animationRate","leftStyle","rightStyle","rightFloorStyle","top","height","center","drawLeftSide","drawRightSide","attackerStartCharge","lightningAttack","attackerCompleteCharge","defenderReceiveAttack","rebound","defenderReturnToNormal","endAnimation","dpi","CELL_SIZE","offset","getCanvas","document","getElementById","setCanvasForDpi","canvas","window","devicePixelRatio","style_height","getComputedStyle","getPropertyValue","slice","style_width","setAttribute","initCanvas","addEventListener","mouseMoveListener","setInterval","animations","phase","ctx","getContext","effect","effects","drawCell","darkenIfNotVisible","fn","save","visible","restore","drawImage","drawOversiedImage","drawStandingImage","drawWallImage","btmImg","topImg","transparent","globalAlpha","drawUnit","imgType","IMG_TYPE","STANDING","OVERSIZED","font","fillStyle","fillText","armour","hp","qi","clearRect","width","drawCells","map","mapped","drawActionAtBg","drawCurrentUnitBg","drawItems","drawUnits","drawEffects","drawCursor","eqXy","CURRENT_UNIT_COLOUR","fillRect","units","drawItem","type","items","drawEffect","EffectType","LIGHTNING","mouseAt","lineWidth","strokeStyle","beginPath","rect","stroke","some","loc","shiftRight","shiftLeft","shiftUp","shiftDown","GuideType","GuideDirection","TargetType","addEffect","source","push","clearEffect","findEffectsForSource","saveEffects","restoreEffects","savedEffects","FormationStatus","formationUnit","title","name","movement","autoMove","unitAtEffect","unitAt","power","formations","findFormationUnit","formation","addFormation","newFormation","status","IDLE","checkFormationCorners","TL","TR","BL","BR","BROKEN","updateFormations","removeFormation","findIndex","f","hasFormations","getFormations","activateFormation","ALIVE","applyEffects","addStackUnit","applyEffectsTL","cornerAt","formationAt","applyEffectsTR","applyEffectsBL","applyEffectsBR","deactivateFormation","removeStackUnitKeepCurrent","category","ItemCategory","FLAG","xdiff","ydiff","Math","abs","dist","saveFormations","savedState","restoreFormations","savedFormations","GameStatus","IN_PROGRESS","gameOverMessage","gameOverImage","GAME_OVER_DEFEAT","gameOverMsg","gameOverImg","message","GAME_OVER","restoreGameStatus","guides","allGuides","guideText","getGuide","hasTooltip","TOOLTIP","tooltip","getTooltip","setGuides","_guides","itemVisible","itemTitle","unitVisible","unitName","createGameState","playerTeam","u","c","SPIDER_BAIT","gameState","finished","i","ready","DIALOG","guideToString","toString","stringToGuide","eval","saveGuides","converedGuideText","restoreGuides","savedGuides","convertedGuides","NAME","speech","movementGuide","text","direction","LEFT","location","left","target","CANVAS","targetName","gs","baitDialog","baitTooltip","pickupTooltip","BOTTOM","ACTION","inventory","quantity","spyDialog","spyTooltip","ga","spiderDialog","formationPlateDialog","formationCompleteDialog","spiderDeadDialog","exitTooltip","BOTTOM_RIGHT","initGuides","selectedInventoryItem","Inventory","constructor","inItems","_defineProperty","removeItem","foundItem","findItem","_item","addItem","isEmpty","placeInventoryItem","placeItem","LIGHTNING_FLAG","FORMATION","INVENTORY_ACTION","FORMATION_PLATE","isSelectedInventoryItem","clickInventory","typeLookup","NORMAL","_items","mapStoredToPlacedItem","saveItems","restoreItems","savedItems","LEVEL1","saveMap","restoreMap","savedMap","at1","at2","EMPTY_SPACE_CHECKER","ENEMY_UNIT_CHECKER","team","Team","MONSTER","WALL_CHECKER","ITEM_CHECKER","findFreeSpaceAround","around","validateFn","_validateFn","findSpaceAroundInternal","doValidate","WALL","existingSpaces","spacesAround","iterx","itery","move","spaces1","space","buildXyd","n","iter","spaces","concat","mouseHover","event","getBoundingClientRect","clientX","clientY","checkForHover","mouseOverMoveTo","mouseOverActionAt","moveTo","clickCanvas","moveCharacter","turnStack","turnIndex","nextStackUnit","newIndex","currentStackUnit","includes","stackIndex","indexOf","removeStackUnit","initStack","getStackUnits","saveStack","stack","index","restoreStack","savedStack","saved","PLAYER_NAME","PLAYER","isNextTo","from","to","visibleToLocations","locations","findSpaceClosestTo","moves","visibleMoves","visibleLocations","attackableLocations","closestAttack","closestMove","closestDistance","distance","attack","boss","identifyTarget","_player","baits","bait","charge","closest","idleWalk","randomChoice","random","toX","toY","bossMove","findVisibleTo","bossUnit","SPIDER","mouseUnit","initUnits","unitIndex","computed","currentUnit","doMove","startPlayerTurn","targetLocation","attackee","remainingPower","saveUnits","actionsMeta","restoreUnits","savedUnits","parsedUnits","_unit","actionMeta","foundAction","initVisibility","_visible","followRight","followLeft","followUp","followDown","followUpLeft","followDownRight","followUpRight","followDownLeft","cangoLeft","cangoUp","cangoRight","cangoDown","canMove","saveMapped","restoreMapped","savedMapped","id","_createElementBlock","_hoisted_1","_renderSlot","_ctx","$slots","script","__exports__","classes","props","selected","show","getStyle","hasInventory","inventoryClasses","itemClasses","itemImg","formationImg","saves","addSave","time","Date","toLocaleString","split","currentProgress","hasSaves","getSaves","restoreSave","showingSaves","showSaves","class","modalActive","_modalDetails","_at","isModalActive","getInputs","inputs","getTitle","submitModal","onSubmit","cancelModal","canvasClass","onMounted","key","next","createApp","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","m","deferred","O","result","chunkIds","priority","notFulfilled","Infinity","fulfilled","j","keys","every","r","getter","__esModule","a","definition","o","defineProperty","enumerable","get","g","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","self","forEach","bind","__webpack_exports__"],"sourceRoot":""}