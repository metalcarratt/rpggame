{"version":3,"file":"js/app.f420ec51.js","mappings":"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","sources":["webpack://rpggame/./src/level/components/GameHud.vue","webpack://rpggame/./src/level/components/GameHud.vue?35ea","webpack://rpggame/./src/imageLoader.ts","webpack://rpggame/./src/level/constants.ts","webpack://rpggame/./src/level/items/items.ts","webpack://rpggame/./src/level/effects/effects.ts","webpack://rpggame/./src/level/units/turnStack.ts","webpack://rpggame/./src/level/map/util/eqXy.ts","webpack://rpggame/./src/level/formations/formations.ts","webpack://rpggame/./src/level/map/util/findAround.ts","webpack://rpggame/./src/level/items/inventory/inventory.ts","webpack://rpggame/./src/level/gameStatus.ts","webpack://rpggame/./src/level/actions/commonActions.ts","webpack://rpggame/./src/level/units/spiritUnit.ts","webpack://rpggame/./src/level/actions/spiritFriend.ts","webpack://rpggame/./src/level/units/playerUnit.ts","webpack://rpggame/./src/level/moving.ts","webpack://rpggame/./src/level/items/randomItems.ts","webpack://rpggame/./src/level/map/util/isNextTo.ts","webpack://rpggame/./src/level/map/util/findSpace.ts","webpack://rpggame/./src/level/units/spiderUnit.ts","webpack://rpggame/./src/level/guide/levelGuides.ts","webpack://rpggame/./src/settings.ts","webpack://rpggame/./src/dialog/dialog.ts","webpack://rpggame/./src/level/guide/guide.ts","webpack://rpggame/./src/level/battle/battle.ts","webpack://rpggame/./src/level/units/units.ts","webpack://rpggame/./src/level/mouseHandler.ts","webpack://rpggame/./src/level/canvas.ts","webpack://rpggame/./src/level/actions/actions.ts","webpack://rpggame/./src/level/map/map.ts","webpack://rpggame/./src/level/visibility.ts","webpack://rpggame/./src/level/units/UnitProfile.vue","webpack://rpggame/./src/level/units/UnitProfile.vue?ad7a","webpack://rpggame/./src/level/units/TurnStack.vue","webpack://rpggame/./src/level/units/TurnStack.vue?ec2d","webpack://rpggame/./src/level/guide/ToolTip.vue","webpack://rpggame/./src/level/guide/ToolTip.vue?c5e1","webpack://rpggame/./src/level/actions/ActionButton.vue","webpack://rpggame/./src/level/actions/ActionButton.vue?bb35","webpack://rpggame/./src/level/items/inventory/InventoryPanel.vue","webpack://rpggame/./src/level/items/inventory/InventoryPanel.vue?ea20","webpack://rpggame/./src/level/formations/FormationsPanel.vue","webpack://rpggame/./src/level/actions/ActionButtons.vue","webpack://rpggame/./src/level/components/GameOver.vue","webpack://rpggame/./src/modal/ModalMatte.vue","webpack://rpggame/./src/modal/ModalMatte.vue?7742","webpack://rpggame/./src/modal/BaseModal.vue","webpack://rpggame/./src/modal/modal.ts","webpack://rpggame/./src/level/actions/ActionModal.vue","webpack://rpggame/./src/level/LevelCanvas.vue","webpack://rpggame/./src/level/LevelCanvas.vue?cfdc","webpack://rpggame/./src/level/battle/BattleModal.vue","webpack://rpggame/./src/level/LevelContainer.vue","webpack://rpggame/./src/level/LevelContainer.vue?d03d","webpack://rpggame/./src/dialog/DialogModal.vue","webpack://rpggame/./src/dialog/DialogModal.vue?4e0e","webpack://rpggame/./src/App.vue","webpack://rpggame/./src/main.ts","webpack://rpggame/webpack/bootstrap","webpack://rpggame/webpack/runtime/chunk loaded","webpack://rpggame/webpack/runtime/compat get default export","webpack://rpggame/webpack/runtime/define property getters","webpack://rpggame/webpack/runtime/global","webpack://rpggame/webpack/runtime/hasOwnProperty shorthand","webpack://rpggame/webpack/runtime/make namespace object","webpack://rpggame/webpack/runtime/jsonp chunk loading","webpack://rpggame/webpack/startup"],"sourcesContent":["<template>\r\n    <div id=\"hud\">\r\n        <slot></slot>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n#hud {\r\n    width: 100%;\r\n    height: 100%;\r\n    position: absolute;\r\n    top: 0;\r\n    z-index: 10;\r\n    pointer-events: none;\r\n\r\n    /* for now */\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n}\r\n</style>","import { render } from \"./GameHud.vue?vue&type=template&id=52a7fc1f&scoped=true\"\nconst script = {}\n\nimport \"./GameHud.vue?vue&type=style&index=0&id=52a7fc1f&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-52a7fc1f\"]])\n\nexport default __exports__","import { render } from \"./level/canvas\";\r\n\r\nexport type imgData = {\r\n    img: null | HTMLImageElement,\r\n    loaded: boolean\r\n}\r\n\r\nconst initImg = (): imgData => ({\r\n    img: null,\r\n    loaded: false\r\n});\r\n\r\nconst loadImg = (image: imgData, imgLoc: string) => {\r\n    image.img = new Image();\r\n    image.img.src = imgLoc;\r\n    image.img.onload = () => image.loaded = true;\r\n}\r\n\r\nexport const images = {\r\n    floor: initImg(),\r\n    cave: initImg(),\r\n    w2: initImg(),\r\n    character: initImg(),\r\n    spider: initImg(),\r\n    mouse: initImg(),\r\n    lightningFlag: initImg(),\r\n    formationPlate: initImg(),\r\n    animalCorpse: initImg(),\r\n    lightning1: initImg(),\r\n    lightning2: initImg(),\r\n    lightning3: initImg(),\r\n    lightning4: initImg(),\r\n}\r\n\r\nconst checkLoaded = () => {\r\n    const imgs = Object.values(images);\r\n    // console.log(`imgs: ${JSON.stringify(imgs)}`);\r\n    const notLoaded = imgs.filter(img => !img.loaded);\r\n    // console.log(`notLoaded: ${JSON.stringify(notLoaded)}`);\r\n    const numNotLoaded = notLoaded.length;\r\n    // console.log(`numNotLoaded: ${numNotLoaded}`);\r\n    if (numNotLoaded > 0) {\r\n        setTimeout(checkLoaded, 100);\r\n        return;\r\n    }\r\n\r\n    render();\r\n}\r\n\r\nexport function initImages() {\r\n    loadImg(images.floor, '../f1.jpg');\r\n    loadImg(images.cave, '../t1.png');\r\n    loadImg(images.w2, '../ww.jpg');\r\n    loadImg(images.character, '../ch.png');\r\n    loadImg(images.spider, '../spider2.png');\r\n    loadImg(images.mouse, '../mouse.png');\r\n    loadImg(images.lightningFlag, '../lightning_flag.png');\r\n    loadImg(images.formationPlate, '../formation_plate.png');\r\n    loadImg(images.animalCorpse, '../lizard.png');\r\n    loadImg(images.lightning1, '../effect_lightning_1.png');\r\n    loadImg(images.lightning2, '../effect_lightning_2.png');\r\n    loadImg(images.lightning3, '../effect_lightning_3.png');\r\n    loadImg(images.lightning4, '../effect_lightning_4.png');\r\n    checkLoaded();\r\n}","export const MOVEMENT_HOVER_COLOUR = 'rgba(255, 98, 164, 0.3)';\r\nexport const ATTACK_HOVER_COLOUR = 'rgba(143, 50, 168, 0.3)';\r\nexport const CURRENT_UNIT_COLOUR = 'rgb(20, 19, 242, 0.3)';\r\nexport enum CORNER {\r\n    SQUARE = 'square',\r\n    ROUND = 'round'\r\n}\r\n\r\nexport enum IMG_TYPE {\r\n    NORMAL,\r\n    STANDING,\r\n    OVERSIZED\r\n}\r\n\r\nexport enum GuideType {\r\n    TOOLTIP,\r\n    DIALOG\r\n}\r\n\r\nexport enum GuideDirection {\r\n    LEFT = 'left',\r\n    BOTTOM_RIGHT = 'bottom-right',\r\n    BOTTOM = 'bottom'\r\n}\r\n\r\nexport const enum TargetType {\r\n    CANVAS = 'canvas',\r\n    ACTION = 'action'\r\n}","import { imgData } from \"../../imageLoader\";\r\nimport { Ref, ref } from 'vue';\r\nimport { xy } from \"../map/xy\";\r\n\r\nexport type ItemType = {\r\n    img: imgData,\r\n    title: string,\r\n    category: ItemCategory\r\n}\r\n\r\nexport enum ItemCategory {\r\n    NORMAL,\r\n    FORMATION,\r\n    FLAG\r\n}\r\n\r\nexport type PlacedItem = {\r\n    type: ItemType,\r\n    at: xy\r\n}\r\n\r\nconst _items: Ref<PlacedItem[]> = ref([]);\r\n\r\nexport const items = () => _items.value;\r\n\r\nexport const placeItem = (item: ItemType, at: xy) => {\r\n    _items.value.push({\r\n        type: item,\r\n        at\r\n    });\r\n}\r\n\r\nexport const takeItem = (at: xy) => {\r\n    return _items.value.splice(_items.value.findIndex(item => item.at.x === at.x && item.at.y === at.y), 1)[0];\r\n}","import { xy } from \"../map/xy\";\r\n\r\nexport type Effect = {\r\n    at: xy,\r\n    type: EffectType,\r\n    source: xy\r\n}\r\n\r\nexport enum EffectType {\r\n    LIGHTNING\r\n}\r\n\r\nexport let effects: Effect[] = [\r\n    // {\r\n    //     at: {x: 2, y: 4},\r\n    //     type: EffectType.LIGHTNING,\r\n    //     source: {x: 0, y: 0}\r\n    // }\r\n];\r\n\r\nexport const addEffect = (at: xy, type: EffectType, source: xy) => {\r\n    if (!effects.find(effect => effect.at.x === at.x && effect.at.y === at.y)) {\r\n        // console.log(`adding effect at ${at.x}, ${at.y}`);\r\n        effects.push({\r\n            at,\r\n            type,\r\n            source\r\n        });\r\n    }\r\n}\r\n\r\nexport const clearEffect = (source: xy) => {\r\n    effects = effects.filter(effect => !(effect.source.x === source.x && effect.source.y === source.y));\r\n}\r\n\r\nexport const findEffectsForSource = (source: xy) => \r\n    effects.filter(effect => effect.source.x === source.x && effect.source.y === source.y);\r\n","import { Ref, ref } from \"vue\";\r\nimport { Action } from \"@/level/actions/actions\";\r\nimport { Inventory } from \"@/level/items/inventory/inventory\";\r\nimport { xy } from \"../map/xy\";\r\n\r\nexport interface CanTakeTurn {\r\n    name: string,\r\n    at: xy,\r\n    energy: number,\r\n    actions?: Action[],\r\n    movement: number,\r\n    inventory?: Inventory,\r\n    autoMove?: () => boolean // true means finished\r\n}\r\n\r\nconst turnStack: Ref<CanTakeTurn[]> = ref([]);\r\n\r\nconst turnIndex = ref(0);\r\n\r\nexport function nextStackUnit() {\r\n   \r\n    turnIndex.value++;\r\n    if (turnIndex.value >= turnStack.value.length) {\r\n        turnIndex.value = 0;\r\n    }\r\n}\r\n\r\nexport function currentStackUnit() {\r\n    return turnStack.value[turnIndex.value];\r\n}\r\n\r\nexport function hasStackUnit(name: string): boolean {\r\n    const stackIndex = turnStack.value.findIndex(unit => unit.name === name);\r\n    return stackIndex > 0;\r\n}\r\n\r\nexport function removeStackUnit(name: string) {\r\n    console.log(`removing unit ${name}`);\r\n    const stackIndex = turnStack.value.findIndex(unit => unit.name === name);\r\n    // console.log(`stack index: ${stackIndex}`);\r\n    if (stackIndex > 0) {\r\n        turnStack.value.splice(stackIndex, 1);\r\n    }\r\n    nextStackUnit();\r\n    console.log(`turn stack: ${JSON.stringify(turnStack.value)}`);\r\n}\r\n\r\nexport function addStackUnit(unit: CanTakeTurn) {\r\n    turnStack.value.push(unit);\r\n}\r\n\r\nexport function initStack() {\r\n    turnStack.value = [];\r\n}\r\n\r\nexport function getStack(): CanTakeTurn[] {\r\n    return turnStack.value;\r\n}","import { xy } from \"../xy\";\r\n\r\nexport const eqXy = (at1: xy, at2: xy) => at1.x === at2.x && at1.y === at2.y;","import { Ref, ref } from \"vue\";\r\nimport { ItemCategory, ItemType, items } from \"../items/items\";\r\nimport { EffectType, addEffect, clearEffect, findEffectsForSource } from \"@/level/effects/effects\";\r\nimport { addStackUnit, removeStackUnit } from \"@/level/units/turnStack\";\r\nimport { attackUnit, player, unitAt } from \"@/level/units/units\";\r\nimport { xy } from \"../map/xy\";\r\nimport { eqXy } from \"../map/util/eqXy\";\r\n\r\ntype FormationCorner = {\r\n    at: xy,\r\n    dist: number\r\n}\r\n\r\ntype FormationCorners = {\r\n    TL?: FormationCorner,\r\n    TR?: FormationCorner,\r\n    BL?: FormationCorner,\r\n    BR?: FormationCorner\r\n}\r\n\r\nexport type Formation = {\r\n    title: string,\r\n    type: ItemType,\r\n    at: xy,\r\n    corners: FormationCorners,\r\n    status: FormationStatus\r\n}\r\n\r\nexport enum FormationStatus {\r\n    BROKEN = 'Broken',\r\n    IDLE = 'Idle',\r\n    ALIVE = 'Alive'\r\n}\r\n\r\nconst formations: Ref<Formation[]> = ref([]);\r\n\r\nexport const addFormation = (title: string, at: xy, type: ItemType) => {\r\n    const newFormation: Formation = {\r\n        title,\r\n        at,\r\n        type,\r\n        corners: {},\r\n        status: FormationStatus.IDLE\r\n    };\r\n    newFormation.corners = checkFormationCorners(at);\r\n    if (!newFormation.corners.TL || !newFormation.corners.TR || !newFormation.corners.BL || !newFormation.corners.BR) {\r\n        newFormation.status = FormationStatus.BROKEN;\r\n    }\r\n\r\n    formations.value.push(newFormation);\r\n    console.log(`formations: ${JSON.stringify(formations.value)}`);\r\n}\r\n\r\nexport const updateFormations = () => {\r\n    for (const formation of formations.value) {\r\n        formation.corners = checkFormationCorners(formation.at);\r\n        if (!formation.corners.TL || !formation.corners.TR || !formation.corners.BL || !formation.corners.BR) {\r\n            formation.status = FormationStatus.BROKEN;\r\n        } else {\r\n            formation.status = FormationStatus.IDLE;\r\n        }\r\n    }\r\n}\r\n\r\nexport const removeFormation = (at: xy) => {\r\n    formations.value.splice(formations.value.findIndex(f => eqXy(f.at, at)));\r\n}\r\n\r\nexport const hasFormations = () => formations.value.length > 0;\r\n\r\nexport const getFormations = () => formations.value;\r\n\r\nexport const activateFormation = (at: xy) => {\r\n    const formation = formations.value.find(f => eqXy(f.at, at));\r\n    if (formation) {\r\n        formation.status = FormationStatus.ALIVE;\r\n        applyEffects(formation);\r\n        // add to stack\r\n        console.log(`adding to stack formation: ${formation.title}`);\r\n        addStackUnit({\r\n            name: 'Lightning Array',\r\n            at: formation.at,\r\n            energy: 1,\r\n            movement: 1,\r\n            autoMove: () => {\r\n                console.log('formation\\'s turn');\r\n                player().qi -= 2;\r\n                const effects = findEffectsForSource(formation.at);\r\n                for (const effect of effects) {\r\n                    const unitAtEffect = unitAt(effect.at);\r\n                    if (unitAtEffect) {\r\n                        console.log(`attacking unit at ${unitAtEffect.at.x}, ${unitAtEffect.at.y}`);\r\n                        attackUnit({power: 20, name: 'lightning'}, effect.at);\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nconst applyEffectsTL = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.TL?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`TL from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = cornerAt.x; x < formationAt.x + 1; x++) {\r\n            for (let y = cornerAt.y; y < formationAt.y + 1; y++) {\r\n                // console.log(`TL check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffectsTR = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.TR?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`TR from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = formationAt.x; x < cornerAt.x + 1; x++) {\r\n            for (let y = cornerAt.y; y < formationAt.y + 1; y++) {\r\n                // console.log(`TR check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffectsBL = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.BL?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`BL from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = cornerAt.x; x < formationAt.x + 1; x++) {\r\n            for (let y = formationAt.y; y < cornerAt.y + 1; y++) {\r\n                // console.log(`BL check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffectsBR = (formation: Formation) => {\r\n    const cornerAt = formation.corners?.BR?.at;\r\n    if (cornerAt) {\r\n        const formationAt = formation.at;\r\n        // console.log(`BR from ${cornerAt.x}, ${cornerAt.y} to ${formationAt.x}, ${formationAt.y}`);\r\n        for (let x = formationAt.x; x < cornerAt.x + 1; x++) {\r\n            for (let y = formationAt.y; y < cornerAt.y + 1; y++) {\r\n                // console.log(`BR check ${x}, ${y}`);\r\n                addEffect({x, y}, EffectType.LIGHTNING, formationAt);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst applyEffects = (formation: Formation) => {\r\n    applyEffectsTL(formation);\r\n    applyEffectsTR(formation);\r\n    applyEffectsBL(formation);\r\n    applyEffectsBR(formation);\r\n    // render();\r\n}\r\n\r\nexport const deactivateFormation = (at: xy) => {\r\n    const formation = formations.value.find(f => eqXy(f.at, at));\r\n    if (formation) {\r\n        formation.status = FormationStatus.IDLE;\r\n        clearEffect(at);\r\n\r\n        if (formation) {\r\n            console.log(`removing from stack formation: ${formation.title}`);\r\n            removeStackUnit(formation.title);\r\n        }\r\n    }\r\n}\r\n\r\nconst checkFormationCorners = (at: xy): FormationCorners => {\r\n    const corners: FormationCorners = {};\r\n\r\n    for (const item of items()) {\r\n\r\n        if (item.type.category === ItemCategory.FLAG) {\r\n\r\n            const xdiff = item.at.x - at.x;\r\n            const ydiff = item.at.y - at.y;\r\n\r\n            if (Math.abs(xdiff) === Math.abs(ydiff)) {\r\n                const at = JSON.parse(JSON.stringify(item.at));\r\n                const dist = Math.abs(xdiff);\r\n                if (xdiff < 0 && ydiff < 0) {\r\n                    corners.TL = { at, dist };\r\n\r\n                } else if (xdiff > 0 && ydiff < 0) {\r\n                    corners.TR = { at, dist };\r\n\r\n                } else if (xdiff < 0 && ydiff > 0) {\r\n                    corners.BL = { at, dist };\r\n\r\n                } else if (xdiff > 0 && ydiff > 0) {\r\n                    corners.BR = { at, dist };\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return corners;\r\n}","import { Team, units } from \"@/level/units/units\";\r\nimport { map } from \"../map\";\r\nimport { eqXy } from \"./eqXy\";\r\nimport { items } from \"@/level/items/items\";\r\nimport { xy } from \"../xy\";\r\nimport { xyd } from \"../xyd\";\r\n\r\nexport enum SpaceCheckerFunction {\r\n    EMPTY_SPACE,\r\n    ENEMY_UNIT,\r\n    WALL,\r\n    ITEM\r\n}\r\n\r\nexport const EMPTY_SPACE_CHECKER = (at: xy) => {\r\n    // console.log('in empty space checeer');\r\n        return map[at.y][at.x] === 0\r\n        && !(units.some(unit => eqXy(unit.at, at)))};\r\n    \r\nexport const ENEMY_UNIT_CHECKER = (at: xy) => {\r\n        // console.log('in enemy unit checker');\r\n        return map[at.y][at.x] === 0\r\n        && units.some(unit => eqXy(unit.at, at) && unit.team === Team.MONSTER)};\r\n\r\nexport const WALL_CHECKER = (at: xy) =>\r\n        map[at.y][at.x] !== 0\r\n        && !(units.some(unit => eqXy(unit.at, at)));\r\n\r\nexport const ITEM_CHECKER = (at: xy) => \r\n        items().some(item => item.at.x === at.x && item.at.y === at.y);\r\n\r\n\r\nexport function findFreeSpaceAround(around: xy, validateFn?: SpaceCheckerFunction): xy[] {\r\n    const _validateFn = validateFn ?? SpaceCheckerFunction.EMPTY_SPACE;\r\n    return findSpaceAroundInternal(around, [], _validateFn);\r\n}\r\n\r\nconst doValidate = (at: xy, fn: SpaceCheckerFunction) => {\r\n    switch (fn) {\r\n        case SpaceCheckerFunction.EMPTY_SPACE:\r\n            return EMPTY_SPACE_CHECKER(at);\r\n        case SpaceCheckerFunction.ENEMY_UNIT:\r\n            return ENEMY_UNIT_CHECKER(at);\r\n        case SpaceCheckerFunction.WALL:\r\n            return WALL_CHECKER(at);\r\n        case SpaceCheckerFunction.ITEM:\r\n            return ITEM_CHECKER(at);\r\n    }\r\n}\r\n\r\nfunction findSpaceAroundInternal(around: xy, existingSpaces: xy[], validateFn: SpaceCheckerFunction): xy[] {\r\n    // console.log(`findSpaceAroundInternal, validate: ${validateFn}`);\r\n    const spacesAround: xy[] = [];\r\n\r\n    for (let iterx = around.x - 1; iterx < (around.x + 2); iterx++) {\r\n        for (let itery = around.y - 1; itery < (around.y + 2); itery++) {\r\n            if (\r\n                iterx >= 0\r\n                && iterx < map[0].length\r\n                && itery >= 0\r\n                && itery < map.length\r\n                && doValidate({ x: iterx, y: itery}, validateFn)\r\n                && !(spacesAround.some(move => move.x == iterx && move.y === itery))\r\n                && !(existingSpaces.some(move => move.x == iterx && move.y === itery))\r\n            ) {\r\n                spacesAround.push({\r\n                    x: iterx,\r\n                    y: itery\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return spacesAround;\r\n}\r\n\r\nexport function findRangeAround(around: xy, range: number, validateFn?: SpaceCheckerFunction): xyd[] {\r\n    // console.log(`findFreeRangeAround, around: ${JSON.stringify(around)}, range: ${range}}`);\r\n    // console.log(`findFreeRangeAround, validate: ${validateFn}`);\r\n    const _validateFn = validateFn ?? SpaceCheckerFunction.EMPTY_SPACE;\r\n    // console.log(`validate function: ${_validateFn}`);\r\n    const spaces1 = findFreeSpaceAround(around, _validateFn);\r\n    let spacesAround: xyd[] = spaces1.map(space => buildXyd(space, 1));\r\n    \r\n\r\n    for (let n = 0; n < range - 1; n++) {\r\n        // console.log(`n=${n}`);\r\n        const length = spacesAround.length;\r\n        for (let iter = 0; iter < length; iter++) {\r\n            const spaces = findSpaceAroundInternal(spacesAround[iter], spacesAround, _validateFn);\r\n            spacesAround = spacesAround.concat(spaces.map(space => buildXyd(space, n + 2)));\r\n        }\r\n    }\r\n\r\n    return spacesAround;\r\n}\r\n\r\nfunction buildXyd(space: xy, d: number) {\r\n    return {...space, d}\r\n}","import { Ref, ref } from \"vue\"\r\nimport { Action, clickAction, isCurrentAction } from \"../../actions/actions\"\r\nimport { ATTACK_HOVER_COLOUR } from \"@/level/constants\"\r\nimport { currentTurnUnit } from \"../../units/units\"\r\nimport { images } from \"../../../imageLoader\"\r\nimport { ItemCategory, ItemType, PlacedItem, placeItem } from \"../items\"\r\nimport { WALK_ACTION } from \"../../actions/commonActions\"\r\nimport { ModalDetails, startModal } from \"@/modal/modal\"\r\nimport { addFormation, removeFormation, updateFormations } from \"../../formations/formations\"\r\nimport { xyd } from \"@/level/map/xyd\"\r\nimport { SpaceCheckerFunction } from \"@/level/map/util/findAround\"\r\n\r\nexport type InventoryItem = {\r\n    type: ItemType,\r\n    quantity: number\r\n}\r\n\r\nexport class Inventory {\r\n    items: InventoryItem[] = [];\r\n\r\n    constructor(inItems: InventoryItem[]) {\r\n        this.items = inItems;\r\n    }\r\n\r\n    removeItem(item: InventoryItem) {\r\n        item.quantity--;\r\n        if (item?.quantity <= 0) {\r\n            this.items.splice(this.items.findIndex(_item => _item.type.title === item.type.title), 1);\r\n        }\r\n    }\r\n\r\n    addItem(item: ItemType) {\r\n        const foundItem = this.items.find(_item => _item.type.title === item.title);\r\n        if (foundItem) {\r\n            foundItem.quantity++;\r\n        } else {\r\n            this.items.push({\r\n                type: item,\r\n                quantity: 1\r\n            })\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.items.length === 0;\r\n    }\r\n}\r\n\r\nexport const LIGHTNING_FLAG: ItemType = {\r\n    img: images.lightningFlag,\r\n    title: 'Lightning Flag',\r\n    category: ItemCategory.FLAG\r\n}\r\n\r\nexport const FORMATION_PLATE: ItemType = {\r\n    img: images.formationPlate,\r\n    title: 'Formation Plate',\r\n    category: ItemCategory.FORMATION\r\n}\r\n\r\nconst placeInventoryItem = (at: xyd) => {\r\n    console.log(`perform action inventory`);\r\n\r\n    // tidy up\r\n    // currentTurnUnit().energy = 0;\r\n    // if (selectedInventoryItem.value && selectedInventoryItem.value?.quantity > 1) {\r\n    //     selectedInventoryItem.value.quantity--;\r\n    // }\r\n    if (selectedInventoryItem.value) {\r\n        currentTurnUnit().inventory?.removeItem(selectedInventoryItem.value);\r\n        placeItem(selectedInventoryItem.value.type, at);\r\n\r\n        if (selectedInventoryItem.value.type.category === ItemCategory.FLAG) {\r\n            updateFormations();\r\n        }\r\n    }\r\n    //  else {\r\n        \r\n    // }\r\n\r\n    if (!selectedInventoryItem.value || selectedInventoryItem.value.quantity <= 0) {\r\n        selectedInventoryItem.value = null;\r\n        clickAction(WALK_ACTION);\r\n    }\r\n}\r\n\r\nexport const takeInventoryItem = (item: PlacedItem) => {\r\n    currentTurnUnit().inventory?.addItem(item.type);\r\n    if (item.type.category === ItemCategory.FORMATION) {\r\n        removeFormation(item.at);\r\n    } else if (item.type.category === ItemCategory.FLAG) {\r\n        updateFormations();\r\n    }\r\n}\r\n\r\nconst PlaceItemModal: ModalDetails = {\r\n    inputs: [\r\n        {\r\n            title: 'Formation Name:',\r\n            name: 'name',\r\n            value: ''\r\n        }\r\n    ],\r\n    title: () => `Place ${selectedInventoryItem.value?.type.title}`,\r\n    onSubmit: (at, inputs) => {\r\n        const item = selectedInventoryItem.value as InventoryItem;\r\n        placeInventoryItem(at);\r\n        addFormation(inputs[0].value, at, item.type);\r\n    }\r\n}\r\n\r\nexport const INVENTORY_ACTION: Action = {\r\n    label: 'Inventory',\r\n    img: '',\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.EMPTY_SPACE,\r\n        colour: ATTACK_HOVER_COLOUR\r\n    },\r\n    perform: (at) => {\r\n        if (selectedInventoryItem.value?.type.category === ItemCategory.FORMATION) {\r\n            // startModal(PlaceItemModal, at);\r\n            // return;\r\n            addFormation('', at, selectedInventoryItem.value.type);\r\n            placeInventoryItem(at);\r\n        } else {\r\n            placeInventoryItem(at);\r\n        }\r\n    },\r\n    precondition: () => true,\r\n}\r\n\r\nconst selectedInventoryItem: Ref<null | InventoryItem> = ref(null);\r\n\r\nexport const isSelectedInventoryItem = (item: InventoryItem): boolean => \r\n    isCurrentAction(INVENTORY_ACTION)\r\n    && item.type.title === selectedInventoryItem.value?.type.title;\r\n\r\nexport const clickInventory = (item: InventoryItem) => {\r\n    console.log(`click inventory item ${item.type.title}`);\r\n    selectedInventoryItem.value = item;\r\n    clickAction(INVENTORY_ACTION);\r\n}","import { Ref, ref } from \"vue\";\r\n\r\nenum GameStatus {\r\n    IN_PROGRESS,\r\n    GAME_OVER\r\n}\r\n\r\nconst status: Ref<GameStatus> = ref(GameStatus.IN_PROGRESS);\r\n\r\nconst gameOverMessage = ref('');\r\nconst gameOverImage = ref('');\r\n\r\nexport const GAME_OVER_DEFEAT = 'defeat';\r\n\r\nexport const gameOverMsg = () => gameOverMessage.value;\r\nexport const gameOverImg = () => gameOverImage.value;\r\n\r\nexport const gameOver = (message: string, type: string) => {\r\n    gameOverMessage.value = message;\r\n    status.value = GameStatus.GAME_OVER;\r\n    if (type === GAME_OVER_DEFEAT) {\r\n        gameOverImage.value = 'defeated.jpg';\r\n    } else {\r\n        gameOverImage.value = 'win.jpg';\r\n    }\r\n}\r\n\r\nexport const isGameOver = () => status.value === GameStatus.GAME_OVER;\r\n\r\n","import { Action } from \"./actions\";\r\nimport { attackUnit, currentTurnUnit, hasEnemies, player } from \"@/level/units/units\";\r\nimport { ATTACK_HOVER_COLOUR, CORNER, MOVEMENT_HOVER_COLOUR } from \"@/level/constants\";\r\nimport { takeItem } from \"@/level/items/items\";\r\nimport { takeInventoryItem } from \"@/level/items/inventory/inventory\";\r\nimport { gameOver } from \"@/level/gameStatus\";\r\nimport { SpaceCheckerFunction, findRangeAround } from \"../map/util/findAround\";\r\nimport { xy } from \"../map/xy\";\r\nimport { xyd } from \"../map/xyd\";\r\n\r\nexport const WAIT_ACTION: Action = {\r\n    label: 'Wait',\r\n    img: '/waiting.png',\r\n    perform: () => {\r\n        currentTurnUnit().energy = 0;\r\n    },\r\n    precondition: () => true\r\n}\r\n\r\nexport const ATTACK_ACTION: Action = {\r\n    label: 'Attack',\r\n    img: '/attack.png',\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.ENEMY_UNIT,\r\n        colour: ATTACK_HOVER_COLOUR\r\n    },\r\n    perform: (at: xy) => {\r\n        const playerUnit = player();\r\n        attackUnit(playerUnit, at);\r\n        currentTurnUnit().energy = 0;\r\n    },\r\n    precondition: () => true\r\n}\r\n\r\nexport const WALK_ACTION: Action = {\r\n    label: 'Walk',\r\n    img: '/walk.png',\r\n    range: {\r\n        range: () => currentTurnUnit().energy,\r\n        validator: SpaceCheckerFunction.EMPTY_SPACE,\r\n        colour: MOVEMENT_HOVER_COLOUR\r\n    },\r\n    perform: (at: xyd) => {\r\n        // console.log(`walking to ${at.x}, ${at.y} with d=${at.d}`);\r\n        currentTurnUnit().at = JSON.parse(JSON.stringify(at));\r\n        currentTurnUnit().energy -= at.d;\r\n    },\r\n    precondition: () => true\r\n}\r\n\r\nexport const PICK_UP_ACTION: Action = {\r\n    label: 'Pick Up',\r\n    img: '/take.png',\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.ITEM,\r\n        colour: MOVEMENT_HOVER_COLOUR\r\n    },\r\n    perform: (at: xyd) => {\r\n        const item = takeItem(at);\r\n        takeInventoryItem(item);\r\n    },\r\n    precondition: () => {\r\n        return findRangeAround(currentTurnUnit().at, 1, SpaceCheckerFunction.ITEM).length > 0;\r\n    }\r\n}\r\n\r\nexport const EXIT_LEVEL_ACTION: Action = {\r\n    label: 'Exit Level',\r\n    img: '/exit.png',\r\n    corners: CORNER.SQUARE,\r\n    perform: () => gameOver(`Completed level!`, ''),\r\n    precondition: () => !hasEnemies()\r\n}","import { Team, Unit } from \"./units\";\r\nimport { images } from \"@/imageLoader\";\r\nimport { WAIT_ACTION, WALK_ACTION } from \"@/level/actions/commonActions\";\r\nimport { xy } from \"../map/xy\";\r\n\r\nexport const mouseUnit = (at: xy): Unit => ({\r\n    name: 'Mouse',\r\n    img: images.mouse,\r\n    profileImg: 'mouse_profile.png',\r\n    at,\r\n    hp: 1,\r\n    armour: 0,\r\n    qi: 0,\r\n    power: 0,\r\n    team: Team.PLAYER,\r\n    movement: 4,\r\n    energy: 4,\r\n    actions: [\r\n        WAIT_ACTION,\r\n        WALK_ACTION\r\n    ],\r\n    battleDetails: {\r\n        center: 85,\r\n        rebound: 105,\r\n        top: 85,\r\n        height: 80,\r\n        image: 'mouse.png'\r\n    }\r\n});","import { addUnit, currentTurnUnit, removeUnit } from \"@/level/units/units\";\r\nimport { Action } from \"./actions\";\r\nimport { mouseUnit } from \"@/level/units/spiritUnit\";\r\nimport { ATTACK_HOVER_COLOUR } from \"@/level/constants\";\r\nimport { SpaceCheckerFunction } from \"../map/util/findAround\";\r\nimport { xy } from \"../map/xy\";\r\nimport { hasStackUnit } from \"../units/turnStack\";\r\n\r\nexport const SUMMON_LABEL = 'Spirit Friend';\r\nconst DEPLOYED_ATTRIBUTE = 'deployed';\r\n\r\nexport const SUMMON_SPIRIT_FRIEND_ACTION: Action = {\r\n    label: SUMMON_LABEL,\r\n    img: 'mouse_summon.png',\r\n    range: {\r\n        range: 1,\r\n        validator: SpaceCheckerFunction.EMPTY_SPACE,\r\n        colour: ATTACK_HOVER_COLOUR\r\n    },\r\n    meta: {\r\n        [DEPLOYED_ATTRIBUTE]: false\r\n    },\r\n    perform(at: xy) {\r\n        addUnit(mouseUnit(at));\r\n        this.meta[DEPLOYED_ATTRIBUTE] = true;\r\n        currentTurnUnit().energy = 0;\r\n    },\r\n    precondition() {\r\n        return this.meta[DEPLOYED_ATTRIBUTE] === false;\r\n    }\r\n}\r\n\r\nexport const RECALL_SPIRIT_FRIEND_ACTION: Action = {\r\n    label: 'Recall',\r\n    img: '/mouse_recall.png',\r\n    perform() {\r\n        console.log('perform recall');\r\n        removeUnit('Mouse');\r\n        const actions = currentTurnUnit().actions?.find(action => action.label === SUMMON_LABEL);\r\n        if (actions) {\r\n            actions.meta[DEPLOYED_ATTRIBUTE] = false;\r\n        }\r\n        currentTurnUnit().energy = 0;\r\n    },\r\n    precondition() {\r\n        return hasStackUnit('Mouse');\r\n    }\r\n}","import { Team, Unit } from \"./units\";\r\nimport { images } from \"@/imageLoader\";\r\nimport { RECALL_SPIRIT_FRIEND_ACTION, SUMMON_SPIRIT_FRIEND_ACTION } from \"@/level/actions/spiritFriend\";\r\nimport { ATTACK_ACTION, EXIT_LEVEL_ACTION, PICK_UP_ACTION, WAIT_ACTION, WALK_ACTION } from \"@/level/actions/commonActions\";\r\nimport { FORMATION_PLATE, Inventory, LIGHTNING_FLAG } from \"@/level/items/inventory/inventory\";\r\nimport { IMG_TYPE } from \"../constants\";\r\nimport { xy } from \"../map/xy\";\r\n\r\nexport const PLAYER_NAME = 'Azeena';\r\n\r\nexport const playerUnit = (at: xy): Unit => ({\r\n    name: PLAYER_NAME,\r\n    img: images.character,\r\n    imgType: IMG_TYPE.STANDING,\r\n    profileImg: 'player_profile.png',\r\n    at,\r\n    hp: 2,\r\n    armour: 0,\r\n    qi: 60,\r\n    power: 2,\r\n    team: Team.PLAYER,\r\n    movement: 2,\r\n    energy: 2,\r\n    inventory: new Inventory([\r\n        {\r\n            type: LIGHTNING_FLAG,\r\n            quantity: 4\r\n        },\r\n        {\r\n            type: FORMATION_PLATE,\r\n            quantity: 1\r\n        }\r\n    ]),\r\n    actions: [\r\n        SUMMON_SPIRIT_FRIEND_ACTION,\r\n        RECALL_SPIRIT_FRIEND_ACTION,\r\n        PICK_UP_ACTION,\r\n        ATTACK_ACTION,\r\n        WAIT_ACTION,\r\n        WALK_ACTION,\r\n        EXIT_LEVEL_ACTION\r\n    ],\r\n    battleDetails: {\r\n        center: 70,\r\n        rebound: 100,\r\n        top: 30,\r\n        height: 150,\r\n        image: 'ch.png'\r\n    }\r\n});","import { findRangeAround } from \"./map/util/findAround\";\r\nimport { currentTurnUnit } from \"./units/units\";\r\n\r\nexport let moveTo: {x: number, y: number}[] = [];\r\n\r\nexport function moveCharacter(x: number, y: number) {\r\n    currentTurnUnit().at.x = x;\r\n    currentTurnUnit().at.y = y;\r\n}\r\n\r\nexport function clearMoveTo() {\r\n    moveTo = [];\r\n}\r\n\r\nexport function findMoveTo() {\r\n    moveTo = findRangeAround(currentTurnUnit().at, currentTurnUnit().movement);\r\n}\r\n\r\n","import { images } from \"@/imageLoader\";\r\nimport { ItemCategory, ItemType } from \"@/level/items/items\";\r\n\r\nexport const SPIDER_BAIT_NAME = 'Spider Bait';\r\n\r\nexport const SPIDER_BAIT: ItemType = {\r\n    img: images.animalCorpse,\r\n    title: SPIDER_BAIT_NAME,\r\n    category: ItemCategory.NORMAL\r\n}","import { xy } from \"../xy\";\r\n\r\n\r\nexport function isNextTo(from: xy, to: xy) {\r\n    return from.x >= to.x - 1 \r\n    && from.x <= to.x + 1 \r\n    && from.y >= to.y - 1 \r\n    && from.y <= to.y + 1\r\n    && !(from.x === to.x && from.y === to.y);\r\n}","import { map } from \"../map\";\r\nimport { xy } from \"../xy\";\r\nimport { isNextTo } from \"./isNextTo\";\r\n\r\nfunction visibleToLocations(visible: boolean[][]) {\r\n    const locations: xy[] = [];\r\n    for (let y = 0; y < visible.length; y++) {\r\n        for (let x = 0; x < visible[0].length; x++) {\r\n            if (visible[y][x] && map[y][x] === 0) {\r\n                locations.push({x, y});\r\n            }\r\n        }\r\n    }\r\n    return locations;\r\n}\r\n\r\nexport function findSpaceClosestTo(visible: boolean[][], moves: xy[], target: xy, from: xy): xy {\r\n    const visibleMoves = moves.filter(move => visible[move.y][move.x] && map[move.y][move.x] === 0);\r\n    // console.log(`visible moves=${JSON.stringify(visibleMoves)}`);\r\n    const visibleLocations = visibleToLocations(visible);\r\n    // console.log(`visible locations=${JSON.stringify(visibleLocations)}`);\r\n    const attackableLocations = visibleLocations.filter(move => isNextTo(move, target));\r\n    // console.log(`attackable locations=${JSON.stringify(attackableLocations)}`);\r\n\r\n    let closestAttack = {x: -1, y: -1};\r\n    let closestMove = {x: -1, y: -1};\r\n    let closestDistance = -1;\r\n    for (const location of attackableLocations) {\r\n        for (const move of visibleMoves) {\r\n            const distance = Math.abs(location.x - move.x) + Math.abs(location.y - move.y);\r\n            if (closestDistance === - 1 || closestDistance > distance ) {\r\n                closestDistance = distance;\r\n                closestAttack = location;\r\n                closestMove = move;\r\n            }\r\n        }\r\n    }\r\n\r\n    // todo may not be in range\r\n\r\n    return closestMove;\r\n}","import { Team, Unit, attackUnit, player } from \"./units\";\r\nimport { images } from \"@/imageLoader\";\r\nimport { moveCharacter } from \"@/level/moving\";\r\nimport { findVisibleTo } from \"@/level/visibility\";\r\nimport { SPIDER_BAIT_NAME } from \"@/level/items/randomItems\";\r\nimport { items } from \"@/level/items/items\";\r\nimport { IMG_TYPE } from \"../constants\";\r\nimport { isNextTo } from \"../map/util/isNextTo\";\r\nimport { findRangeAround } from \"../map/util/findAround\";\r\nimport { findSpaceClosestTo } from \"../map/util/findSpace\";\r\nimport { xy } from \"../map/xy\";\r\n\r\nconst attack = (boss: Unit, target: xy) => {\r\n    // console.log('ATTACK!!');\r\n    attackUnit(boss, target);\r\n    boss.energy = 0;\r\n    if (boss.meta) {\r\n        boss.meta.target = null;\r\n    }\r\n}\r\n\r\nconst identifyTarget = (boss: Unit, visible: boolean[][]) => {\r\n    if (boss.meta) {\r\n        const _player = player();\r\n        if (_player && visible[_player.at.y][_player.at.x]) {\r\n            boss.meta.target = _player.at;\r\n            // console.log(`PLAYER IDENTFIED at ${_player.at.x}, ${_player.at.y}`);\r\n            return;\r\n        }\r\n\r\n        const baits = items().filter(item => item.type.title === SPIDER_BAIT_NAME);\r\n        for (const bait of baits) {\r\n            if (visible[bait.at.y][bait.at.x]) {\r\n                boss.meta.target = bait.at;\r\n                // console.log(`BAIT IDENTFIED at ${bait.at.x}, ${bait.at.y}`);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst charge = (boss: Unit, target: xy, visible: boolean[][]) => {\r\n    const range = findRangeAround(boss.at, 1);\r\n    // console.log(`range is ${JSON.stringify(range)}`);\r\n    // console.log(`target is ${JSON.stringify(target)}`);\r\n    // console.log(`visible is ${JSON.stringify(visible)}`);\r\n    const closest = findSpaceClosestTo(visible, range, target, boss.at);\r\n    console.log(`closest is ${closest.x}, ${closest.y}`);\r\n    if (closest.x === -1 || closest.y === -1) {\r\n        if (boss.meta) boss.meta.target = null;\r\n        return;\r\n    }\r\n    console.log(`CHARGE from ${boss.at.x}, ${boss.at.y} to ${closest.x}, ${closest.y}`);\r\n    moveCharacter(closest.x, closest.y);\r\n    boss.energy--;\r\n}\r\n\r\nconst idleWalk = (boss: Unit) => {\r\n    const range = findRangeAround(boss.at, 1);\r\n    const randomChoice = Math.floor(Math.random() * range.length);\r\n    const toX = range[randomChoice].x;\r\n    const toY = range[randomChoice].y;\r\n    // console.log(`WALK to ${toX}, ${toY}`);\r\n    moveCharacter(toX, toY);\r\n    boss.energy = 0;\r\n}\r\n\r\nconst bossMove = (boss: Unit): boolean => {\r\n    console.log('boss move');\r\n    // while (boss.energy > 0) {\r\n        let visible = findVisibleTo([boss]);\r\n        identifyTarget(boss, visible);\r\n        // console.log(`visible: ${JSON.stringify(visible)}`);\r\n        // const playerUnit = player();\r\n        if (boss.meta && boss.meta.target != null) { //visible[playerUnit.y][playerUnit.x]) {\r\n            // console.log('has a target');\r\n\r\n            if (isNextTo(boss.at, boss.meta.target)) {\r\n                // console.log('is next to target');\r\n                console.log('attacking');\r\n                attack(boss, boss.meta.target);\r\n            } else {\r\n                // console.log('moving toward target');\r\n                console.log('charging');\r\n                charge(boss, boss.meta.target, visible);\r\n            }\r\n        } else {\r\n            // console.log('has no target');\r\n            console.log('idling');\r\n            idleWalk(boss);\r\n        }\r\n    // }\r\n\r\n    visible = findVisibleTo([boss]);\r\n    identifyTarget(boss, visible);\r\n    return boss.energy <= 0;\r\n}\r\n\r\n\r\n\r\nexport const bossUnit = (at: xy): Unit => ({\r\n    name: 'Turqoise Spider',\r\n    img: images.spider,\r\n    imgType: IMG_TYPE.OVERSIZED,\r\n    profileImg: 'spider_profile.png',\r\n    at,\r\n    hp: 2,\r\n    armour: 10,\r\n    qi: 0,\r\n    power: 10,\r\n    team: Team.MONSTER,\r\n    movement: 8,\r\n    energy: 8,\r\n    actions: [],\r\n    meta: {\r\n        target: null\r\n    },\r\n    autoMove() {\r\n        return bossMove(this);\r\n    },\r\n    battleDetails: {\r\n        center: 35,\r\n        rebound: 55,\r\n        top: 40,\r\n        height: 180,\r\n        image: 'spider2.png'\r\n    }\r\n});","import { PICK_UP_ACTION } from \"../actions/commonActions\";\r\nimport { SUMMON_LABEL } from \"../actions/spiritFriend\";\r\nimport { GuideDirection, GuideType, TargetType } from \"../constants\";\r\nimport { FormationStatus, getFormations, hasFormations } from \"../formations/formations\";\r\nimport { isGameOver } from \"../gameStatus\";\r\nimport { items } from \"../items/items\";\r\nimport { SPIDER_BAIT_NAME } from \"../items/randomItems\";\r\nimport { eqXy } from \"../map/util/eqXy\";\r\nimport { currentTurnUnit, hasEnemies, player, playerTeam, units } from \"../units/units\";\r\nimport { visible } from \"../visibility\";\r\nimport { Guide, setGuides } from \"./guide\";\r\n\r\nconst NAME = 'Azeena';\r\nconst PROFILE_IMG = 'profile.png';\r\nconst PROFILE_COLD = 'profile_cold.png';\r\nconst PROFILE_READING = 'profile_reading.png';\r\n\r\nexport const introDialog = [\r\n    {\r\n        name: NAME,\r\n        speech: `'Brrr... it's colder in here than I expected.'`,\r\n        profileImg: PROFILE_COLD\r\n    },\r\n    {\r\n        name: NAME,\r\n        speech: `'According to the book, there are tens of thousands of these caves hidden in the north-western mountains that encircle the desert.'`,\r\n        profileImg: PROFILE_READING\r\n    },\r\n    {\r\n        name: NAME,\r\n        speech: `'They are the remains of an ancient civilization that disappeared a long time ago and are now inhabited by monsters.'`,\r\n        profileImg: PROFILE_READING\r\n    },\r\n    {\r\n        name: NAME,\r\n        speech: `'This one should just be the lair of a giant spider though. Even though it's tough, with a little bit of skill, I should be able to take it out.'`,\r\n        profileImg: PROFILE_IMG\r\n    }\r\n]\r\n\r\nconst movementGuide = {\r\n    name: 'movement guide',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: `Let's explore! I can move here!`,\r\n        direction: GuideDirection.LEFT,\r\n        location: {\r\n            top: 290,\r\n            left: 240\r\n        },\r\n        target: TargetType.CANVAS,\r\n        targetName: TargetType.CANVAS\r\n    },\r\n    ready: () => true,\r\n    finished: () => !eqXy(player().at, {x: 0, y: 4})\r\n};\r\n\r\nconst baitVisible = () => items().some(item => \r\n    item.type.title === SPIDER_BAIT_NAME\r\n    && visible[item.at.y][item.at.x]\r\n)\r\n\r\nconst baitDialog = {\r\n    name: 'bait dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'Are those dead lizards?'`,\r\n            profileImg: PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Apparantly spiders like to eat lizards. Maybe I can use them as bait?'`,\r\n            profileImg: PROFILE_READING\r\n        },\r\n    ],\r\n    ready: baitVisible,\r\n    finished: () => true\r\n}\r\n\r\nconst baitTooltip = {\r\n    name: 'bait tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: 'Move within range of the dead lizards',\r\n        direction: GuideDirection.LEFT,\r\n        location: {\r\n            top: 160,\r\n            left: 240\r\n        },\r\n        target: TargetType.CANVAS,\r\n        targetName: TargetType.CANVAS\r\n    },\r\n    ready: baitVisible,\r\n    finished: PICK_UP_ACTION.precondition\r\n}\r\n\r\nconst pickupTooltip: Guide = {\r\n    name: 'pickup tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: `Click the 'take' action and then choose an item to take`,\r\n        direction: GuideDirection.BOTTOM,\r\n        location: {\r\n            top: -100,\r\n            left: 0\r\n        },\r\n        width: 260,\r\n        target: TargetType.ACTION,\r\n        targetName: 'Pick Up'\r\n    },\r\n    ready: PICK_UP_ACTION.precondition,\r\n    finished: () => currentTurnUnit()?.inventory?.items.some(item => item.type.title === SPIDER_BAIT_NAME) ?? false\r\n}\r\n\r\nconst spyDialog = {\r\n    name: 'spy dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'This place is scary. I shouldn't just walk around aimlessly like this.'`,\r\n            profileImg: PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'I know. I can summon my spirit friend. She's a mouse, and whatever she can see, I can see.'`,\r\n            profileImg: PROFILE_IMG\r\n        },\r\n    ],\r\n    ready: () => currentTurnUnit().at.x >= 4,\r\n    finished: () => true\r\n}\r\n\r\nconst spyTooltip: Guide = {\r\n    name: 'spy tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: 'Click the \\'summon\\' action to summon my spirit friend.',\r\n        direction: GuideDirection.BOTTOM,\r\n        location: {\r\n            top: -100,\r\n            left: 0\r\n        },\r\n        width: 260,\r\n        target: TargetType.ACTION,\r\n        targetName: SUMMON_LABEL\r\n    },\r\n    ready: () => currentTurnUnit().at.x >= 4,\r\n    finished: () => playerTeam().some(unit => unit.name === 'Mouse')\r\n}\r\n\r\nconst spiderVisible = () => units.some(unit => \r\n    unit.name === 'Turqoise Spider'\r\n    && visible[unit.at.y][unit.at.x]\r\n)\r\n\r\nconst spiderDialog = {\r\n    name: 'spider dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'That's the spider! I need to be careful. There's no way I could defeat that thing by just charging in.'`,\r\n            profileImg: PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Lucky I bought materials for laying a formation. According to the book, I need to place a formation plate in the center of a large area and place a lightning flags at each corner.'`,\r\n            profileImg: PROFILE_READING\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Then I can activate the formation to release deadly lightning. Better not to get hit by that!'`,\r\n            profileImg: PROFILE_READING\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Okay! Let's try laying that formation plate somewhere!'`,\r\n            profileImg: PROFILE_IMG\r\n        },\r\n    ],\r\n    ready: spiderVisible,\r\n    finished: () => true\r\n}\r\n\r\nconst formationPlateDialog = {\r\n    name: 'formation plate dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'I've laid the formation plate. Now I need to put a lightning flag in one of the four corners. It shouldn't matter how far they are as long as they are on the corner...'`,\r\n            profileImg: PROFILE_READING\r\n        }\r\n    ],\r\n    ready: () => hasFormations(),\r\n    finished: () => true\r\n}\r\n\r\nconst formationCompleteDialog = {\r\n    name: 'formation plate dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'The formation is complete. Once I lure the spider here I can activate the formation to zap it.'`,\r\n            profileImg: PROFILE_READING\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Better not stand in range of the formation when it's active..!'`,\r\n            profileImg: PROFILE_IMG\r\n        }\r\n    ],\r\n    ready: () => hasFormations() && getFormations()[0].status === FormationStatus.IDLE,\r\n    finished: () => true\r\n}\r\n\r\nconst spiderDeadDialog = {\r\n    name: 'spider dialog',\r\n    type: GuideType.DIALOG,\r\n    dialog: [\r\n        {\r\n            name: NAME,\r\n            speech: `'I killed it! I actually killed it! I can't believe I really did it!'`,\r\n            profileImg: PROFILE_IMG\r\n        },\r\n        {\r\n            name: NAME,\r\n            speech: `'Phew! Now that's over, I can leave this place once I'm ready'`,\r\n            profileImg: PROFILE_IMG\r\n        }\r\n    ],\r\n    ready: () => !hasEnemies(),\r\n    finished: () => true\r\n}\r\n\r\nconst exitTooltip: Guide = {\r\n    name: 'exit tooltip',\r\n    type: GuideType.TOOLTIP,\r\n    tooltip: {\r\n        text: 'Click the \\'exit level\\' action to leave the cave.',\r\n        direction: GuideDirection.BOTTOM_RIGHT,\r\n        location: {\r\n            top: -100,\r\n            left: -150\r\n        },\r\n        width: 260,\r\n        target: TargetType.ACTION,\r\n        targetName: 'Exit Level'\r\n    },\r\n    ready: () => !hasEnemies(),\r\n    finished: () => isGameOver()\r\n}\r\n\r\nexport const initGuides = () => {\r\n    setGuides([\r\n        movementGuide,\r\n        baitDialog,\r\n        baitTooltip,\r\n        pickupTooltip,\r\n        spyDialog,\r\n        spyTooltip,\r\n        spiderDialog,\r\n        formationPlateDialog,\r\n        formationCompleteDialog,\r\n        spiderDeadDialog,\r\n        exitTooltip\r\n    ]);\r\n}","export const showHelp = true;\r\n// export const showHelp = false;","import { guideTick } from \"@/level/guide/guide\";\r\nimport { introDialog } from \"@/level/guide/levelGuides\";\r\nimport { showHelp } from \"@/settings\";\r\nimport { Ref, ref } from \"vue\";\r\n\r\nexport type DialogType = {\r\n    name: string,\r\n    speech?: string,\r\n    profileImg: string\r\n}\r\n\r\nconst dialog: Ref<DialogType | undefined> = ref(introDialog[0]);\r\n\r\nlet dialogList: DialogType[] = [\r\n    introDialog[1],\r\n    introDialog[2],\r\n    introDialog[3]\r\n];\r\n\r\nexport const hasDialog = (): boolean => dialog.value !== undefined && showHelp;\r\n\r\nexport const getDialog = () => dialog.value;\r\n\r\nexport const dialogNext = () => {\r\n    if (dialogList.length > 0) {\r\n        dialog.value = dialogList.splice(0, 1)[0];\r\n    } else {\r\n        dialog.value = undefined;\r\n        guideTick();\r\n    }\r\n}\r\n\r\nexport const setDialog = (_dialog: DialogType[]) => {\r\n    dialogList = _dialog;\r\n    dialogNext();\r\n}","import { DialogType, setDialog } from \"@/dialog/dialog\";\r\nimport { Ref, ref } from \"vue\";\r\nimport { GuideDirection, GuideType, TargetType } from \"../constants\";\r\nimport { showHelp } from \"@/settings\";\r\n\r\nexport type Guide = {\r\n    name: string,\r\n    type: GuideType,\r\n    tooltip?: {\r\n        text: string,\r\n        direction: GuideDirection,\r\n        location: {\r\n            left: number,\r\n            top: number\r\n        },\r\n        width?: number,\r\n        target: TargetType,\r\n        targetName: string\r\n    },\r\n    dialog?: DialogType[],\r\n    ready: () => boolean,\r\n    finished: () => boolean\r\n}\r\n\r\nlet guides: Guide[] = [];\r\n\r\nconst guideText: Ref<Guide | undefined> = ref();\r\n\r\nexport const getGuide = () => guideText.value;\r\n\r\nexport const hasTooltip = () => guideText.value?.type === GuideType.TOOLTIP && guideText.value?.tooltip && showHelp;\r\n\r\nexport const getTooltip = () => guideText.value?.tooltip;\r\n\r\nexport const setGuides = (_guides: Guide[]) => {\r\n    guides = _guides;\r\n    guideTick();\r\n}\r\n\r\nexport const guideTick = () => {\r\n    console.log(`guide tick`);\r\n    if (guideText.value?.finished()) {\r\n        console.log(`guide finished`);\r\n        guideText.value = undefined;\r\n    }\r\n\r\n    if (!guideText.value) {\r\n        console.log(`looking for new guides`);\r\n        for (let i = 0; i < guides.length; i++) {\r\n            console.log(`found guide ${guides[i].name}`);\r\n            if (guides[i].ready()) {\r\n                console.log(`ready`);\r\n                guideText.value = guides.splice(i, 1)[0];\r\n                if (guideText.value.type === GuideType.DIALOG && guideText.value.dialog) {\r\n                    setDialog(guideText.value.dialog);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}","import { ref } from \"vue\";\r\nimport { guideTick } from \"../guide/guide\";\r\n\r\nconst inBattle = ref(false);\r\n\r\nexport const isInBattle = () => inBattle.value;\r\n\r\nexport type UnitBattleDetails = {\r\n    center: number,\r\n    rebound: number,\r\n    top: number,\r\n    height: number,\r\n    image: string\r\n}\r\n\r\nexport const startBattle = (damage: number, attacker: UnitBattleDetails | null, defender: UnitBattleDetails) => {\r\n    battleDetails.damage = damage;\r\n    battleDetails.attacker = attacker;\r\n    battleDetails.defender = defender;\r\n    inBattle.value = true;\r\n    startAnimation();\r\n}\r\n\r\nexport const hasAttacker = () => battleDetails.attacker;\r\n\r\nexport const endBattle = () => {\r\n    inBattle.value = false;\r\n    battleDetails.damage = 0;\r\n    guideTick();\r\n}\r\n\r\nconst battleDetails : {\r\n    damage: number,\r\n    attacker: UnitBattleDetails | null,\r\n    defender: UnitBattleDetails | null\r\n} = {\r\n    damage: 0,\r\n    attacker: null,\r\n    defender: null\r\n} \r\n\r\nexport const defenderImg = () => battleDetails.defender?.image;\r\n\r\nexport const attackerImg = () => battleDetails.attacker?.image;\r\n\r\n// animation\r\n\r\nconst animationRate = 200;\r\n// const animationRate = 1500;\r\n\r\nexport const leftStyle = ref('');\r\nexport const rightStyle = ref('');\r\nexport const rightFloorStyle = ref('');\r\nexport const damage = ref('');\r\n\r\nconst attacker = {\r\n    top: 0,\r\n    height: 0,\r\n    center: 0\r\n}\r\n\r\nconst defender: {\r\n    top: number,\r\n    height: number,\r\n    center: number,\r\n    filter: null | string\r\n} = {\r\n    top: 0,\r\n    height: 0,\r\n    center: 0,\r\n    filter: null\r\n}\r\n\r\n\r\nconst drawLeftSide = () => leftStyle.value = `margin-left: ${attacker.center ?? 0}px; margin-top: ${attacker.top ?? 0}px; height: ${attacker.height}px`;\r\nconst drawRightSide = () => \r\n    rightStyle.value = `margin-left: ${defender.center ?? 0}px; margin-top: ${defender.top ?? 0}px; height: ${defender.height}px;`\r\n     + (defender.filter ? `filter: ${defender.filter}` : '');\r\n\r\n\r\nconst startAnimation = () => {\r\n    console.log('start animation');\r\n    if (battleDetails.attacker) {\r\n        attacker.top = battleDetails.attacker.top;\r\n        attacker.height = battleDetails.attacker.height;\r\n        attacker.center = battleDetails.attacker.center;\r\n    }\r\n    if (battleDetails.defender) {\r\n        defender.top = battleDetails.defender.top;\r\n        defender.height = battleDetails.defender.height;\r\n        defender.center = battleDetails.defender.center;\r\n        defender.filter = null;\r\n    }\r\n    drawLeftSide();\r\n    drawRightSide();\r\n    if (hasAttacker()) {\r\n        setTimeout(attackerStartCharge, animationRate * 2);\r\n    } else {\r\n        // TODO how to check attack is from lightning?\r\n        setTimeout(lightningAttack, animationRate * 2);\r\n    }\r\n}\r\n\r\nconst attackerStartCharge = () => {\r\n    console.log('attacker start charge');\r\n    attacker.center = 0;\r\n    drawLeftSide();\r\n    setTimeout(attackerCompleteCharge, animationRate);\r\n}\r\n\r\nconst attackerCompleteCharge = () => {\r\n    console.log('attacker complete charge');\r\n    attacker.center = battleDetails.attacker?.center ?? 0;\r\n    drawLeftSide();\r\n    setTimeout(defenderReceiveAttack, animationRate);\r\n}\r\n\r\nconst lightningAttack = () => {\r\n    console.log('lightning attack');\r\n    rightFloorStyle.value = `\r\n        background-color: #f2c6c6;\r\n        background-blend-mode: screen;\r\n    `;\r\n    defender.filter = `hue-rotate(30deg) saturate(500%) brightness(300%);`;\r\n    drawRightSide();\r\n    setTimeout(defenderReceiveAttack, animationRate);\r\n}\r\n\r\nconst defenderReceiveAttack = () => {\r\n    console.log('defender receive attack animation');\r\n    rightFloorStyle.value = '';\r\n    defender.filter = `hue-rotate(0deg) saturate(500%) brightness(150%)`\r\n    if (hasAttacker()) {\r\n        defender.center = battleDetails.defender?.rebound ?? 0;\r\n    }\r\n    drawRightSide();\r\n    damage.value = `-${battleDetails.damage}`;\r\n    setTimeout(defenderReturnToNormal, animationRate * 2); \r\n}\r\n\r\nconst defenderReturnToNormal = () => {\r\n    console.log('defender return to normal');\r\n    defender.filter = null;\r\n    defender.center = battleDetails.defender?.center ?? 0;\r\n    drawRightSide();\r\n    setTimeout(endAnimation, animationRate * 4);\r\n}\r\n\r\nconst endAnimation = () => {\r\n    console.log('end animation');\r\n    damage.value = '';\r\n    leftStyle.value = '';\r\n    rightStyle.value = '';\r\n    endBattle();\r\n}\r\n\r\n","import { imgData } from \"../../imageLoader\";\r\nimport { Action, clickAction } from \"../actions/actions\";\r\nimport { findPlayerVisible, visible } from \"../visibility\";\r\nimport { render } from \"../canvas\";\r\nimport { PLAYER_NAME, playerUnit } from \"./playerUnit\";\r\nimport { bossUnit } from \"./spiderUnit\";\r\nimport { CanTakeTurn, addStackUnit, currentStackUnit, initStack, nextStackUnit, removeStackUnit } from \"./turnStack\";\r\nimport { GAME_OVER_DEFEAT, gameOver, isGameOver } from \"@/level/gameStatus\";\r\nimport { WALK_ACTION } from \"@/level/actions/commonActions\";\r\nimport { Inventory } from \"@/level/items/inventory/inventory\";\r\nimport { items, takeItem } from \"@/level/items/items\";\r\nimport { IMG_TYPE } from \"../constants\";\r\nimport { eqXy } from \"../map/util/eqXy\";\r\nimport { xy } from \"../map/xy\";\r\nimport { UnitBattleDetails, startBattle } from \"../battle/battle\";\r\n\r\nexport enum Team {\r\n    PLAYER,\r\n    MOB,\r\n    MONSTER\r\n}\r\n\r\nexport interface Unit extends CanTakeTurn {\r\n    name: string,\r\n    img: imgData,\r\n    imgType?: IMG_TYPE,\r\n    at: xy,\r\n    profileImg?: string,\r\n    // x: number,\r\n    // y: number,\r\n    team: Team,\r\n    movement: number,\r\n    energy: number,\r\n    hp: number,\r\n    armour: number,\r\n    qi: number,\r\n    power: number,\r\n    inventory?: Inventory,\r\n    actions: Action[],\r\n    meta?: Record<string, any>,\r\n    autoMove?: () => boolean,\r\n    battleDetails: UnitBattleDetails\r\n}\r\n\r\nexport let units: Unit[] = [];\r\n\r\nexport function initUnits() {\r\n    units = [];\r\n    initStack();\r\n    addUnit(playerUnit({x: 0, y: 4}));\r\n    addUnit(bossUnit({x: 2, y: 7}));\r\n}\r\n\r\nexport function addUnit(unit: Unit) {\r\n    units.push(unit);\r\n    addStackUnit(unit);\r\n}\r\n\r\nexport function removeUnit(name: string) {\r\n    const unitIndex = units.findIndex(unit => unit.name === name);\r\n    if (unitIndex >= 0) {\r\n        units.splice(unitIndex, 1);\r\n        removeStackUnit(name);\r\n    }\r\n}\r\n\r\nexport const unitsZero = () => units = [];\r\n\r\nexport const player = () => units.find(unit => unit.name === PLAYER_NAME) as Unit;\r\n\r\nexport const playerTeam = () => units.filter(unit => unit.team === Team.PLAYER);\r\n\r\nexport const hasEnemies = () => units.filter(unit => unit.team === Team.MONSTER).length > 0;\r\n\r\nexport const unitAt = (at: xy): Unit => units.find(unit => unit.at.x === at.x && unit.at.y == at.y) as Unit;\r\n\r\nexport const currentTurnUnit = () => currentStackUnit();\r\n\r\nexport function nextUnitTurn(): void {\r\n    if (isGameOver()) {\r\n        return;\r\n    }\r\n    \r\n    nextStackUnit();\r\n\r\n    const currentUnit = currentTurnUnit();\r\n    currentUnit.energy = currentUnit.movement;\r\n    // console.log(`current unit energy: ${currentUnit.energy}`);\r\n    // console.log(`current unit turn: ${currentUnit.name}`);\r\n\r\n    // if (currentUnit.autoMove) {\r\n    //     // console.log(`mob move`);\r\n    //     currentUnit.autoMove();\r\n    //     nextUnitTurn();\r\n        \r\n    // } else {\r\n    //     // console.log(`player move`);\r\n    //     // findMoveTo();\r\n    //     startPlayerTurn();\r\n    // }\r\n\r\n    doMove(currentUnit);\r\n}\r\n\r\nexport function doMove(currentUnit: CanTakeTurn): void {\r\n    console.log('do move');\r\n    if (currentUnit.autoMove) {\r\n        console.log(`## monster taking move (1)`);\r\n        // console.log(`mob move`);\r\n        const finished = currentUnit.autoMove();\r\n        if (!finished) {\r\n            if (visible[currentUnit.at.y][currentUnit.at.x]) {\r\n                console.log(`## render and set timer`);\r\n                render();\r\n                setTimeout(() => doMove(currentUnit), 400);\r\n            } else {\r\n                doMove(currentUnit);\r\n            }\r\n            return;\r\n        } else {\r\n            nextUnitTurn();\r\n        }\r\n        \r\n    } else {\r\n        // console.log(`player move`);\r\n        // findMoveTo();\r\n        startPlayerTurn();\r\n    }\r\n}\r\n\r\nexport function startPlayerTurn() {\r\n    findPlayerVisible();\r\n    clickAction(WALK_ACTION);\r\n    render();\r\n}\r\n\r\ninterface Attacker {\r\n    power: number,\r\n    name: string,\r\n    battleDetails?: UnitBattleDetails\r\n}\r\n\r\nexport function attackUnit(attacker: Attacker, targetLocation: xy) {\r\n    const attackee = units.find(unit => eqXy(unit.at, targetLocation));\r\n\r\n    if (attackee) {\r\n\r\n        // console.log(`attack - ${attacker.name} vs ${attackee.name}`);\r\n        if (attackee.armour >= attacker.power) {\r\n            attackee.armour -= attacker.power;\r\n            // console.log(`attackee armour reduced to ${attackee.armour}`);\r\n\r\n        } else {\r\n            const remainingPower = attacker.power - attackee.armour;\r\n            attackee.armour = 0;\r\n            attackee.hp -= remainingPower;\r\n            // console.log(`attackee health reduced to ${attackee.hp}`);\r\n        }\r\n\r\n        if (attackee.hp < 0) {\r\n            // DEAD\r\n            attackee.hp = 0;\r\n\r\n            removeStackUnit(attackee.name);\r\n            removeUnit(attackee.name);\r\n\r\n            // console.log(`attackee dead`);\r\n            if (attackee.name === PLAYER_NAME) {\r\n                gameOver(`Defeated by ${attacker.name}`, GAME_OVER_DEFEAT);\r\n            }\r\n        }\r\n        startBattle(attacker.power, attacker.battleDetails ?? null, attackee.battleDetails);\r\n        render();\r\n\r\n        return;\r\n    }\r\n\r\n    const item = items().find(item => item.at.x === targetLocation.x && item.at.y === targetLocation.y);\r\n\r\n    if (item) {\r\n        takeItem(item.at);\r\n    }\r\n}","import { ref } from \"vue\";\r\nimport { moveTo } from './moving';\r\nimport { actionAt, getActionAt, performAction } from \"@/level/actions/actions\";\r\nimport { CELL_SIZE, dpi, getCanvas, offset, render } from \"@/level/canvas\";\r\nimport { currentTurnUnit, nextUnitTurn } from \"@/level/units/units\";\r\nimport { guideTick } from \"./guide/guide\";\r\nimport { xy } from \"./map/xy\";\r\n\r\nexport const mouseHover = ref(false);\r\nexport const mouseAt: { x: number, y: number } = { x: -1, y: -1 };\r\n\r\nexport const mouseMoveListener = (event: MouseEvent) => {\r\n    const canvas = getCanvas();\r\n    const rect = canvas.getBoundingClientRect();\r\n    // console.log(`rect: ${rect.left}, ${rect.top}`)\r\n    const x = Math.floor((event.clientX - rect.left) / CELL_SIZE * dpi);\r\n    const y = Math.floor((event.clientY - rect.top) / CELL_SIZE * dpi);\r\n    \r\n    // console.log(event);\r\n    mouseAt.x = x;\r\n    mouseAt.y = y;\r\n    // console.log(`x = ${mouseAt.value.x}, y = ${mouseAt.value.y}, event.clientX: ${event.clientX}, event.clientY: ${event.clientY}`);\r\n    render();\r\n\r\n    checkForHover(mouseAt);\r\n}\r\n\r\nconst checkForHover = (mouseAt: xy) => {\r\n    if (mouseOverMoveTo() || mouseOverActionAt()) {\r\n        mouseHover.value = true;\r\n    } else {\r\n        mouseHover.value = false;\r\n    }\r\n}\r\n\r\nconst mouseOverMoveTo = () => \r\n    moveTo.some(loc => loc.x === (mouseAt.x + offset.x) && loc.y === (mouseAt.y + offset.y));\r\n\r\nconst mouseOverActionAt = () => \r\n    actionAt.some(loc => loc.x === (mouseAt.x + offset.x) && loc.y === (mouseAt.y + offset.y));\r\n\r\nexport function clickCanvas() {\r\n    // console.log('click');\r\n    // if (mouseOverMoveTo()) {\r\n    //     moveCharacter(mouseAt.x + offset.x, mouseAt.y + offset.y);\r\n    //     nextUnitTurn();\r\n    // } else \r\n\r\n    if (mouseOverActionAt()) {\r\n        const actionAt = getActionAt(mouseAt.x, mouseAt.y);\r\n        performAction({x: mouseAt.x + offset.x, y: mouseAt.y + offset.y, d: actionAt.d});\r\n        // console.log(`unit has ${currentTurnUnit().energy} remaining`);\r\n        if (currentTurnUnit().energy < 1) {\r\n            nextUnitTurn();\r\n        }\r\n    }\r\n\r\n    guideTick();\r\n}","import { map } from \"./map/map\";\r\nimport { images } from \"../imageLoader\";\r\nimport { mapped, visible } from \"./visibility\";\r\nimport { Unit, currentTurnUnit, units } from \"./units/units\";\r\nimport { actionAt, currentActionColour } from \"./actions/actions\";\r\nimport { mouseAt, mouseMoveListener } from \"./mouseHandler\";\r\nimport { CURRENT_UNIT_COLOUR, IMG_TYPE } from \"./constants\";\r\nimport { PlacedItem, items } from \"./items/items\";\r\nimport { Effect, EffectType, effects } from \"./effects/effects\";\r\nimport { xy } from \"./map/xy\";\r\nimport { eqXy } from \"./map/util/eqXy\";\r\n\r\nexport let dpi = 0;\r\nexport const CELL_SIZE = 100;\r\n\r\nexport const offset = {\r\n    x: 0,\r\n    y: 0\r\n}\r\n\r\nexport const getCanvas = () => document.getElementById(\"myCanvas\") as HTMLCanvasElement;\r\n\r\nfunction setCanvasForDpi() {\r\n    const canvas = getCanvas();\r\n    dpi = window.devicePixelRatio;//get canvas\r\n    const style_height = +getComputedStyle(canvas).getPropertyValue(\"height\").slice(0, -2);\r\n    const style_width = +getComputedStyle(canvas).getPropertyValue(\"width\").slice(0, -2);//scale the canvas\r\n    canvas.setAttribute('height', '' + style_height * dpi);\r\n    canvas.setAttribute('width', '' + style_width * dpi);\r\n}\r\n\r\nexport function initCanvas() {\r\n    const canvas = getCanvas();\r\n    setCanvasForDpi();\r\n\r\n    canvas.addEventListener('mousemove', mouseMoveListener);\r\n\r\n    setInterval(animations, 200);\r\n}\r\n\r\nlet phase = 1;\r\nconst animations = () => {\r\n    // console.log(`animate ${phase}`);\r\n    phase++;\r\n    if (phase > 4) {\r\n        phase = 1;\r\n    }\r\n\r\n    const canvas = getCanvas();\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (ctx) {\r\n        for (const effect of effects) {\r\n            drawCell(ctx, effect.at);\r\n        }\r\n    }\r\n}\r\n\r\nfunction darkenIfNotVisible(ctx: CanvasRenderingContext2D, at: xy, fn: () => void) {\r\n    ctx.save();\r\n    if (!visible[at.y][at.x]) {\r\n        ctx.filter = 'brightness(0.4)';\r\n    }\r\n    fn();\r\n    ctx.restore();\r\n}\r\n\r\nfunction drawImage(img: HTMLImageElement, at: xy) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`); \r\n\r\n    const canvas = getCanvas();\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    darkenIfNotVisible(ctx, at, () => {\r\n        const x = (at.x - offset.x) * CELL_SIZE;\r\n        const y = (at.y - offset.y) * CELL_SIZE;\r\n\r\n        ctx.drawImage(\r\n            img,\r\n            x,\r\n            y,\r\n            CELL_SIZE,\r\n            CELL_SIZE\r\n        );\r\n    });\r\n}\r\n\r\nfunction drawOversiedImage(img: HTMLImageElement, at: xy) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`);\r\n    // if (visible[at.y][at.x]) {\r\n        \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n        const x = (at.x - offset.x) * CELL_SIZE - (CELL_SIZE / 4);\r\n        const y = (at.y - offset.y) * CELL_SIZE - (CELL_SIZE / 2);\r\n\r\n        ctx.drawImage(\r\n            img,\r\n            x,\r\n            y,\r\n            CELL_SIZE * 1.5,\r\n            CELL_SIZE * 1.5\r\n        );\r\n    // }\r\n}\r\n\r\nfunction drawStandingImage(img: HTMLImageElement, at: xy) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`);\r\n    // if (visible[at.y][at.x]) {\r\n        \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n        const x = (at.x - offset.x) * CELL_SIZE;\r\n        const y = (at.y - offset.y) * CELL_SIZE;\r\n\r\n        ctx.drawImage(\r\n            img,\r\n            x,\r\n            y - (CELL_SIZE / 2),\r\n            CELL_SIZE,\r\n            CELL_SIZE * 1.5\r\n        );\r\n    // }\r\n}\r\n\r\nfunction drawWallImage(btmImg: HTMLImageElement, topImg: HTMLImageElement, at: xy, transparent: boolean) {\r\n    // console.log(`visible: ${JSON.stringify(visible)}`);\r\n    // console.log(`at: ${JSON.stringify(at)}`);\r\n    // if (mapped[at.y][at.x]) {\r\n        \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n        darkenIfNotVisible(ctx, at, () => {\r\n\r\n        const x = (at.x - offset.x) * CELL_SIZE;\r\n        const y = (at.y - offset.y) * CELL_SIZE;\r\n\r\n        \r\n        ctx.save();\r\n        if (transparent) {\r\n            ctx.globalAlpha = 0.8;\r\n        }\r\n        ctx.drawImage(\r\n            topImg,\r\n            x,\r\n            y - (CELL_SIZE / 4 * 3),\r\n            CELL_SIZE,\r\n            CELL_SIZE\r\n        );\r\n        ctx.drawImage(\r\n            btmImg,\r\n            x,\r\n            y + (CELL_SIZE / 4),\r\n            CELL_SIZE,\r\n            CELL_SIZE - (CELL_SIZE / 4)\r\n        );\r\n        ctx.restore();\r\n        });\r\n    // }\r\n}\r\n\r\nfunction drawUnit(unit: Unit) {\r\n    if (visible[unit.at.y][unit.at.x]) {\r\n        if (unit.imgType === IMG_TYPE.STANDING) {\r\n            drawStandingImage(unit.img.img as HTMLImageElement, unit.at);\r\n        } else if (unit.imgType == IMG_TYPE.OVERSIZED) {\r\n            drawOversiedImage(unit.img.img as HTMLImageElement, unit.at);\r\n        } else {\r\n            drawImage(unit.img.img as HTMLImageElement, unit.at);\r\n        }\r\n    \r\n    \r\n        const canvas = getCanvas();\r\n        const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n        const x = (unit.at.x - offset.x) * CELL_SIZE;\r\n        const y = (unit.at.y - offset.y) * CELL_SIZE;\r\n        ctx.font = \"25px Arial\";\r\n\r\n        ctx.fillStyle = \"white\";\r\n        ctx.fillText(`${unit.armour}`, x + CELL_SIZE - 90, y + CELL_SIZE);\r\n\r\n        ctx.fillStyle = \"red\";\r\n        ctx.fillText(`${unit.hp}`, x + CELL_SIZE - 55, y + CELL_SIZE);\r\n\r\n        ctx.fillStyle = \"yellow\";\r\n        ctx.fillText(`${unit.qi}`, x + CELL_SIZE - 30, y + CELL_SIZE);\r\n    }\r\n}\r\n\r\nexport const render = () => {\r\n    const canvas = getCanvas();\r\n    const ctx = canvas.getContext(\"2d\");\r\n\r\n    if (ctx) {\r\n        // console.log(`canvas.width: ${canvas.width}, canvas.height: ${canvas.height}`);\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        drawCells(ctx);\r\n    }\r\n};\r\n\r\nfunction drawCells(ctx: CanvasRenderingContext2D) {\r\n    // console.log('draw cells');\r\n    for (let y = 0 + offset.y; y < map.length; y++) {\r\n        for (let x = 0 + offset.x; x < map[0].length; x++) {\r\n            drawCell(ctx, {x, y});\r\n        }\r\n    }\r\n}\r\n\r\nfunction drawCell(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (mapped[at.y][at.x]) {\r\n        // console.log(`drawing ${x}, ${y}`);\r\n        if (map[at.y][at.x] === 0) {\r\n            // console.log('floor');\r\n            drawImage(images.floor.img as HTMLImageElement, at);\r\n        } else if (map[at.y][at.x] === 1) {\r\n            // console.log('cave');\r\n            const transparent = at.y - 1 >= 0 && map[at.y - 1][at.x] === 0 && visible[at.y - 1][at.x];\r\n            if (transparent) {\r\n                drawImage(images.floor.img as HTMLImageElement, at);\r\n            }\r\n            drawWallImage(images.w2.img as HTMLImageElement, images.cave.img as HTMLImageElement, at, transparent);\r\n        }\r\n\r\n        // drawMoveToBg(ctx, at);\r\n        drawActionAtBg(ctx, at);\r\n\r\n        drawCurrentUnitBg(ctx, at);\r\n        drawItems(at);\r\n        drawUnits(at);\r\n        drawEffects(at);\r\n        drawCursor(ctx, at);\r\n    }\r\n}\r\n\r\nfunction drawCurrentUnitBg(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (eqXy(currentTurnUnit().at, at)) {\r\n        ctx.fillStyle = CURRENT_UNIT_COLOUR;\r\n        ctx.fillRect(\r\n            (currentTurnUnit().at.x - offset.x) * CELL_SIZE,\r\n            (currentTurnUnit().at.y - offset.y) * CELL_SIZE,\r\n            CELL_SIZE,\r\n            CELL_SIZE\r\n        );\r\n    }\r\n}\r\n\r\nfunction drawUnits(at: xy) {\r\n    const unit = units.find(unit => eqXy(unit.at, at));\r\n    // for (const unit of units) {\r\n    if (unit) {\r\n        drawUnit(unit);\r\n    }\r\n    // }\r\n}\r\n\r\nfunction drawItem(item: PlacedItem) {\r\n    drawImage(item.type.img.img as HTMLImageElement, item.at);\r\n}\r\n\r\nfunction drawItems(at: xy) {\r\n    const item = items().find(item => item.at.x === at.x && item.at.y === at.y);\r\n    // for (const item of items()) {\r\n    if (item) {\r\n        drawItem(item);\r\n    }\r\n    // }\r\n}\r\n\r\nfunction drawEffect(effect: Effect) {\r\n    // console.log(`draw effect`);\r\n    if (effect.type === EffectType.LIGHTNING) {\r\n        switch (phase) {\r\n            case 1:\r\n                return drawImage(images.lightning1.img as HTMLImageElement, effect.at);\r\n            case 2:\r\n                return drawImage(images.lightning2.img as HTMLImageElement, effect.at);\r\n            case 3:\r\n                return drawImage(images.lightning3.img as HTMLImageElement, effect.at);\r\n            case 4:\r\n                return drawImage(images.lightning4.img as HTMLImageElement, effect.at);\r\n        }\r\n        \r\n    }\r\n}\r\n\r\nfunction drawEffects(at: xy) {\r\n    const effect = effects.find(effect => effect.at.x === at.x && effect.at.y === at.y);\r\n    // for (const effect of effects) {\r\n    if (effect) {\r\n        drawEffect(effect);\r\n    }\r\n    // }\r\n}\r\n\r\nfunction drawCursor(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (mouseAt.x === at.x && mouseAt.y === at.y) {\r\n        // console.log(`Drawing cursor at ${mouseAt.value.x}, ${mouseAt.value.y}`);\r\n        ctx.lineWidth = 2;\r\n        ctx.strokeStyle = \"orange\";\r\n        ctx.beginPath();\r\n        ctx.rect(mouseAt.x * CELL_SIZE, mouseAt.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nfunction drawActionAtBg(ctx: CanvasRenderingContext2D, at: xy) {\r\n    if (actionAt.some(loc => loc.x === at.x && loc.y === at.y)) {\r\n        ctx.lineWidth = 16;\r\n        ctx.strokeStyle = currentActionColour();\r\n        ctx.beginPath();\r\n        ctx.rect((at.x - offset.x) * CELL_SIZE + 12, (at.y - offset.y) * CELL_SIZE + 12, CELL_SIZE - 24, CELL_SIZE - 24);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nexport function shiftRight() {\r\n    offset.x++;\r\n    render();\r\n}\r\n\r\nexport function shiftLeft() {\r\n    if (offset.x > 0) { \r\n        offset.x--;\r\n        render();\r\n    }\r\n}\r\n\r\nexport function shiftUp() {\r\n    if (offset.y > 0) {\r\n        offset.y--;\r\n        render();\r\n    }\r\n}\r\n\r\nexport function shiftDown() {\r\n    offset.y++;\r\n    render();\r\n}","import { Ref, ref } from \"vue\";\r\nimport { render } from \"../canvas\";\r\nimport { clearMoveTo } from \"../moving\";\r\nimport { currentTurnUnit, nextUnitTurn } from \"../units/units\";\r\nimport { WALK_ACTION } from \"./commonActions\";\r\nimport { findPlayerVisible } from \"@/level/visibility\";\r\nimport { CORNER } from \"@/level/constants\";\r\nimport { SpaceCheckerFunction, findRangeAround } from \"../map/util/findAround\";\r\nimport { xyd } from \"../map/xyd\";\r\nimport { gameOver, isGameOver } from \"../gameStatus\";\r\n\r\nexport type ActionRange = {\r\n    range: number | (() => number),\r\n    validator: SpaceCheckerFunction,\r\n    colour: string\r\n}\r\n\r\nexport type Action = {\r\n    label: string,\r\n    img: string,\r\n    corners?: CORNER,\r\n    range?: ActionRange,\r\n    meta?: any,\r\n    perform: (at: xyd) => void,\r\n    precondition: () => boolean,\r\n    // rangeValidator?: SpaceCheckerFunction\r\n}\r\n\r\nexport let actionAt: xyd[] = [];\r\n\r\nexport const clearActionAt = () => actionAt = [];\r\n\r\nconst currentAction: Ref<Action> = ref(WALK_ACTION);\r\n\r\nexport const currentActionColour = () => currentAction.value.range?.colour as string;\r\n\r\nexport const isCurrentAction = (action: Action) => currentAction.value.label === action.label;\r\n\r\nexport const initAction = () => clickAction(currentAction.value);\r\n\r\nexport const getActionAt = (x: number, y: number) => actionAt.find(_actionAt => _actionAt.x === x && _actionAt.y === y) as xyd;\r\n\r\nexport const clickAction = (action: Action) => {\r\n    clearMoveTo();\r\n    if (action.range) {\r\n        // console.log(`action.range, action=${JSON.stringify(action)}, rangeValidator=${JSON.stringify(action?.range.validator)}`);\r\n        const range = typeof action.range.range === 'number' ? action.range.range : action.range.range();\r\n        actionAt = findRangeAround(currentTurnUnit().at, range, action?.range.validator ?? SpaceCheckerFunction.EMPTY_SPACE);\r\n        currentAction.value = action;\r\n        render();\r\n    } else {\r\n        currentAction.value = action;\r\n        performAction({x:0, y:0, d:0});\r\n        console.log(`unit has ${currentTurnUnit().energy} remaining`);\r\n        if (currentTurnUnit().energy < 1) {\r\n            console.log('no energy left, next unit turn');\r\n            nextUnitTurn();\r\n        } \r\n        console.log('click action finished');\r\n    }\r\n}\r\n\r\nexport const performAction = (at: xyd) => {\r\n    currentAction.value.perform(at);\r\n    if (!currentAction.value.precondition() || currentTurnUnit().energy <= 0 || isGameOver()) {\r\n        currentAction.value = WALK_ACTION;\r\n    }\r\n    \r\n    findPlayerVisible();\r\n    clickAction(currentAction.value);\r\n}\r\n\r\nexport function getCurrentActions(): Action[] {\r\n    const unit = currentTurnUnit();\r\n    return unit.actions?.filter(action => action.precondition()) ?? [];\r\n}","import { initAction } from \"../actions/actions\";\r\nimport { findPlayerVisible } from \"../visibility\";\r\n\r\nexport const LEVEL1 = [\r\n    [1,1,1,1,1,1,1,1,1,1,1],\r\n    [1,0,0,0,1,0,0,0,0,0,1],\r\n    [1,0,0,0,0,0,0,0,0,0,1],\r\n    [1,1,0,1,1,0,0,0,0,0,1],\r\n    [0,0,0,0,1,0,0,0,0,0,1],\r\n    [1,1,1,1,1,0,1,0,1,0,1],\r\n    [1,0,0,0,1,0,1,0,0,0,1],\r\n    [1,0,0,0,1,1,1,1,1,0,1],\r\n    [1,0,0,0,0,0,0,0,0,0,1],\r\n    [1,1,1,1,1,1,1,1,1,1,1]];\r\n\r\nexport let map = LEVEL1;\r\n\r\nexport function initCharacter() {\r\n    // console.log('init character');\r\n    // findMoveTo();\r\n    initAction();\r\n    findPlayerVisible();\r\n    \r\n}\r\n\r\nexport function updateMap(newMap: number[][]) {\r\n    map = newMap;\r\n    \r\n}","import { map } from \"./map/map\";\r\nimport { xy } from \"./map/xy\";\r\nimport { Unit, playerTeam } from \"./units/units\";\r\n\r\nexport let visible: boolean[][] = [];\r\nexport const mapped: boolean[][] = [];\r\n\r\nexport function initVisibility() {\r\n    for (let y = 0; y < map.length; y++) {\r\n        mapped[y] =[];\r\n        for (let x = 0; x < map[0].length; x++) {\r\n            mapped[y][x] = false;\r\n        }\r\n    }\r\n}\r\n\r\nexport function findPlayerVisible() {\r\n    visible = findVisibleTo(playerTeam(), true);\r\n}\r\n\r\nexport function findVisibleTo(units: Unit[], player: boolean = false): boolean[][] {\r\n    const _visible: boolean[][] = [];\r\n    \r\n    for (let y = 0; y < map.length; y++) {\r\n        _visible[y] =[];\r\n        for (let x = 0; x < map[0].length; x++) {\r\n            _visible[y][x] = false;\r\n        }\r\n    }\r\n    \r\n\r\n    for (const unit of units) {\r\n    //     console.log(`_visible: ${JSON.stringify(_visible)}`);\r\n    // console.log(`x: ${unit.x}. y: ${unit.y}`)\r\n        followRight(unit.at, _visible, player);\r\n        followLeft(unit.at, _visible, player);\r\n        followUp(unit.at, _visible, player);\r\n        followDown(unit.at, _visible, player);\r\n        followUpLeft(unit.at, _visible, player);\r\n        followDownRight(unit.at, _visible, player);\r\n        followUpRight(unit.at, _visible, player);\r\n        followDownLeft(unit.at, _visible, player);\r\n    }\r\n\r\n    return _visible;\r\n}\r\n\r\nconst cangoLeft = (x: number) => x >= 0;\r\nconst cangoUp = (y: number) => y >= 0;\r\nconst cangoRight = (x: number) =>  x < map[0].length;\r\nconst cangoDown = (y: number) =>  y < map.length;\r\nconst canMove = (x: number, y: number) => map[y][x] !== 1;\r\n\r\nfunction followRight(from: xy, _visible: boolean[][], player: boolean) {\r\n    const y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoRight(x) && canMove(x, y)) {\r\n        x++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followUpRight({x, y}, _visible, player);\r\n        followDownRight({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followLeft(from: xy, _visible: boolean[][], player: boolean) {\r\n    const y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoLeft(x) && canMove(x, y)) {\r\n        x--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followUpLeft({x, y}, _visible, player);\r\n        followDownLeft({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followUp(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    const x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoUp(y) && canMove(x, y)) {\r\n        y--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followUpLeft({x, y}, _visible, player);\r\n        followUpRight({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followDown(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    const x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoDown(y) && canMove(x, y)) {\r\n        y++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n        followDownLeft({x, y}, _visible, player);\r\n        followDownRight({x, y}, _visible, player);\r\n    }\r\n}\r\n\r\nfunction followUpLeft(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoUp(y) && cangoLeft(x) && canMove(x, y)) {\r\n        x--;\r\n        y--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nfunction followDownRight(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoRight(x) && cangoDown(y) && canMove(x, y)) {\r\n        x++;\r\n        y++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nfunction followUpRight(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoUp(y) && cangoRight(x) && canMove(x, y)) {\r\n        x++;\r\n        y--;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}\r\n\r\nfunction followDownLeft(from: xy, _visible: boolean[][], player: boolean) {\r\n    let y = from.y;\r\n    let x = from.x;\r\n    _visible[y][x] = true;\r\n    if (player) mapped[y][x] = true;\r\n    while (cangoDown(y) && cangoLeft(x) && canMove(x, y)) {\r\n        x--;\r\n        y++;\r\n        _visible[y][x] = true;\r\n        if (player) mapped[y][x] = true;\r\n    }\r\n}","<template>\r\n    <li :class=\"classes()\">\r\n        <span class=\"top-corner\" />\r\n\r\n        <img class=\"profile\" v-if=\"props.unit.profileImg\" :src=\"props.unit.profileImg\" />\r\n        <span class=\"details\">\r\n            <span class=\"name\">{{ props.unit.name }}</span>\r\n            <span class=\"stats\">\r\n                <span class=\"armour\">{{  props.unit.armour }}</span>\r\n                <img src=\"icon_armour.png\" class=\"icon\" />\r\n\r\n                <span class=\"hp\">{{ props.unit.hp }}</span>\r\n                <img src=\"icon_heart.png\" class=\"icon\" />\r\n\r\n                <span class=\"qi\">{{ props.unit.qi }}</span>\r\n                <img src=\"icon_qi.png\" class=\"icon\" />\r\n            </span>\r\n        </span>\r\n\r\n        <span class=\"bottom-corner\" />\r\n    </li>\r\n</template>\r\n\r\n<script setup >\r\nimport { defineProps } from 'vue';\r\nimport { Unit } from '@/level/units/units';\r\n\r\nconst props = defineProps({\r\n    unit: Unit,\r\n    selected: Boolean\r\n});\r\n\r\nconst classes = () => props.selected === true ? 'selected' : '';\r\n</script>\r\n\r\n<style scoped>\r\nli {\r\n    background-color: #3f3d3d;\r\n    /* background-color: #b1b1e9; */\r\n    padding: 8px 8px;\r\n    font-size: 20px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n    /* border: 4px solid #696990; */\r\n    margin-bottom: 5px;\r\n    /* width: 60px; */\r\n    display: flex;\r\n    flex-direction: row;\r\n\r\n    width: 220px;\r\n    color: #e7e7c8;\r\n    position: relative;\r\n}\r\n\r\nli .top-corner {\r\n    position: absolute;\r\n    width: 6px;\r\n    height: 6px;\r\n    background-color: #97973e;\r\n    top: 0;\r\n    left: 0;\r\n}\r\n\r\nli .bottom-corner {\r\n    position: absolute;\r\n    width: 6px;\r\n    height: 7px;\r\n    background-color: #97973e;\r\n    bottom: 0;\r\n    right: 0;\r\n}\r\n\r\nli.selected {\r\n    /* background-color: #d7bf62; */\r\n    border: 4px solid #ffff25;\r\n    margin-right: 20px;\r\n}\r\n\r\nli.selected .top-corner {\r\n    background-color: #ffff25;\r\n}\r\n\r\nli.selected .bottom-corner {\r\n    background-color: #ffff25;\r\n}\r\n\r\nli img {\r\n    width: 60px;\r\n    height: 60px;\r\n    margin-right: 6px;\r\n}\r\n\r\n.details {\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.stats {\r\n    color: #b3b397;\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n\r\n.stats .icon {\r\n    width: 30px;\r\n    height: 30px;\r\n    margin-right: 8px;\r\n}\r\n\r\n.stats .hp {\r\n    color: #e16dbe;\r\n    font-weight: 700;\r\n}\r\n\r\n.stats .armour {\r\n    color: #becfe5;\r\n    font-weight: 700;\r\n}\r\n\r\n.stats .qi {\r\n    color: #ffd11f;\r\n    font-weight: 700;\r\n}\r\n</style>","import script from \"./UnitProfile.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./UnitProfile.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./UnitProfile.vue?vue&type=style&index=0&id=4b1b6481&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4b1b6481\"]])\n\nexport default __exports__","<template>\r\n    <ul id=\"turnStack\">\r\n        <template v-for=\"(unit, i) in units()\" :key=\"i\">\r\n            <UnitProfile \r\n                v-if=\"selected(unit)\" \r\n                :unit=\"unit\" \r\n                :selected=\"true\" \r\n            />\r\n            <!-- <li class=\"selected\" v-if=\"selected(unit)\">\r\n                <img class=\"profile\" v-if=\"unit.profileImg\" :src=\"unit.profileImg\" />\r\n                {{ unit.name }}\r\n            </li> -->\r\n            <UnitProfile \r\n                v-else-if=\"visible[unit.at.y][unit.at.x]\" \r\n                :unit=\"unit\" \r\n                :selected=\"false\"\r\n            />\r\n            <!-- <li v-if=\"visible[unit.at.y][unit.at.x]\">\r\n                <img class=\"profile\" v-if=\"unit.profileImg\" :src=\"unit.profileImg\" />\r\n                {{  unit.name }}\r\n            </li> -->\r\n        </template>\r\n    </ul>\r\n</template>\r\n\r\n<script setup>\r\nimport { visible } from '../visibility';\r\nimport { getStack } from './turnStack';\r\nimport { currentTurnUnit } from './units';\r\nimport UnitProfile from './UnitProfile.vue';\r\nconst units = () => {\r\n    // console.log(turnStack.value);\r\n    return getStack();\r\n}\r\n\r\nconst selected = (unit) => currentTurnUnit().name === unit.name;\r\n</script>\r\n\r\n<style scoped>\r\nul#turnStack {\r\n    list-style-type: none;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: right;\r\n    align-items: flex-end;\r\n    margin-right: 4px;\r\n}\r\n\r\nul#turnStack li {\r\n    background-color: #3f3d3d;\r\n    /* background-color: #b1b1e9; */\r\n    padding: 8px 8px;\r\n    font-size: 20px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n    /* border: 4px solid #696990; */\r\n    margin-bottom: 5px;\r\n    /* width: 60px; */\r\n    display: flex;\r\n    flex-direction: row;\r\n\r\n    width: 220px;\r\n    color: #e7e7c8;\r\n}\r\n\r\nul#turnStack li.selected {\r\n    /* background-color: #d7bf62; */\r\n    border: 4px solid #ffff25;\r\n    width: 240px;\r\n}\r\n\r\nul#turnStack li img {\r\n    width: 60px;\r\n    height: 60px;\r\n    margin-right: 6px;\r\n}\r\n\r\n/* ul#turnStack li.selected img {\r\n    width: 60px;\r\n    height: 60px;\r\n} */\r\n</style>","import script from \"./TurnStack.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./TurnStack.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./TurnStack.vue?vue&type=style&index=0&id=6864ebbc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6864ebbc\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"guide\" v-if=\"show()\" :style=\"getStyle()\">\r\n        <img src=\"player_profile.png\" />\r\n        <span>{{ getTooltip().text }}</span>\r\n        <span :class=\"['arrow', getTooltip().direction]\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { hasTooltip, getTooltip } from './guide';\r\nimport { hasDialog } from '@/dialog/dialog';\r\nimport { defineProps } from 'vue';\r\nimport { TargetType } from '@/level/constants';\r\n\r\nconst props = defineProps({\r\n    target: TargetType,\r\n    name: String\r\n});\r\n\r\nconst show = () => \r\n    hasTooltip() \r\n    && !hasDialog() \r\n    && getTooltip().target === props.target \r\n    && getTooltip().targetName === props.name;\r\n\r\n\r\nconst getStyle = () => `top: ${getTooltip().location.top}px; left: ${getTooltip().location.left}px; width: ${getTooltip().width ?? 200}px`;\r\n</script>\r\n\r\n<style scoped>\r\n.guide {\r\n    background-color: #e7e7c8;\r\n    height: 40px;\r\n    width: 200px;\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    padding: 8px;\r\n\r\n    position: absolute;\r\n    /* top: 290px;\r\n    left: 240px; */\r\n    z-index: 10;\r\n    box-shadow: 1px 1px 5px black;\r\n}\r\n\r\n.guide img {\r\n    width: 40px;\r\n    height: 40px;\r\n    margin-right: 10px;\r\n}\r\n\r\n.guide span {\r\n    font-size: 18px;\r\n    color: #308c16;\r\n}\r\n\r\n.guide .arrow {\r\n    width: 20px;\r\n    height: 20px;\r\n    background-color: #e7e7c8;\r\n    position: absolute;\r\n    transform: rotate(45deg);\r\n\r\n    z-index: 1;\r\n}\r\n\r\n.arrow.left {\r\n    left: -10px;\r\n}\r\n\r\n.arrow.bottom {\r\n    bottom: -10px;\r\n    left: 40px;\r\n}\r\n\r\n.arrow.bottom-right {\r\n    right: 40px;\r\n    bottom: -10px;\r\n}\r\n</style>","import script from \"./ToolTip.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ToolTip.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ToolTip.vue?vue&type=style&index=0&id=75c8e7bd&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-75c8e7bd\"]])\n\nexport default __exports__","<template>\r\n    <span :class=\"classes()\" @click=\"() => clickAction(props.action)\">\r\n        <img :src=\"props.action.img\"/>\r\n        <ToolTip target=\"action\" :name=\"props.action.label\"/>\r\n    </span>\r\n</template>\r\n\r\n<script setup>\r\nimport ToolTip from '../guide/ToolTip.vue';\r\nimport { defineProps } from 'vue';\r\nimport { isCurrentAction, Action, clickAction } from './actions';\r\n\r\nconst props = defineProps({\r\n    action: {\r\n        type: Action,\r\n        required: true\r\n    }\r\n});\r\n\r\nconst classes = () => ['action', isCurrentAction(props.action) ? 'selected' : '', props.action.corners];\r\n</script>\r\n\r\n<style scoped>\r\n.action {\r\n    font-size: 16px;\r\n    width: 120px;\r\n    height: 120px;\r\n    /* border: 1px solid black; */\r\n    border-radius: 60px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n    background-color: #fcf5bf;\r\n    pointer-events: auto;\r\n\r\n    border: solid 2px #6f6262;\r\n    position: relative;\r\n}\r\n\r\n.action.square {\r\n    border-radius: 10px;\r\n}\r\n\r\n.action.selected {\r\n    border: solid 5px white;\r\n}\r\n\r\n.action:hover {\r\n    cursor: pointer;\r\n    box-shadow: 0px 0px 20px white;\r\n}\r\n\r\n.action img {\r\n    width: 120px;\r\n    height: 120px;\r\n}\r\n</style>","import script from \"./ActionButton.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActionButton.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ActionButton.vue?vue&type=style&index=0&id=0f1e618d&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0f1e618d\"]])\n\nexport default __exports__","<template>\r\n    <div id=\"inventory\" :class=\"inventoryClasses()\" v-if=\"hasInventory()\">\r\n        <span :class=\"itemClasses(item)\" v-for=\"(item, index) in inventory()\" :key=\"index\" @click=\"clickInventory(item)\">\r\n            <img :src=\"item.type.img.img.src\" />\r\n            <span class=\"quantity\">{{  item.quantity }}</span>\r\n            <label>{{ item.type.title }}</label>\r\n        </span>\r\n        <h2>Inventory</h2>\r\n    </div>\r\n    \r\n</template>\r\n\r\n<script setup>\r\nimport { currentTurnUnit } from \"@/level/units/units\";\r\nimport { clickInventory, isSelectedInventoryItem, INVENTORY_ACTION } from \"@/level/items/inventory/inventory\";\r\nimport { isCurrentAction } from \"@/level/actions/actions\";\r\n\r\nconst inventory = () => currentTurnUnit()?.inventory.items;\r\n\r\nconst hasInventory = () => currentTurnUnit()?.inventory && !currentTurnUnit()?.inventory.isEmpty();\r\n\r\nconst inventoryClasses = () => isCurrentAction(INVENTORY_ACTION) ? 'selected' : '';\r\n\r\nconst itemClasses = (item) => ['item', isSelectedInventoryItem(item) ? 'selected' : ''];\r\n\r\n</script>\r\n\r\n<style scoped>\r\n/* Container */\r\n#inventory {\r\n    display: flex;\r\n    flex-direction: row-reverse;\r\n    background-color: #3f3d3d;\r\n    padding: 4px;\r\n    margin-right: 20px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n\r\n    pointer-events: auto;\r\n    gap: 8px;\r\n    position: relative;\r\n    min-width: 110px;\r\n    justify-content: center;\r\n}\r\n\r\n#inventory.selected {\r\n    border: 4px solid white;\r\n}\r\n\r\n#inventory h2 {\r\n    position: absolute;\r\n    top: -44px;\r\n    font-size: 18px;\r\n    background-color: #343333;\r\n    color: #e7e7c8;\r\n    padding: 0px 16px 4px 16px;\r\n    border-radius: 6px;\r\n    border: 2px solid #77772f;\r\n    z-index: -10;\r\n}\r\n\r\n#inventory.selected h2 {\r\n    border: 2px solid white;\r\n}\r\n\r\n\r\n/* Item */\r\n#inventory .item {\r\n    position: relative;\r\n    padding: 4px;\r\n    border-radius: 4px;\r\n    display: flex;\r\n    flex-direction: column;\r\n    border: 4px solid #343333;\r\n}\r\n\r\n#inventory .item.selected {\r\n    border: 4px solid white;\r\n}\r\n\r\n#inventory .item:hover {\r\n    cursor: pointer;\r\n    box-shadow: 0px 0px 5px #97973e;\r\n}\r\n\r\n#inventory .item img {\r\n    width: 60px;\r\n    height: 60px;\r\n}\r\n\r\n#inventory .item label {\r\n    font-size: 10px;\r\n    color: #e7e7c8;\r\n    width: 60px;\r\n    text-align: center;\r\n}\r\n#inventory .item .quantity {\r\n    color: white;\r\n    position: absolute;\r\n    z-index: 10;\r\n    top: 4px;\r\n    right: 4px;\r\n\r\n    background-color: #08080873;\r\n    padding: 2px 4px;\r\n    border-radius: 4px;\r\n}\r\n</style>","import script from \"./InventoryPanel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./InventoryPanel.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./InventoryPanel.vue?vue&type=style&index=0&id=3b930f40&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3b930f40\"]])\n\nexport default __exports__","import script from \"./FormationsPanel.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./FormationsPanel.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./FormationsPanel.vue?vue&type=style&index=0&id=76a36a10&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-76a36a10\"]])\n\nexport default __exports__","import script from \"./ActionButtons.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActionButtons.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ActionButtons.vue?vue&type=style&index=0&id=55d81a28&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-55d81a28\"]])\n\nexport default __exports__","import script from \"./GameOver.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./GameOver.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./GameOver.vue?vue&type=style&index=0&id=e48b20fc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e48b20fc\"]])\n\nexport default __exports__","<template>\r\n    <div class=\"matte\">\r\n        \r\n        <slot></slot>\r\n\r\n    </div>\r\n</template>\r\n\r\n<style>\r\n.matte {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #aaaa;\r\n    z-index: 20;\r\n\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n}\r\n</style>","import { render } from \"./ModalMatte.vue?vue&type=template&id=29f05ba6\"\nconst script = {}\n\nimport \"./ModalMatte.vue?vue&type=style&index=0&id=29f05ba6&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import script from \"./BaseModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./BaseModal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./BaseModal.vue?vue&type=style&index=0&id=a4e1fc00&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { xyd } from \"@/level/map/xyd\";\r\nimport { Ref, ref } from \"vue\";\r\n\r\nexport type ModalInput = {\r\n    title: string,\r\n    name: string,\r\n    value: string\r\n}\r\n\r\nexport type ModalDetails = {\r\n    inputs: ModalInput[],\r\n    title: () => string,\r\n    onSubmit: (at: xyd, inputs: ModalInput[]) => void\r\n}\r\n\r\nconst modalActive = ref(false);\r\nconst _modalDetails: Ref<ModalDetails | null> = ref(null);\r\nlet _at: xyd | null = null;\r\n\r\nexport const isModalActive = () => modalActive.value;\r\n\r\nexport const getInputs = () => _modalDetails.value?.inputs;\r\n\r\nexport const getTitle = () => _modalDetails.value?.title();\r\n\r\nexport const startModal = (modalDetails: ModalDetails, at: xyd) => {\r\n    console.log(`action modal: ${JSON.stringify(modalDetails)}`);\r\n    modalActive.value = true;\r\n    _modalDetails.value = modalDetails;\r\n    _at = JSON.parse(JSON.stringify(at));\r\n}\r\n\r\nexport const submitModal = () => {\r\n    modalActive.value = false;\r\n    if (_modalDetails.value && _at) {\r\n        _modalDetails.value.onSubmit(_at, _modalDetails.value.inputs);\r\n    }\r\n}\r\n\r\nexport const cancelModal = () => {\r\n    modalActive.value = false;\r\n}","import script from \"./ActionModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ActionModal.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n    <div id=\"levelCanvas\">\r\n        <canvas\r\n            id=\"myCanvas\"\r\n            :class=\"canvasClass()\"\r\n            @click=\"clickCanvas\"\r\n            @keyup.down=\"shiftDown\"\r\n            @keyup.up=\"shiftUp\"\r\n            @keyup.left=\"shiftLeft\"\r\n            @keyup.right=\"shiftRight\"\r\n        ></canvas>\r\n        <ToolTip target=\"canvas\" name=\"canvas\" />\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { shiftDown, shiftLeft, shiftRight, shiftUp } from './canvas';\r\nimport { clickCanvas, mouseHover } from './mouseHandler';\r\nimport ToolTip from './guide/ToolTip.vue';\r\n\r\nconst canvasClass = () => mouseHover.value === true ? 'mouseHover' : '';\r\n</script>\r\n\r\n<style scoped>\r\n#levelCanvas {\r\n    position: relative;\r\n}\r\n\r\n#myCanvas, #levelCanvas {\r\n    margin: 20px;\r\n    width: 1000px;\r\n    height: 1000px;\r\n    box-sizing: border-box;\r\n}\r\n\r\n#myCanvas.mouseHover {\r\n    cursor: pointer;\r\n}\r\n</style>","import script from \"./LevelCanvas.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LevelCanvas.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LevelCanvas.vue?vue&type=style&index=0&id=4b233009&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4b233009\"]])\n\nexport default __exports__","import script from \"./BattleModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./BattleModal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./BattleModal.vue?vue&type=style&index=0&id=4a48c0b9&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4a48c0b9\"]])\n\nexport default __exports__","<template>\r\n    <LevelCanvas />\r\n    \r\n    <GameHud>\r\n        <TurnStack></TurnStack>\r\n        <ActionButtons></ActionButtons>\r\n    </GameHud>\r\n    <ActionModal />\r\n    <BattleModal />\r\n    <!-- <button @click=\"shiftLeft\">←</button>\r\n    <button @click=\"shiftUp\">↑</button>\r\n    <button @click=\"shiftRight\">→</button>\r\n    <button @click=\"shiftDown\">↓</button> -->\r\n    <GameOver />\r\n</template>\r\n\r\n<script setup>\r\nimport GameHud from './components/GameHud.vue';\r\nimport TurnStack from './units/TurnStack.vue';\r\nimport ActionButtons from './actions/ActionButtons.vue';\r\nimport GameOver from './components/GameOver.vue';\r\nimport ActionModal from './actions/ActionModal.vue';\r\nimport LevelCanvas from './LevelCanvas.vue';\r\nimport BattleModal from './battle/BattleModal.vue';\r\nimport { onMounted } from 'vue';\r\nimport { initCanvas, shiftDown, shiftLeft, shiftRight, shiftUp } from './canvas';\r\nimport { initImages } from '@/imageLoader';\r\nimport { initUnits, startPlayerTurn } from './units/units';\r\nimport { placeItem } from \"@/level/items/items\";\r\nimport { SPIDER_BAIT } from \"@/level/items/randomItems\";\r\nimport { initVisibility } from \"@/level/visibility\";\r\nimport { initGuides } from '@/level/guide/levelGuides';\r\n// import { LIGHTNING_FLAG } from './items/inventory/inventory';\r\n\r\nonMounted(() => {\r\n    initImages();\r\n    initUnits();\r\n    initVisibility();\r\n    // initCharacter();\r\n    placeItem(SPIDER_BAIT, {x: 1, y: 1});\r\n    placeItem(SPIDER_BAIT, {x: 5, y: 6});\r\n    placeItem(SPIDER_BAIT, {x: 3, y: 1});\r\n    // placeItem(LIGHTNING_FLAG, {x: 5, y: 1});\r\n    // placeItem(LIGHTNING_FLAG, {x: 7, y: 1});\r\n    // placeItem(LIGHTNING_FLAG, {x: 5, y: 3});\r\n    // placeItem(LIGHTNING_FLAG, {x: 7, y: 3});\r\n    startPlayerTurn();\r\n    initCanvas();\r\n    initGuides();\r\n});\r\n\r\ndocument.addEventListener('keydown', (event) => {\r\n  switch (event.key) {\r\n    case 'ArrowUp':\r\n        shiftUp();\r\n        return;\r\n    case 'ArrowDown':\r\n        shiftDown();\r\n        return;\r\n    case 'ArrowLeft':\r\n        shiftLeft();\r\n        return;\r\n    case 'ArrowRight':\r\n        shiftRight();\r\n        return;\r\n  }\r\n}, false);\r\n\r\n</script>\r\n\r\n<style>\r\nbutton {\r\n    font-size: 40px;\r\n}\r\n</style>","import script from \"./LevelContainer.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LevelContainer.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LevelContainer.vue?vue&type=style&index=0&id=58a29f65&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n    <ModalMatte v-if=\"hasDialog()\" @click=\"next\">\r\n        <div class=\"dialog\">\r\n            <span class=\"image\">\r\n                <img :src=\"getDialog().profileImg\" />\r\n            </span>\r\n            <span class=\"text\">\r\n                <span class=\"name\">{{ getDialog().name }}</span>\r\n                <span class=\"speech\">{{ getDialog().speech }}</span>\r\n            </span>\r\n        </div>\r\n    </ModalMatte>\r\n</template>\r\n\r\n<script setup>\r\nimport { hasDialog, getDialog, dialogNext } from './dialog';\r\nimport ModalMatte from '../modal/ModalMatte.vue'\r\n\r\nconst next = () => {\r\n    dialogNext();\r\n}\r\n</script>\r\n\r\n<style>\r\n.matte {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #aaaa;\r\n    z-index: 20;\r\n\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n\r\n    cursor: pointer;\r\n}\r\n\r\n.dialog {\r\n    position: relative;\r\n    display: flex;\r\n    flex-direction: column;\r\n    user-select: none;\r\n}\r\n\r\n.text {\r\n    background-color: #3f3d3d;\r\n    padding: 12px 18px;\r\n    border-radius: 6px;\r\n    border: 4px solid #97973e;\r\n    color: #e7e7c8;\r\n    width: 500px;\r\n    font-size: 20px;\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n\r\n.name {\r\n    font-weight: 700;\r\n    margin-bottom: 8px;\r\n    color: #e7e7de;\r\n}\r\n\r\n.image {\r\n    margin-bottom: -5px;\r\n}\r\n\r\nimg {\r\n    height: 500px;\r\n}\r\n</style>","import script from \"./DialogModal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./DialogModal.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./DialogModal.vue?vue&type=style&index=0&id=3ea63e25&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import script from \"./App.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=c0f79cae&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkrpggame\"] = self[\"webpackChunkrpggame\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [998], function() { return __webpack_require__(5247); })\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["id","_createElementBlock","_hoisted_1","_renderSlot","_ctx","$slots","undefined","script","__exports__","render","initImg","img","loaded","loadImg","image","imgLoc","Image","src","onload","images","floor","cave","w2","character","spider","mouse","lightningFlag","formationPlate","animalCorpse","lightning1","lightning2","lightning3","lightning4","checkLoaded","imgs","Object","values","notLoaded","filter","numNotLoaded","length","setTimeout","initImages","MOVEMENT_HOVER_COLOUR","ATTACK_HOVER_COLOUR","CURRENT_UNIT_COLOUR","CORNER","IMG_TYPE","GuideType","GuideDirection","TargetType","ItemCategory","_items","ref","items","value","placeItem","item","at","push","type","takeItem","splice","findIndex","x","y","EffectType","effects","addEffect","source","find","effect","clearEffect","findEffectsForSource","turnStack","turnIndex","nextStackUnit","currentStackUnit","hasStackUnit","name","stackIndex","unit","removeStackUnit","console","log","JSON","stringify","addStackUnit","initStack","getStack","eqXy","at1","at2","FormationStatus","formations","addFormation","title","newFormation","corners","status","IDLE","checkFormationCorners","TL","TR","BL","BR","BROKEN","updateFormations","formation","removeFormation","f","hasFormations","getFormations","activateFormation","ALIVE","applyEffects","energy","movement","autoMove","player","qi","unitAtEffect","unitAt","attackUnit","power","applyEffectsTL","cornerAt","formationAt","LIGHTNING","applyEffectsTR","applyEffectsBL","applyEffectsBR","deactivateFormation","category","FLAG","xdiff","ydiff","Math","abs","parse","dist","SpaceCheckerFunction","EMPTY_SPACE_CHECKER","map","units","some","ENEMY_UNIT_CHECKER","team","Team","MONSTER","WALL_CHECKER","ITEM_CHECKER","findFreeSpaceAround","around","validateFn","_validateFn","EMPTY_SPACE","findSpaceAroundInternal","doValidate","fn","ENEMY_UNIT","WALL","ITEM","existingSpaces","spacesAround","iterx","itery","move","findRangeAround","range","spaces1","space","buildXyd","n","iter","spaces","concat","d","Inventory","constructor","inItems","_defineProperty","this","removeItem","quantity","_item","addItem","foundItem","isEmpty","LIGHTNING_FLAG","FORMATION_PLATE","FORMATION","placeInventoryItem","selectedInventoryItem","currentTurnUnit","inventory","clickAction","WALK_ACTION","takeInventoryItem","INVENTORY_ACTION","label","validator","colour","perform","precondition","isSelectedInventoryItem","isCurrentAction","clickInventory","GameStatus","IN_PROGRESS","gameOverMessage","gameOverImage","GAME_OVER_DEFEAT","gameOverMsg","gameOverImg","gameOver","message","GAME_OVER","isGameOver","WAIT_ACTION","ATTACK_ACTION","playerUnit","PICK_UP_ACTION","EXIT_LEVEL_ACTION","SQUARE","hasEnemies","mouseUnit","profileImg","hp","armour","PLAYER","actions","battleDetails","center","rebound","top","height","SUMMON_LABEL","DEPLOYED_ATTRIBUTE","SUMMON_SPIRIT_FRIEND_ACTION","meta","addUnit","RECALL_SPIRIT_FRIEND_ACTION","removeUnit","action","PLAYER_NAME","imgType","STANDING","moveTo","moveCharacter","clearMoveTo","SPIDER_BAIT_NAME","SPIDER_BAIT","NORMAL","isNextTo","from","to","visibleToLocations","visible","locations","findSpaceClosestTo","moves","target","visibleMoves","visibleLocations","attackableLocations","closestAttack","closestMove","closestDistance","location","distance","attack","boss","identifyTarget","_player","baits","bait","charge","closest","idleWalk","randomChoice","random","toX","toY","bossMove","findVisibleTo","bossUnit","OVERSIZED","NAME","PROFILE_IMG","PROFILE_COLD","PROFILE_READING","introDialog","speech","movementGuide","TOOLTIP","tooltip","text","direction","LEFT","left","CANVAS","targetName","ready","finished","baitVisible","baitDialog","DIALOG","dialog","baitTooltip","pickupTooltip","BOTTOM","width","ACTION","spyDialog","spyTooltip","playerTeam","spiderVisible","spiderDialog","formationPlateDialog","formationCompleteDialog","spiderDeadDialog","exitTooltip","BOTTOM_RIGHT","initGuides","setGuides","showHelp","dialogList","hasDialog","getDialog","dialogNext","guideTick","setDialog","_dialog","guides","guideText","hasTooltip","getTooltip","_guides","i","inBattle","isInBattle","startBattle","damage","attacker","defender","startAnimation","hasAttacker","endBattle","defenderImg","attackerImg","animationRate","leftStyle","rightStyle","rightFloorStyle","drawLeftSide","drawRightSide","attackerStartCharge","lightningAttack","attackerCompleteCharge","defenderReceiveAttack","defenderReturnToNormal","endAnimation","initUnits","unitIndex","nextUnitTurn","currentUnit","doMove","startPlayerTurn","findPlayerVisible","targetLocation","attackee","remainingPower","mouseHover","mouseAt","mouseMoveListener","event","canvas","getCanvas","rect","getBoundingClientRect","clientX","CELL_SIZE","dpi","clientY","checkForHover","mouseOverMoveTo","mouseOverActionAt","loc","offset","actionAt","clickCanvas","getActionAt","performAction","document","getElementById","setCanvasForDpi","window","devicePixelRatio","style_height","getComputedStyle","getPropertyValue","slice","style_width","setAttribute","initCanvas","addEventListener","setInterval","animations","phase","ctx","getContext","drawCell","darkenIfNotVisible","save","restore","drawImage","drawOversiedImage","drawStandingImage","drawWallImage","btmImg","topImg","transparent","globalAlpha","drawUnit","font","fillStyle","fillText","clearRect","drawCells","mapped","drawActionAtBg","drawCurrentUnitBg","drawItems","drawUnits","drawEffects","drawCursor","fillRect","drawItem","drawEffect","lineWidth","strokeStyle","beginPath","stroke","currentActionColour","shiftRight","shiftLeft","shiftUp","shiftDown","currentAction","_actionAt","getCurrentActions","LEVEL1","initVisibility","_visible","followRight","followLeft","followUp","followDown","followUpLeft","followDownRight","followUpRight","followDownLeft","cangoLeft","cangoUp","cangoRight","cangoDown","canMove","classes","props","selected","show","getStyle","hasInventory","inventoryClasses","itemClasses","class","modalActive","_modalDetails","_at","isModalActive","getInputs","inputs","getTitle","submitModal","onSubmit","cancelModal","canvasClass","onMounted","key","next","createApp","App","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","m","deferred","O","result","chunkIds","priority","notFulfilled","Infinity","fulfilled","j","keys","every","r","getter","__esModule","a","definition","o","defineProperty","enumerable","get","g","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","Symbol","toStringTag","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","data","moreModules","runtime","chunkLoadingGlobal","self","forEach","bind","__webpack_exports__"],"sourceRoot":""}